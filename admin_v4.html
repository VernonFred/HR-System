<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TalentLens - 智能人才洞察平台</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="questionnaires.js"></script>
    <style>
        /* ==================== Design System ==================== */
        :root {
            /* Shared Variables */
            --accent-primary: #6366f1;
            --accent-primary-hover: #818cf8;
            --accent-success: #22c55e;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --accent-info: #3b82f6;
            
            --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --gradient-success: linear-gradient(135deg, #22c55e 0%, #10b981 100%);
            --gradient-warm: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
            --gradient-cool: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            
            --space-1: 4px; --space-2: 8px; --space-3: 12px; --space-4: 16px;
            --space-5: 20px; --space-6: 24px; --space-8: 32px; --space-10: 40px; --space-12: 48px;
            
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-mono: 'JetBrains Mono', 'Fira Code', monospace;
            
            --text-xs: 11px; --text-sm: 13px; --text-base: 14px; --text-lg: 16px;
            --text-xl: 18px; --text-2xl: 24px; --text-3xl: 30px;
            
            --radius-sm: 6px; --radius-md: 8px; --radius-lg: 12px; --radius-xl: 16px; --radius-full: 9999px;
            
            --sidebar-width: 220px; --header-height: 56px;
            
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Dark Theme (Default) */
        [data-theme="dark"] {
            --bg-base: #09090b;
            --bg-subtle: #18181b;
            --bg-muted: #27272a;
            --bg-elevated: #3f3f46;
            --border-subtle: rgba(255,255,255,0.06);
            --border-default: rgba(255,255,255,0.1);
            --border-strong: rgba(255,255,255,0.15);
            --text-primary: #fafafa;
            --text-secondary: #a1a1aa;
            --text-tertiary: #71717a;
            --text-muted: #52525b;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.4);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.5);
            --shadow-xl: 0 16px 48px rgba(0,0,0,0.6);
            --chart-text: #a1a1aa;
            --chart-line: #27272a;
        }

        /* Light Theme */
        [data-theme="light"] {
            --bg-base: #f8fafc;
            --bg-subtle: #ffffff;
            --bg-muted: #f1f5f9;
            --bg-elevated: #e2e8f0;
            --border-subtle: rgba(0,0,0,0.04);
            --border-default: rgba(0,0,0,0.08);
            --border-strong: rgba(0,0,0,0.12);
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-tertiary: #64748b;
            --text-muted: #94a3b8;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
            --shadow-xl: 0 16px 48px rgba(0,0,0,0.15);
            --chart-text: #64748b;
            --chart-line: #e2e8f0;
        }

        /* Auto Theme (System) */
        @media (prefers-color-scheme: light) {
            [data-theme="auto"] {
                --bg-base: #f8fafc;
                --bg-subtle: #ffffff;
                --bg-muted: #f1f5f9;
                --bg-elevated: #e2e8f0;
                --border-subtle: rgba(0,0,0,0.04);
                --border-default: rgba(0,0,0,0.08);
                --border-strong: rgba(0,0,0,0.12);
                --text-primary: #0f172a;
                --text-secondary: #475569;
                --text-tertiary: #64748b;
                --text-muted: #94a3b8;
                --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
                --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
                --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
                --shadow-xl: 0 16px 48px rgba(0,0,0,0.15);
                --chart-text: #64748b;
                --chart-line: #e2e8f0;
            }
        }

        @media (prefers-color-scheme: dark) {
            [data-theme="auto"] {
                --bg-base: #09090b;
                --bg-subtle: #18181b;
                --bg-muted: #27272a;
                --bg-elevated: #3f3f46;
                --border-subtle: rgba(255,255,255,0.06);
                --border-default: rgba(255,255,255,0.1);
                --border-strong: rgba(255,255,255,0.15);
                --text-primary: #fafafa;
                --text-secondary: #a1a1aa;
                --text-tertiary: #71717a;
                --text-muted: #52525b;
                --shadow-sm: 0 1px 2px rgba(0,0,0,0.4);
                --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
                --shadow-lg: 0 8px 24px rgba(0,0,0,0.5);
                --shadow-xl: 0 16px 48px rgba(0,0,0,0.6);
                --chart-text: #a1a1aa;
                --chart-line: #27272a;
            }
        }

        /* ==================== Reset ==================== */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 14px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: var(--font-sans);
            background: var(--bg-base);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
        }

        /* ==================== Utilities ==================== */
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .gap-1 { gap: var(--space-1); }
        .gap-2 { gap: var(--space-2); }
        .gap-3 { gap: var(--space-3); }
        .gap-4 { gap: var(--space-4); }
        .gap-6 { gap: var(--space-6); }

        /* ==================== Login Page ==================== */
        #loginPage {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-base);
            position: relative;
            overflow: hidden;
        }

        #loginPage::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 30% 30%, rgba(99, 102, 241, 0.08) 0%, transparent 50%),
                        radial-gradient(circle at 70% 70%, rgba(139, 92, 246, 0.06) 0%, transparent 50%);
            animation: aurora 20s ease-in-out infinite;
        }

        @keyframes aurora {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-5%, -5%) rotate(180deg); }
        }

        #loginPage.hidden { display: none; }

        .login-container {
            position: relative;
            z-index: 1;
            width: 100%;
            max-width: 380px;
            padding: var(--space-6);
        }

        .login-card {
            background: var(--bg-subtle);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-xl);
            padding: var(--space-8);
            box-shadow: var(--shadow-xl);
        }

        .login-header {
            text-align: center;
            margin-bottom: var(--space-8);
        }

        .login-logo {
            width: 48px;
            height: 48px;
            background: var(--gradient-primary);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--space-4);
            font-size: 24px;
        }

        .login-title {
            font-size: var(--text-xl);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-1);
        }

        .login-subtitle {
            font-size: var(--text-sm);
            color: var(--text-tertiary);
        }

        .form-group {
            margin-bottom: var(--space-5);
        }

        .form-label {
            display: block;
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: var(--space-2);
        }

        .form-input {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            background: var(--bg-muted);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: var(--text-base);
            font-family: inherit;
            transition: var(--transition-fast);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-4);
            font-size: var(--text-sm);
            font-weight: 500;
            font-family: inherit;
            border-radius: var(--radius-md);
            border: none;
            cursor: pointer;
            transition: var(--transition-fast);
            text-decoration: none;
        }

        .btn-primary {
            background: var(--accent-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-primary-hover);
        }

        .btn-secondary {
            background: var(--bg-muted);
            color: var(--text-primary);
            border: 1px solid var(--border-default);
        }

        .btn-secondary:hover {
            background: var(--bg-elevated);
            border-color: var(--border-strong);
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
        }

        .btn-ghost:hover {
            background: var(--bg-muted);
            color: var(--text-primary);
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--accent-danger);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .btn-danger:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        .btn-full { width: 100%; }

        .btn-sm {
            padding: var(--space-2) var(--space-3);
            font-size: var(--text-xs);
        }

        .btn-icon {
            width: 32px;
            height: 32px;
            padding: 0;
        }

        .login-hint {
            margin-top: var(--space-4);
            text-align: center;
            font-size: var(--text-xs);
            color: var(--text-muted);
        }

        .login-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: var(--accent-danger);
            padding: var(--space-3);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            margin-bottom: var(--space-4);
            display: none;
        }

        .login-error.show { display: block; }

        /* ==================== Main App Layout ==================== */
        #mainApp {
            display: none;
            min-height: 100vh;
        }

        #mainApp.active {
            display: flex;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            background: var(--bg-subtle);
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
            z-index: 100;
        }

        .sidebar-header {
            padding: var(--space-4) var(--space-5);
            border-bottom: 1px solid var(--border-subtle);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .sidebar-logo-icon {
            width: 32px;
            height: 32px;
            background: var(--gradient-primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .sidebar-logo-text {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-primary);
        }

        .sidebar-nav {
            flex: 1;
            padding: var(--space-3);
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: var(--space-4);
        }

        .nav-section-title {
            font-size: var(--text-xs);
            font-weight: 500;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: var(--space-2) var(--space-3);
            margin-bottom: var(--space-1);
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: var(--text-sm);
            cursor: pointer;
            transition: var(--transition-fast);
            margin-bottom: 2px;
        }

        .nav-item:hover {
            background: var(--bg-muted);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: rgba(99, 102, 241, 0.1);
            color: var(--accent-primary);
        }

        .nav-item i {
            font-size: 18px;
            width: 20px;
            text-align: center;
        }

        .sidebar-footer {
            padding: var(--space-4);
            border-top: 1px solid var(--border-subtle);
        }

        .user-card {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-2);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .user-card:hover {
            background: var(--bg-muted);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            background: var(--gradient-cool);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-sm);
            font-weight: 600;
        }

        .user-info {
            flex: 1;
            min-width: 0;
        }

        .user-name {
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--text-primary);
        }

        .user-role {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .main-header {
            height: var(--header-height);
            background: var(--bg-subtle);
            border-bottom: 1px solid var(--border-subtle);
            padding: 0 var(--space-6);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .page-title {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--text-primary);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .search-box {
            position: relative;
        }

        .search-input {
            width: 240px;
            padding: var(--space-2) var(--space-3) var(--space-2) 36px;
            background: var(--bg-muted);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: var(--text-sm);
            transition: var(--transition-fast);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            width: 300px;
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 16px;
        }

        .main-body {
            flex: 1;
            padding: var(--space-6);
            background: var(--bg-base);
        }

        /* Page Views */
        .page-view {
            display: none;
        }

        .page-view.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ==================== Cards ==================== */
        .card {
            background: var(--bg-subtle);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        .card-header {
            padding: var(--space-4) var(--space-5);
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-title {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-primary);
        }

        .card-body {
            padding: var(--space-5);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .stat-card {
            background: var(--bg-subtle);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }

        .stat-card.blue::before { background: var(--gradient-cool); }
        .stat-card.green::before { background: var(--gradient-success); }
        .stat-card.orange::before { background: var(--gradient-warm); }
        .stat-card.purple::before { background: var(--gradient-primary); }
        .stat-card.cyan::before { background: linear-gradient(135deg, #06b6d4, #22d3ee); }
        .stat-card.pink::before { background: linear-gradient(135deg, #ec4899, #f472b6); }

        .stat-label {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
            margin-bottom: var(--space-2);
        }

        .stat-value {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--space-1);
        }

        .stat-change {
            font-size: var(--text-xs);
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        .stat-change.up { color: var(--accent-success); }
        .stat-change.down { color: var(--accent-danger); }

        /* ==================== Table ==================== */
        .table-container {
            background: var(--bg-subtle);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        .table-toolbar {
            padding: var(--space-4) var(--space-5);
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-4);
        }

        .table-info {
            font-size: var(--text-sm);
            color: var(--text-tertiary);
        }

        .table-info strong {
            color: var(--text-primary);
        }

        .table-actions {
            display: flex;
            gap: var(--space-2);
        }

        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--bg-muted);
        }

        thead th {
            padding: var(--space-3) var(--space-4);
            text-align: left;
            font-size: var(--text-xs);
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
            border-bottom: 1px solid var(--border-subtle);
        }

        thead th.sortable {
            cursor: pointer;
            user-select: none;
        }

        thead th.sortable:hover {
            color: var(--text-primary);
        }

        tbody tr {
            border-bottom: 1px solid var(--border-subtle);
            transition: var(--transition-fast);
        }

        tbody tr:hover {
            background: var(--bg-muted);
        }

        tbody tr:last-child {
            border-bottom: none;
        }

        tbody td {
            padding: var(--space-3) var(--space-4);
            font-size: var(--text-sm);
            color: var(--text-primary);
        }

        .checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: var(--accent-primary);
        }

        /* Tags */
        .tag {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            font-weight: 500;
        }

        .tag.excellent {
            background: rgba(34, 197, 94, 0.1);
            color: var(--accent-success);
        }

        .tag.good {
            background: rgba(59, 130, 246, 0.1);
            color: var(--accent-info);
        }

        .tag.medium {
            background: rgba(245, 158, 11, 0.1);
            color: var(--accent-warning);
        }

        .tag.poor {
            background: rgba(239, 68, 68, 0.1);
            color: var(--accent-danger);
        }

        /* Pagination */
        .pagination {
            padding: var(--space-4) var(--space-5);
            border-top: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .pagination-info {
            font-size: var(--text-sm);
            color: var(--text-tertiary);
        }

        .pagination-controls {
            display: flex;
            gap: var(--space-1);
        }

        .page-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border-default);
            background: transparent;
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: var(--text-sm);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .page-btn:hover:not(:disabled) {
            background: var(--bg-muted);
            color: var(--text-primary);
        }

        .page-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .page-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        /* ==================== Modal ==================== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: var(--space-6);
        }

        .modal-overlay.show {
            display: flex;
            animation: fadeIn 0.2s ease;
        }

        .modal {
            background: var(--bg-subtle);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-xl);
            width: 100%;
            max-width: 560px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: var(--shadow-xl);
        }

        .modal.large {
            max-width: 800px;
        }

        .modal-header {
            padding: var(--space-5);
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
            color: var(--text-tertiary);
            cursor: pointer;
            transition: var(--transition-fast);
            background: none;
            border: none;
        }

        .modal-close:hover {
            background: var(--bg-muted);
            color: var(--text-primary);
        }

        .modal-body {
            padding: var(--space-5);
            overflow-y: auto;
            max-height: calc(90vh - 140px);
        }

        .modal-footer {
            padding: var(--space-4) var(--space-5);
            border-top: 1px solid var(--border-subtle);
            display: flex;
            justify-content: flex-end;
            gap: var(--space-3);
        }

        /* ==================== Filter Panel ==================== */
        .filter-panel {
            background: var(--bg-subtle);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            margin-bottom: var(--space-5);
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-4);
            margin-bottom: var(--space-4);
        }

        .filter-item label {
            display: block;
            font-size: var(--text-xs);
            font-weight: 500;
            color: var(--text-tertiary);
            margin-bottom: var(--space-2);
        }

        .filter-item select,
        .filter-item input {
            width: 100%;
            padding: var(--space-2) var(--space-3);
            background: var(--bg-muted);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: var(--text-sm);
            font-family: inherit;
        }

        .filter-item select:focus,
        .filter-item input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .filter-actions {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .quick-filters {
            display: flex;
            gap: var(--space-2);
            margin-left: auto;
        }

        .quick-btn {
            padding: var(--space-1) var(--space-3);
            background: var(--bg-muted);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-full);
            color: var(--text-secondary);
            font-size: var(--text-xs);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .quick-btn:hover {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        /* ==================== Charts ==================== */
        .chart-container {
            height: 360px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-5);
        }

        /* ==================== Empty State ==================== */
        .empty-state {
            text-align: center;
            padding: var(--space-12) var(--space-6);
            color: var(--text-tertiary);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: var(--space-4);
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: var(--text-lg);
            color: var(--text-secondary);
            margin-bottom: var(--space-2);
        }

        .empty-state p {
            font-size: var(--text-sm);
        }

        /* ==================== Master-Detail Layout ==================== */
        .master-detail-layout {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 0;
            height: calc(100vh - 140px);
            background: var(--bg-base);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--border-subtle);
        }

        .master-panel {
            display: flex;
            flex-direction: column;
            background: var(--bg-subtle);
            border-right: 1px solid var(--border-subtle);
        }

        .master-header {
            padding: var(--space-4);
            border-bottom: 1px solid var(--border-subtle);
        }

        .search-box {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-3);
            background: var(--bg-muted);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-3);
        }

        .search-box i {
            color: var(--text-muted);
            font-size: 16px;
        }

        .search-box input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: var(--text-sm);
            outline: none;
        }

        .filter-row {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-3);
        }

        .filter-row select {
            flex: 1;
            padding: var(--space-2) var(--space-3);
            background: var(--bg-muted);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: var(--text-sm);
        }

        .quick-btns {
            display: flex;
            gap: var(--space-1);
        }

        .list-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .list-toolbar-left {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .list-count {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
        }

        .list-count strong {
            color: var(--text-primary);
        }

        .list-actions {
            display: flex;
            gap: var(--space-2);
        }

        .candidate-list {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-2);
        }

        .candidate-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            margin-bottom: var(--space-1);
        }

        .candidate-item:hover {
            background: var(--bg-muted);
        }

        .candidate-item.active {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
        }

        .candidate-item .checkbox {
            flex-shrink: 0;
        }

        .candidate-avatar {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-sm);
            font-weight: 600;
            color: white;
            flex-shrink: 0;
        }

        .candidate-info {
            flex: 1;
            min-width: 0;
        }

        .candidate-name {
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .candidate-meta {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .candidate-scores {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
        }

        .score-dot {
            width: 24px;
            height: 24px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            background: var(--bg-muted);
            color: var(--text-secondary);
        }

        .master-footer {
            padding: var(--space-3) var(--space-4);
            border-top: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* Detail Panel */
        .detail-panel {
            display: flex;
            flex-direction: column;
            background: var(--bg-base);
            overflow: hidden;
        }

        .detail-empty {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
        }

        .detail-empty i {
            font-size: 64px;
            margin-bottom: var(--space-4);
            opacity: 0.3;
        }

        .detail-empty h3 {
            font-size: var(--text-lg);
            color: var(--text-secondary);
            margin-bottom: var(--space-2);
        }

        .detail-empty p {
            font-size: var(--text-sm);
        }

        .detail-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-5);
        }

        .detail-header {
            display: flex;
            align-items: flex-start;
            gap: var(--space-4);
            margin-bottom: var(--space-5);
            padding-bottom: var(--space-5);
            border-bottom: 1px solid var(--border-subtle);
        }

        .detail-avatar {
            width: 72px;
            height: 72px;
            border-radius: var(--radius-lg);
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 700;
            color: white;
            flex-shrink: 0;
        }

        .detail-title {
            flex: 1;
        }

        .detail-name {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--space-1);
        }

        .detail-position {
            font-size: var(--text-sm);
            color: var(--text-tertiary);
            margin-bottom: var(--space-3);
        }

        .detail-tags {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
        }

        .detail-actions {
            display: flex;
            gap: var(--space-2);
        }

        .detail-section {
            margin-bottom: var(--space-5);
        }

        .detail-section-title {
            font-size: var(--text-xs);
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--space-3);
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-3);
        }

        .detail-item {
            padding: var(--space-3);
            background: var(--bg-subtle);
            border-radius: var(--radius-md);
        }

        .detail-item-label {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
            margin-bottom: var(--space-1);
        }

        .detail-item-value {
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--text-primary);
        }

        .dimension-bar {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3);
            background: var(--bg-subtle);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-2);
        }

        .dimension-label {
            width: 80px;
        }

        .dimension-label-title {
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--text-primary);
        }

        .dimension-label-sub {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
        }

        .dimension-progress {
            flex: 1;
            height: 8px;
            background: var(--bg-muted);
            border-radius: 4px;
            overflow: hidden;
        }

        .dimension-progress-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .dimension-value {
            width: 32px;
            text-align: right;
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-primary);
        }

        .traits-list {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
        }

        .analysis-card {
            padding: var(--space-4);
            background: var(--bg-subtle);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-3);
        }

        .analysis-card-title {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .analysis-card-title i {
            color: var(--accent-primary);
        }

        .analysis-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .analysis-list li {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            padding: var(--space-1) 0;
            padding-left: var(--space-4);
            position: relative;
        }

        .analysis-list li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent-primary);
        }

        .analysis-list.success li::before {
            background: var(--accent-success);
        }

        .analysis-list.warning li::before {
            background: var(--accent-warning);
        }

        /* ==================== Settings ==================== */
        .settings-section {
            margin-bottom: var(--space-6);
        }

        .settings-section:last-child {
            margin-bottom: 0;
        }

        .settings-title {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-4);
        }

        .settings-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-4);
            background: var(--bg-muted);
            border: 1px solid var(--border-subtle);
            border-radius: var(--radius-md);
        }

        .settings-item-info h4 {
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .settings-item-info p {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
        }

        .settings-item-actions {
            display: flex;
            gap: var(--space-2);
        }

        /* ==================== Info Grid ==================== */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-4);
            margin-bottom: var(--space-5);
        }

        .info-item {
            padding: var(--space-4);
            background: var(--bg-muted);
            border-radius: var(--radius-md);
        }

        .info-label {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
            margin-bottom: var(--space-1);
        }

        .info-value {
            font-size: var(--text-base);
            font-weight: 500;
            color: var(--text-primary);
        }

        .score-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-3);
            margin-bottom: var(--space-5);
        }

        .score-item {
            text-align: center;
            padding: var(--space-4);
            background: var(--bg-muted);
            border-radius: var(--radius-md);
        }

        .score-label {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
            margin-bottom: var(--space-2);
        }

        .score-value {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: var(--accent-primary);
        }

        .section-title {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-primary);
            margin: var(--space-5) 0 var(--space-3);
        }

        /* ==================== Assessment Tabs ==================== */
        .assessment-tabs {
            display: flex;
            gap: var(--space-1);
            padding: var(--space-1);
            background: var(--bg-muted);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-5);
        }

        .assessment-tab {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-4);
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: var(--text-sm);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .assessment-tab:hover {
            color: var(--text-primary);
            background: var(--bg-elevated);
        }

        .assessment-tab.active {
            background: var(--bg-subtle);
            color: var(--accent-primary);
            box-shadow: var(--shadow-sm);
        }

        .assessment-tab i {
            font-size: 18px;
        }

        .assessment-tab-content {
            display: none;
        }

        .assessment-tab-content.active {
            display: block;
        }

        /* Questionnaire Cards */
        .questionnaire-card {
            background: var(--bg-subtle);
            padding: var(--space-5);
            cursor: pointer;
            transition: var(--transition-fast);
            border: 2px solid transparent;
        }

        .questionnaire-card:hover {
            background: var(--bg-muted);
        }

        .questionnaire-card.active {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.05);
        }

        .questionnaire-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: var(--space-3);
        }

        .questionnaire-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .questionnaire-icon i {
            font-size: 24px;
            color: white;
        }

        .questionnaire-card h4 {
            font-size: var(--text-base);
            font-weight: 600;
            margin-bottom: var(--space-1);
        }

        .questionnaire-card p {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
            margin-bottom: var(--space-3);
        }

        .questionnaire-meta {
            display: flex;
            gap: var(--space-4);
            font-size: var(--text-xs);
            color: var(--text-secondary);
            margin-bottom: var(--space-3);
        }

        .questionnaire-meta i {
            margin-right: 4px;
        }

        .questionnaire-desc {
            font-size: var(--text-xs);
            color: var(--text-muted);
            line-height: 1.6;
            padding-top: var(--space-3);
            border-top: 1px solid var(--border-subtle);
        }

        /* Position List in Assessment */
        .position-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .position-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-4);
            border-bottom: 1px solid var(--border-subtle);
        }

        .position-item:last-child {
            border-bottom: none;
        }

        .position-info h4 {
            font-size: var(--text-sm);
            font-weight: 500;
            margin-bottom: var(--space-1);
        }

        .position-info p {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
        }

        .position-actions {
            display: flex;
            gap: var(--space-2);
        }

        .position-model-tags {
            display: flex;
            gap: 4px;
            margin-top: var(--space-1);
        }

        .mini-tag {
            padding: 2px 6px;
            background: var(--bg-muted);
            border-radius: var(--radius-sm);
            font-size: 10px;
            color: var(--text-tertiary);
        }

        /* Recent Candidates */
        .recent-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-4);
            border-bottom: 1px solid var(--border-subtle);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .recent-item:hover {
            background: var(--bg-muted);
        }

        .recent-item:last-child {
            border-bottom: none;
        }

        .recent-avatar {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-sm);
            font-weight: 600;
            color: white;
            flex-shrink: 0;
        }

        .recent-info {
            flex: 1;
            min-width: 0;
        }

        .recent-name {
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--text-primary);
        }

        .recent-meta {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
        }

        .recent-scores {
            display: flex;
            gap: var(--space-2);
            font-size: var(--text-xs);
            color: var(--text-secondary);
        }

        .recent-scores span {
            padding: 2px 6px;
            background: var(--bg-muted);
            border-radius: var(--radius-sm);
        }

        /* Questionnaire Detail Modal */
        .questionnaire-detail {
            padding: var(--space-2);
        }

        .qd-status {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            font-weight: 500;
            margin-bottom: var(--space-4);
        }

        .qd-status.enabled {
            background: rgba(34, 197, 94, 0.1);
            color: var(--accent-success);
        }

        .qd-status.disabled {
            background: rgba(245, 158, 11, 0.1);
            color: var(--accent-warning);
        }

        .qd-desc {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: var(--space-4);
        }

        .qd-stats {
            display: flex;
            gap: var(--space-4);
            margin-bottom: var(--space-5);
            padding: var(--space-4);
            background: var(--bg-muted);
            border-radius: var(--radius-md);
        }

        .qd-stat {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--text-sm);
            color: var(--text-secondary);
        }

        .qd-stat i {
            color: var(--accent-primary);
        }

        .qd-section-title {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-3);
        }

        .qd-dimensions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-3);
            margin-bottom: var(--space-5);
        }

        .qd-dimension {
            padding: var(--space-3);
            background: var(--bg-muted);
            border-radius: var(--radius-md);
        }

        .qd-dim-name {
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: var(--space-1);
        }

        .qd-dim-desc {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
        }

        .qd-coming-soon {
            text-align: center;
            padding: var(--space-6);
            background: var(--bg-muted);
            border-radius: var(--radius-md);
        }

        .qd-coming-soon i {
            font-size: 32px;
            color: var(--accent-warning);
            margin-bottom: var(--space-3);
        }

        .qd-coming-soon p {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            margin: 0;
        }

        .qd-tip {
            font-size: var(--text-xs) !important;
            color: var(--text-tertiary) !important;
            margin-top: var(--space-2) !important;
        }

        .qd-actions {
            display: flex;
            justify-content: center;
            padding-top: var(--space-4);
        }

        /* Model Type Tabs */
        .model-type-tabs {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-5);
        }

        .model-type-tab {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-3);
            background: var(--bg-muted);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: var(--text-sm);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .model-type-tab:hover {
            background: var(--bg-elevated);
            border-color: var(--border-strong);
        }

        .model-type-tab.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .model-type-content {
            display: none;
        }

        .model-type-content.active {
            display: block;
        }

        /* MBTI Model */
        .mbti-model-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-4);
        }

        .mbti-dimension {
            padding: var(--space-4);
            background: var(--bg-muted);
            border-radius: var(--radius-md);
        }

        .mbti-dim-label {
            font-size: var(--text-sm);
            font-weight: 500;
            margin-bottom: var(--space-3);
        }

        .mbti-dim-options {
            display: flex;
            gap: var(--space-2);
        }

        .mbti-option {
            flex: 1;
            padding: var(--space-2);
            background: var(--bg-subtle);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .mbti-option:hover {
            border-color: var(--accent-primary);
        }

        .mbti-option.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .mbti-result {
            margin-top: var(--space-4);
            padding: var(--space-3);
            background: var(--bg-muted);
            border-radius: var(--radius-md);
            text-align: center;
            font-size: var(--text-sm);
            color: var(--text-secondary);
        }

        .mbti-result strong {
            color: var(--accent-primary);
        }

        /* DISC Model */
        .disc-model-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-4);
        }

        .disc-model-item {
            padding: var(--space-4);
            background: var(--bg-muted);
            border-radius: var(--radius-md);
        }

        .disc-model-header {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-3);
        }

        .disc-badge {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-sm);
            font-weight: 700;
            color: white;
        }

        .disc-title {
            font-size: var(--text-sm);
            font-weight: 500;
        }

        .disc-desc {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
        }

        .disc-model-item input[type="range"] {
            width: 100%;
            margin-bottom: var(--space-2);
        }

        .disc-value {
            text-align: right;
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--accent-primary);
        }

        .disc-total {
            margin-top: var(--space-4);
            padding: var(--space-3);
            background: var(--bg-muted);
            border-radius: var(--radius-md);
            text-align: center;
            font-size: var(--text-sm);
            color: var(--text-secondary);
        }

        .disc-total strong {
            color: var(--accent-primary);
        }

        /* Position Model Modal Tabs */
        .pos-model-tabs {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
        }

        .pos-model-tab {
            flex: 1;
            padding: var(--space-2);
            background: var(--bg-muted);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .pos-model-tab:hover {
            background: var(--bg-elevated);
        }

        .pos-model-tab.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .pos-model-content {
            display: none;
        }

        .pos-model-content.active {
            display: block;
        }

        .mbti-mini-dim {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2);
            background: var(--bg-muted);
            border-radius: var(--radius-sm);
        }

        .mbti-mini-dim span {
            font-size: var(--text-xs);
            font-weight: 500;
            color: var(--text-secondary);
            min-width: 30px;
        }

        .mbti-mini-dim select {
            flex: 1;
            padding: var(--space-1) var(--space-2);
            background: var(--bg-subtle);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            color: var(--text-primary);
        }

        /* Import Actions */
        .import-actions {
            display: flex;
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }

        .import-tips {
            background: var(--bg-muted);
            border-radius: var(--radius-md);
            padding: var(--space-4);
        }

        .tip-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-2);
            font-size: var(--text-xs);
            color: var(--text-tertiary);
            margin-bottom: var(--space-2);
        }

        .tip-item:last-child {
            margin-bottom: 0;
        }

        .tip-item i {
            color: var(--accent-info);
            flex-shrink: 0;
            margin-top: 2px;
        }

        /* Ideal Model Grid */
        .ideal-model-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-4);
        }

        .ideal-model-item {
            padding: var(--space-4);
            background: var(--bg-muted);
            border-radius: var(--radius-md);
        }

        .ideal-model-header {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }

        .ideal-model-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-sm);
            font-weight: 700;
            color: white;
        }

        .ideal-model-title {
            font-size: var(--text-sm);
            font-weight: 500;
        }

        .ideal-model-desc {
            font-size: var(--text-xs);
            color: var(--text-tertiary);
        }

        .ideal-model-item input[type="range"] {
            width: 100%;
            margin-bottom: var(--space-2);
        }

        .ideal-model-values {
            display: flex;
            justify-content: space-between;
            font-size: var(--text-xs);
            color: var(--text-tertiary);
        }

        .ideal-model-current {
            color: var(--accent-primary);
            font-weight: 600;
        }

        /* Theme Buttons */
        .theme-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-4);
            background: var(--bg-muted);
            border: 2px solid var(--border-default);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .theme-btn:hover {
            border-color: var(--border-strong);
        }

        .theme-btn.active {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.05);
        }

        .theme-btn span {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .theme-preview {
            width: 100%;
            height: 60px;
            border-radius: var(--radius-sm);
            display: flex;
            overflow: hidden;
        }

        .theme-preview.light {
            background: #f8fafc;
        }

        .theme-preview.dark {
            background: #0f0f12;
        }

        .theme-preview-sidebar {
            width: 30%;
            background: rgba(0,0,0,0.1);
        }

        .theme-preview.dark .theme-preview-sidebar {
            background: rgba(255,255,255,0.05);
        }

        .theme-preview-content {
            flex: 1;
        }
    </style>
</head>
<body data-theme="dark">
    <!-- Login Page -->
    <div id="loginPage">
        <div class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <div class="login-logo">
                        <i class="ri-user-search-line"></i>
                    </div>
                    <h1 class="login-title">TalentLens</h1>
                    <p class="login-subtitle">智能人才洞察平台</p>
                </div>
                
                <div class="login-error" id="loginError"></div>
                
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label">管理员密码</label>
                        <input type="password" class="form-input" id="passwordInput" placeholder="请输入密码" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">
                        登录系统
                    </button>
                </form>
                
                <p class="login-hint">默认密码: epq_admin_123</p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon">
                        <i class="ri-user-search-line"></i>
                    </div>
                    <span class="sidebar-logo-text">TalentLens</span>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">概览</div>
                    <div class="nav-item active" data-page="dashboard" onclick="navigateTo('dashboard')">
                        <i class="ri-dashboard-3-line"></i>
                        <span>数据概览</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">管理</div>
                    <div class="nav-item" data-page="candidates" onclick="navigateTo('candidates')">
                        <i class="ri-user-line"></i>
                        <span>候选人</span>
                    </div>
                    <div class="nav-item" data-page="resumes" onclick="navigateTo('resumes')">
                        <i class="ri-file-text-line"></i>
                        <span>简历库</span>
                    </div>
                    <div class="nav-item" data-page="assessments" onclick="navigateTo('assessments')">
                        <i class="ri-survey-line"></i>
                        <span>测评中心</span>
                    </div>
                    <div class="nav-item" data-page="analytics" onclick="navigateTo('analytics')">
                        <i class="ri-pie-chart-line"></i>
                        <span>智能分析</span>
                    </div>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">系统</div>
                    <div class="nav-item" data-page="settings" onclick="navigateTo('settings')">
                        <i class="ri-settings-3-line"></i>
                        <span>系统设置</span>
                    </div>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <div class="user-card" onclick="handleLogout()">
                    <div class="user-avatar">A</div>
                    <div class="user-info">
                        <div class="user-name">Admin</div>
                        <div class="user-role">点击退出</div>
                    </div>
                    <i class="ri-logout-box-r-line" style="color: var(--text-tertiary);"></i>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <div class="header-left">
                    <h1 class="page-title" id="pageTitle">数据概览</h1>
                </div>
                <div class="header-right">
                    <div class="search-box">
                        <i class="ri-search-line search-icon"></i>
                        <input type="text" class="search-input" placeholder="搜索候选人..." id="globalSearch">
                    </div>
                    <div class="theme-switcher">
                        <button class="btn btn-ghost btn-icon" onclick="toggleTheme()" id="themeBtn" title="切换主题">
                            <i class="ri-moon-line" id="themeIcon"></i>
                        </button>
                    </div>
                </div>
            </header>

            <div class="main-body">
                <!-- Dashboard - 丰富版 -->
                <div class="page-view active" id="page-dashboard">
                    <!-- 统计卡片 -->
                    <div class="stats-grid" id="statsGrid"></div>
                    
                    <!-- 图表区域 -->
                    <div class="charts-grid">
                        <!-- 岗位分布 -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">岗位分布</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" id="positionChart"></div>
                            </div>
                        </div>
                        <!-- 匹配度分布 -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">匹配度分布</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" id="matchChart"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 第二行图表 -->
                    <div class="charts-grid" style="margin-top:var(--space-5);">
                        <!-- EPQ 维度均值 -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">EPQ 维度均值对比</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" id="epqAvgChart"></div>
                            </div>
                        </div>
                        <!-- 测评趋势 -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">测评趋势</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" id="trendChart"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 最近测评 -->
                    <div class="card" style="margin-top:var(--space-5);">
                        <div class="card-header">
                            <h3 class="card-title">最近测评</h3>
                            <button class="btn btn-secondary btn-sm" onclick="navigateTo('candidates')">
                                查看全部 <i class="ri-arrow-right-line"></i>
                            </button>
                        </div>
                        <div class="card-body" style="padding:0;">
                            <div id="recentCandidates"></div>
                        </div>
                    </div>
                </div>

                <!-- Candidates - Master-Detail Layout -->
                <div class="page-view" id="page-candidates">
                    <div class="master-detail-layout">
                        <!-- 左侧：候选人列表 -->
                        <div class="master-panel">
                            <!-- 搜索筛选 -->
                            <div class="master-header">
                                <div class="search-box">
                                    <i class="ri-search-line"></i>
                                    <input type="text" id="filterKeyword" placeholder="搜索姓名或手机号..." oninput="debounceFilter()">
                                </div>
                                <div class="filter-row">
                                    <select id="filterPosition" onchange="applyCandidateFilters()">
                                        <option value="">全部岗位</option>
                                    </select>
                                    <div class="quick-btns">
                                        <button class="quick-btn" onclick="quickDateFilter(7)">7天</button>
                                        <button class="quick-btn" onclick="quickDateFilter(30)">30天</button>
                                    </div>
                                </div>
                                <div class="list-toolbar">
                                    <div class="list-toolbar-left">
                                        <input type="checkbox" class="checkbox" id="selectAllCandidates" onchange="toggleSelectAllCandidates()" title="全选当前页">
                                        <span class="list-count">共 <strong id="totalCount">0</strong> 人，已选 <strong id="selectedCount">0</strong></span>
                                    </div>
                                    <div class="list-actions">
                                        <button class="btn btn-danger btn-sm" onclick="batchDelete()" id="batchDeleteBtn" disabled>
                                            <i class="ri-delete-bin-line"></i> 删除
                                        </button>
                                        <button class="icon-btn" onclick="exportFilteredData()" title="导出">
                                            <i class="ri-download-line"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <!-- 候选人列表 -->
                            <div class="candidate-list" id="candidateList">
                                <!-- 动态生成 -->
                            </div>
                            <!-- 分页 -->
                            <div class="master-footer">
                                <div class="pagination-info" id="paginationInfo"></div>
                                <div class="pagination-controls" id="paginationControls"></div>
                            </div>
                        </div>
                        
                        <!-- 右侧：候选人详情 -->
                        <div class="detail-panel" id="detailPanel">
                            <div class="detail-empty" id="detailEmpty">
                                <i class="ri-user-search-line"></i>
                                <h3>选择候选人查看详情</h3>
                                <p>点击左侧列表中的候选人</p>
                            </div>
                            <div class="detail-content" id="detailContent" style="display:none;">
                                <!-- 动态生成 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics -->
                <div class="page-view" id="page-analytics">
                    <div class="filter-panel">
                        <div class="filter-actions">
                            <div class="filter-item" style="width: 200px;">
                                <select id="analyticsPosition" onchange="refreshAnalytics()">
                                    <option value="">全部岗位</option>
                                </select>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="refreshAnalytics()">
                                <i class="ri-refresh-line"></i> 刷新
                            </button>
                        </div>
                    </div>
                    <div class="charts-grid">
                        <div class="card">
                            <div class="card-header"><h3 class="card-title">岗位匹配度</h3></div>
                            <div class="card-body"><div class="chart-container" id="matchRadarChart"></div></div>
                        </div>
                        <div class="card">
                            <div class="card-header"><h3 class="card-title">竞争力排名</h3></div>
                            <div class="card-body"><div class="chart-container" id="competitiveChart"></div></div>
                        </div>
                        <div class="card">
                            <div class="card-header"><h3 class="card-title">人格分布</h3></div>
                            <div class="card-body"><div class="chart-container" id="personalityChart"></div></div>
                        </div>
                        <div class="card">
                            <div class="card-header"><h3 class="card-title">维度对比</h3></div>
                            <div class="card-body"><div class="chart-container" id="dimensionChart"></div></div>
                        </div>
                    </div>
                </div>

                <!-- Resumes -->
                <div class="page-view" id="page-resumes">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">简历库</h3>
                            <button class="btn btn-primary btn-sm" onclick="showUploadResumeModal()">
                                <i class="ri-upload-line"></i> 上传简历
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="empty-state">
                                <i class="ri-file-text-line"></i>
                                <h3>简历功能开发中</h3>
                                <p>即将支持 PDF/图片简历上传和 AI 解析</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Assessments - 测评中心完整版 -->
                <div class="page-view" id="page-assessments">
                    <!-- 顶部Tab切换 -->
                    <div class="assessment-tabs">
                        <button class="assessment-tab active" data-tab="distribute" onclick="switchAssessmentTab('distribute')">
                            <i class="ri-send-plane-line"></i> 测评分发
                        </button>
                        <button class="assessment-tab" data-tab="questionnaires" onclick="switchAssessmentTab('questionnaires')">
                            <i class="ri-file-list-3-line"></i> 问卷管理
                        </button>
                        <button class="assessment-tab" data-tab="positions" onclick="switchAssessmentTab('positions')">
                            <i class="ri-briefcase-line"></i> 岗位管理
                        </button>
                        <button class="assessment-tab" data-tab="idealModel" onclick="switchAssessmentTab('idealModel')">
                            <i class="ri-radar-line"></i> 理想模型
                        </button>
                    </div>

                    <!-- Tab内容：测评分发 -->
                    <div class="assessment-tab-content active" id="tab-distribute">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">快速分发测评</h3>
                            </div>
                            <div class="card-body">
                                <div style="display:grid;grid-template-columns:1fr auto;gap:var(--space-4);align-items:end;">
                                    <div>
                                        <label style="display:block;font-size:var(--text-xs);color:var(--text-tertiary);margin-bottom:var(--space-2);">EPQ 测评链接</label>
                                        <div style="display:flex;gap:var(--space-2);">
                                            <input type="text" class="form-input" id="testLink" readonly style="flex:1;font-family:var(--font-mono);font-size:var(--text-sm);">
                                            <button class="btn btn-primary" onclick="copyTestLink()"><i class="ri-file-copy-line"></i> 复制</button>
                                        </div>
                                    </div>
                                    <button class="btn btn-secondary" onclick="generateQRCode()"><i class="ri-qr-code-line"></i> 二维码</button>
                                </div>
                                <div style="margin-top:var(--space-5);display:grid;grid-template-columns:repeat(3,1fr);gap:var(--space-4);">
                                    <div style="text-align:center;padding:var(--space-4);background:var(--bg-muted);border-radius:var(--radius-md);">
                                        <div style="width:48px;height:48px;margin:0 auto var(--space-3);background:rgba(99,102,241,0.1);border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;">
                                            <i class="ri-send-plane-line" style="font-size:20px;color:var(--accent-primary);"></i>
                                        </div>
                                        <div style="font-size:var(--text-sm);font-weight:500;margin-bottom:var(--space-1);">1. 发送链接</div>
                                        <div style="font-size:var(--text-xs);color:var(--text-tertiary);">通过微信/邮件发送</div>
                                    </div>
                                    <div style="text-align:center;padding:var(--space-4);background:var(--bg-muted);border-radius:var(--radius-md);">
                                        <div style="width:48px;height:48px;margin:0 auto var(--space-3);background:rgba(34,197,94,0.1);border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;">
                                            <i class="ri-edit-line" style="font-size:20px;color:var(--accent-success);"></i>
                                        </div>
                                        <div style="font-size:var(--text-sm);font-weight:500;margin-bottom:var(--space-1);">2. 完成测评</div>
                                        <div style="font-size:var(--text-xs);color:var(--text-tertiary);">候选人填写并答题</div>
                                    </div>
                                    <div style="text-align:center;padding:var(--space-4);background:var(--bg-muted);border-radius:var(--radius-md);">
                                        <div style="width:48px;height:48px;margin:0 auto var(--space-3);background:rgba(245,158,11,0.1);border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;">
                                            <i class="ri-bar-chart-box-line" style="font-size:20px;color:var(--accent-warning);"></i>
                                        </div>
                                        <div style="font-size:var(--text-sm);font-weight:500;margin-bottom:var(--space-1);">3. 查看分析</div>
                                        <div style="font-size:var(--text-xs);color:var(--text-tertiary);">在候选人管理查看</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab内容：问卷管理 -->
                    <div class="assessment-tab-content" id="tab-questionnaires">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">测评问卷库</h3>
                            </div>
                            <div class="card-body" style="padding:0;">
                                <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:1px;background:var(--border-subtle);">
                                    <!-- EPQ -->
                                    <div class="questionnaire-card active" onclick="selectQuestionnaire('epq')">
                                        <div class="questionnaire-header">
                                            <div class="questionnaire-icon" style="background:var(--gradient-primary);">
                                                <i class="ri-mental-health-line"></i>
                                            </div>
                                            <span class="tag excellent">已启用</span>
                                        </div>
                                        <h4>EPQ 人格测评</h4>
                                        <p>艾森克人格问卷 · 评估性格特质</p>
                                        <div class="questionnaire-meta">
                                            <span><i class="ri-file-list-line"></i> 48题</span>
                                            <span><i class="ri-time-line"></i> ~5分钟</span>
                                            <span><i class="ri-radar-line"></i> E/N/P/L</span>
                                        </div>
                                        <div class="questionnaire-desc">
                                            测量外向性、神经质、精神质和掩饰性四个维度，广泛用于人才选拔和职业指导。
                                        </div>
                                    </div>
                                    <!-- MBTI -->
                                    <div class="questionnaire-card" onclick="selectQuestionnaire('mbti')">
                                        <div class="questionnaire-header">
                                            <div class="questionnaire-icon" style="background:var(--gradient-cool);">
                                                <i class="ri-user-star-line"></i>
                                            </div>
                                            <span class="tag medium"><i class="ri-add-line"></i> 可启用</span>
                                        </div>
                                        <h4>MBTI 职业性格</h4>
                                        <p>16型人格 · 职业倾向分析</p>
                                        <div class="questionnaire-meta">
                                            <span><i class="ri-file-list-line"></i> 93题</span>
                                            <span><i class="ri-time-line"></i> ~15分钟</span>
                                            <span><i class="ri-group-line"></i> 16类型</span>
                                        </div>
                                        <div class="questionnaire-desc">
                                            基于荣格心理类型理论，从四个维度划分16种人格类型，适合职业规划。
                                        </div>
                                    </div>
                                    <!-- DISC -->
                                    <div class="questionnaire-card" onclick="selectQuestionnaire('disc')">
                                        <div class="questionnaire-header">
                                            <div class="questionnaire-icon" style="background:var(--gradient-success);">
                                                <i class="ri-team-line"></i>
                                            </div>
                                            <span class="tag medium"><i class="ri-add-line"></i> 可启用</span>
                                        </div>
                                        <h4>DISC 行为风格</h4>
                                        <p>沟通风格 · 团队协作分析</p>
                                        <div class="questionnaire-meta">
                                            <span><i class="ri-file-list-line"></i> 28题</span>
                                            <span><i class="ri-time-line"></i> ~8分钟</span>
                                            <span><i class="ri-pie-chart-line"></i> D/I/S/C</span>
                                        </div>
                                        <div class="questionnaire-desc">
                                            评估支配型、影响型、稳健型、谨慎型四种行为风格，适合团队建设。
                                        </div>
                                    </div>
                                    <!-- 价值观 -->
                                    <div class="questionnaire-card" onclick="selectQuestionnaire('values')">
                                        <div class="questionnaire-header">
                                            <div class="questionnaire-icon" style="background:var(--gradient-warm);">
                                                <i class="ri-heart-line"></i>
                                            </div>
                                            <span class="tag info">规划中</span>
                                        </div>
                                        <h4>职业价值观</h4>
                                        <p>价值取向 · 文化匹配分析</p>
                                        <div class="questionnaire-meta">
                                            <span><i class="ri-file-list-line"></i> 40题</span>
                                            <span><i class="ri-time-line"></i> ~10分钟</span>
                                            <span><i class="ri-compass-line"></i> 8维度</span>
                                        </div>
                                        <div class="questionnaire-desc">
                                            评估职业价值取向，帮助判断候选人与企业文化的匹配程度。
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 题库导入功能 -->
                        <div class="card" style="margin-top:var(--space-5);">
                            <div class="card-header">
                                <h3 class="card-title"><i class="ri-upload-cloud-line"></i> 自定义题库</h3>
                            </div>
                            <div class="card-body">
                                <p style="font-size:var(--text-sm);color:var(--text-tertiary);margin-bottom:var(--space-4);">
                                    支持导入自定义问卷题目，格式为 JSON 或 CSV 文件。
                                </p>
                                <div class="import-actions">
                                    <button class="btn btn-secondary" onclick="downloadQuestionnaireTemplate()">
                                        <i class="ri-download-line"></i> 下载模板
                                    </button>
                                    <button class="btn btn-primary" onclick="document.getElementById('questionnaireImportFile').click()">
                                        <i class="ri-upload-line"></i> 导入题库
                                    </button>
                                    <input type="file" id="questionnaireImportFile" accept=".json,.csv" style="display:none" onchange="importQuestionnaire(event)">
                                </div>
                                <div class="import-tips">
                                    <div class="tip-item">
                                        <i class="ri-information-line"></i>
                                        <span>JSON 格式：包含 questions 数组，每个问题需有 id、text、dimension 字段</span>
                                    </div>
                                    <div class="tip-item">
                                        <i class="ri-information-line"></i>
                                        <span>CSV 格式：列名为 id, text, dimension, positive（是/否题）或 optionA, optionB（选择题）</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab内容：岗位管理 -->
                    <div class="assessment-tab-content" id="tab-positions">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">岗位管理</h3>
                                <button class="btn btn-primary btn-sm" onclick="showAddPositionModal()">
                                    <i class="ri-add-line"></i> 添加岗位
                                </button>
                            </div>
                            <div class="card-body" style="padding:0;">
                                <div class="position-list" id="positionListAssessment"></div>
                            </div>
                        </div>
                        <div class="card" style="margin-top:var(--space-5);">
                            <div class="card-header">
                                <h3 class="card-title">岗位说明</h3>
                            </div>
                            <div class="card-body">
                                <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:var(--space-4);">
                                    <div style="padding:var(--space-4);background:var(--bg-muted);border-radius:var(--radius-md);">
                                        <div style="display:flex;align-items:center;gap:var(--space-2);margin-bottom:var(--space-2);">
                                            <i class="ri-information-line" style="color:var(--accent-info);"></i>
                                            <span style="font-size:var(--text-sm);font-weight:500;">岗位用途</span>
                                        </div>
                                        <p style="font-size:var(--text-xs);color:var(--text-tertiary);margin:0;line-height:1.6;">
                                            岗位信息会显示在测评页面供候选人选择，同时用于后台的筛选和匹配度计算。
                                        </p>
                                    </div>
                                    <div style="padding:var(--space-4);background:var(--bg-muted);border-radius:var(--radius-md);">
                                        <div style="display:flex;align-items:center;gap:var(--space-2);margin-bottom:var(--space-2);">
                                            <i class="ri-lightbulb-line" style="color:var(--accent-warning);"></i>
                                            <span style="font-size:var(--text-sm);font-weight:500;">最佳实践</span>
                                        </div>
                                        <p style="font-size:var(--text-xs);color:var(--text-tertiary);margin:0;line-height:1.6;">
                                            建议为每个岗位设置对应的理想人才模型，以获得更精准的匹配度分析。
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab内容：理想人才模型 -->
                    <div class="assessment-tab-content" id="tab-idealModel">
                        <!-- 问卷类型切换 -->
                        <div class="model-type-tabs">
                            <button class="model-type-tab active" data-type="epq" onclick="switchModelType('epq')">
                                <i class="ri-mental-health-line"></i> EPQ
                            </button>
                            <button class="model-type-tab" data-type="mbti" onclick="switchModelType('mbti')">
                                <i class="ri-user-star-line"></i> MBTI
                            </button>
                            <button class="model-type-tab" data-type="disc" onclick="switchModelType('disc')">
                                <i class="ri-team-line"></i> DISC
                            </button>
                        </div>

                        <!-- EPQ 理想模型 -->
                        <div class="model-type-content active" id="model-epq">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">EPQ 理想人才模型</h3>
                                    <button class="btn btn-primary btn-sm" onclick="saveIdealModel('epq')">
                                        <i class="ri-save-line"></i> 保存
                                    </button>
                                </div>
                                <div class="card-body">
                                    <p style="font-size:var(--text-sm);color:var(--text-tertiary);margin-bottom:var(--space-4);">
                                        设置 EPQ 各维度的理想分值（0-24分），用于计算候选人匹配度。
                                    </p>
                                    <div class="ideal-model-grid">
                                        <div class="ideal-model-item">
                                            <div class="ideal-model-header">
                                                <div class="ideal-model-icon" style="background:var(--accent-primary);">E</div>
                                                <div>
                                                    <div class="ideal-model-title">外向性</div>
                                                    <div class="ideal-model-desc">社交能力、活力</div>
                                                </div>
                                            </div>
                                            <input type="range" id="idealE" min="0" max="24" value="18" oninput="updateIdealDisplay('E')">
                                            <div class="ideal-model-values">
                                                <span>0</span>
                                                <span class="ideal-model-current" id="idealEVal">18</span>
                                                <span>24</span>
                                            </div>
                                        </div>
                                        <div class="ideal-model-item">
                                            <div class="ideal-model-header">
                                                <div class="ideal-model-icon" style="background:var(--accent-warning);">N</div>
                                                <div>
                                                    <div class="ideal-model-title">神经质</div>
                                                    <div class="ideal-model-desc">情绪稳定性</div>
                                                </div>
                                            </div>
                                            <input type="range" id="idealN" min="0" max="24" value="8" oninput="updateIdealDisplay('N')">
                                            <div class="ideal-model-values">
                                                <span>0</span>
                                                <span class="ideal-model-current" id="idealNVal">8</span>
                                                <span>24</span>
                                            </div>
                                        </div>
                                        <div class="ideal-model-item">
                                            <div class="ideal-model-header">
                                                <div class="ideal-model-icon" style="background:var(--accent-info);">P</div>
                                                <div>
                                                    <div class="ideal-model-title">精神质</div>
                                                    <div class="ideal-model-desc">独立性、创造力</div>
                                                </div>
                                            </div>
                                            <input type="range" id="idealP" min="0" max="24" value="10" oninput="updateIdealDisplay('P')">
                                            <div class="ideal-model-values">
                                                <span>0</span>
                                                <span class="ideal-model-current" id="idealPVal">10</span>
                                                <span>24</span>
                                            </div>
                                        </div>
                                        <div class="ideal-model-item">
                                            <div class="ideal-model-header">
                                                <div class="ideal-model-icon" style="background:var(--accent-success);">L</div>
                                                <div>
                                                    <div class="ideal-model-title">掩饰性</div>
                                                    <div class="ideal-model-desc">诚实程度</div>
                                                </div>
                                            </div>
                                            <input type="range" id="idealL" min="0" max="24" value="15" oninput="updateIdealDisplay('L')">
                                            <div class="ideal-model-values">
                                                <span>0</span>
                                                <span class="ideal-model-current" id="idealLVal">15</span>
                                                <span>24</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- MBTI 理想模型 -->
                        <div class="model-type-content" id="model-mbti">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">MBTI 理想人才模型</h3>
                                    <button class="btn btn-primary btn-sm" onclick="saveIdealModel('mbti')">
                                        <i class="ri-save-line"></i> 保存
                                    </button>
                                </div>
                                <div class="card-body">
                                    <p style="font-size:var(--text-sm);color:var(--text-tertiary);margin-bottom:var(--space-4);">
                                        选择该岗位理想的 MBTI 人格类型或维度倾向。
                                    </p>
                                    <div class="mbti-model-grid">
                                        <div class="mbti-dimension">
                                            <div class="mbti-dim-label">能量来源</div>
                                            <div class="mbti-dim-options">
                                                <button class="mbti-option" data-dim="EI" data-val="E" onclick="toggleMbtiOption(this)">E 外向</button>
                                                <button class="mbti-option" data-dim="EI" data-val="I" onclick="toggleMbtiOption(this)">I 内向</button>
                                                <button class="mbti-option active" data-dim="EI" data-val="any" onclick="toggleMbtiOption(this)">不限</button>
                                            </div>
                                        </div>
                                        <div class="mbti-dimension">
                                            <div class="mbti-dim-label">信息收集</div>
                                            <div class="mbti-dim-options">
                                                <button class="mbti-option" data-dim="SN" data-val="S" onclick="toggleMbtiOption(this)">S 感觉</button>
                                                <button class="mbti-option" data-dim="SN" data-val="N" onclick="toggleMbtiOption(this)">N 直觉</button>
                                                <button class="mbti-option active" data-dim="SN" data-val="any" onclick="toggleMbtiOption(this)">不限</button>
                                            </div>
                                        </div>
                                        <div class="mbti-dimension">
                                            <div class="mbti-dim-label">决策方式</div>
                                            <div class="mbti-dim-options">
                                                <button class="mbti-option" data-dim="TF" data-val="T" onclick="toggleMbtiOption(this)">T 思考</button>
                                                <button class="mbti-option" data-dim="TF" data-val="F" onclick="toggleMbtiOption(this)">F 情感</button>
                                                <button class="mbti-option active" data-dim="TF" data-val="any" onclick="toggleMbtiOption(this)">不限</button>
                                            </div>
                                        </div>
                                        <div class="mbti-dimension">
                                            <div class="mbti-dim-label">生活方式</div>
                                            <div class="mbti-dim-options">
                                                <button class="mbti-option" data-dim="JP" data-val="J" onclick="toggleMbtiOption(this)">J 判断</button>
                                                <button class="mbti-option" data-dim="JP" data-val="P" onclick="toggleMbtiOption(this)">P 感知</button>
                                                <button class="mbti-option active" data-dim="JP" data-val="any" onclick="toggleMbtiOption(this)">不限</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mbti-result" id="mbtiIdealResult">
                                        当前理想类型：<strong>不限</strong>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- DISC 理想模型 -->
                        <div class="model-type-content" id="model-disc">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">DISC 理想人才模型</h3>
                                    <button class="btn btn-primary btn-sm" onclick="saveIdealModel('disc')">
                                        <i class="ri-save-line"></i> 保存
                                    </button>
                                </div>
                                <div class="card-body">
                                    <p style="font-size:var(--text-sm);color:var(--text-tertiary);margin-bottom:var(--space-4);">
                                        设置该岗位理想的 DISC 行为风格权重（总和建议为100%）。
                                    </p>
                                    <div class="disc-model-grid">
                                        <div class="disc-model-item" style="border-left:3px solid #ef4444;">
                                            <div class="disc-model-header">
                                                <span class="disc-badge" style="background:#ef4444;">D</span>
                                                <div>
                                                    <div class="disc-title">支配型 Dominance</div>
                                                    <div class="disc-desc">结果导向、决断力强</div>
                                                </div>
                                            </div>
                                            <input type="range" id="idealD" min="0" max="100" value="25" oninput="updateDiscDisplay()">
                                            <div class="disc-value"><span id="idealDVal">25</span>%</div>
                                        </div>
                                        <div class="disc-model-item" style="border-left:3px solid #f59e0b;">
                                            <div class="disc-model-header">
                                                <span class="disc-badge" style="background:#f59e0b;">I</span>
                                                <div>
                                                    <div class="disc-title">影响型 Influence</div>
                                                    <div class="disc-desc">热情乐观、善于社交</div>
                                                </div>
                                            </div>
                                            <input type="range" id="idealI" min="0" max="100" value="25" oninput="updateDiscDisplay()">
                                            <div class="disc-value"><span id="idealIVal">25</span>%</div>
                                        </div>
                                        <div class="disc-model-item" style="border-left:3px solid #22c55e;">
                                            <div class="disc-model-header">
                                                <span class="disc-badge" style="background:#22c55e;">S</span>
                                                <div>
                                                    <div class="disc-title">稳健型 Steadiness</div>
                                                    <div class="disc-desc">耐心可靠、团队协作</div>
                                                </div>
                                            </div>
                                            <input type="range" id="idealS" min="0" max="100" value="25" oninput="updateDiscDisplay()">
                                            <div class="disc-value"><span id="idealSVal">25</span>%</div>
                                        </div>
                                        <div class="disc-model-item" style="border-left:3px solid #3b82f6;">
                                            <div class="disc-model-header">
                                                <span class="disc-badge" style="background:#3b82f6;">C</span>
                                                <div>
                                                    <div class="disc-title">谨慎型 Conscientiousness</div>
                                                    <div class="disc-desc">注重细节、追求完美</div>
                                                </div>
                                            </div>
                                            <input type="range" id="idealC" min="0" max="100" value="25" oninput="updateDiscDisplay()">
                                            <div class="disc-value"><span id="idealCVal">25</span>%</div>
                                        </div>
                                    </div>
                                    <div class="disc-total" id="discTotal">
                                        权重总和：<strong>100%</strong>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 模型说明 -->
                        <div class="card" style="margin-top:var(--space-5);">
                            <div class="card-header">
                                <h3 class="card-title">模型说明</h3>
                            </div>
                            <div class="card-body">
                                <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:var(--space-4);">
                                    <div style="padding:var(--space-4);background:var(--bg-muted);border-radius:var(--radius-md);">
                                        <div style="display:flex;align-items:center;gap:var(--space-2);margin-bottom:var(--space-2);">
                                            <i class="ri-calculator-line" style="color:var(--accent-primary);"></i>
                                            <span style="font-size:var(--text-sm);font-weight:500;">匹配度计算</span>
                                        </div>
                                        <p style="font-size:var(--text-xs);color:var(--text-tertiary);margin:0;line-height:1.6;">
                                            系统会计算候选人各维度分数与理想值的差异，差异越小匹配度越高。
                                        </p>
                                    </div>
                                    <div style="padding:var(--space-4);background:var(--bg-muted);border-radius:var(--radius-md);">
                                        <div style="display:flex;align-items:center;gap:var(--space-2);margin-bottom:var(--space-2);">
                                            <i class="ri-settings-3-line" style="color:var(--accent-warning);"></i>
                                            <span style="font-size:var(--text-sm);font-weight:500;">调整建议</span>
                                        </div>
                                        <p style="font-size:var(--text-xs);color:var(--text-tertiary);margin:0;line-height:1.6;">
                                            不同岗位可能需要不同的理想模型，建议根据实际招聘需求调整各维度值。
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings - 精简版 -->
                <div class="page-view" id="page-settings">
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:var(--space-5);">
                        <!-- 左列 -->
                        <div>
                            <!-- 账户管理 -->
                            <div class="card" style="margin-bottom:var(--space-5);">
                                <div class="card-header">
                                    <h3 class="card-title"><i class="ri-user-settings-line" style="margin-right:var(--space-2);"></i>账户管理</h3>
                                </div>
                                <div class="card-body">
                                    <div class="settings-item" style="padding:var(--space-4);background:var(--bg-muted);border-radius:var(--radius-md);margin-bottom:var(--space-3);">
                                        <div style="display:flex;align-items:center;justify-content:space-between;">
                                            <div>
                                                <div style="font-size:var(--text-sm);font-weight:500;margin-bottom:var(--space-1);">管理员密码</div>
                                                <div style="font-size:var(--text-xs);color:var(--text-tertiary);">当前密码: ••••••••••••</div>
                                            </div>
                                            <button class="btn btn-secondary btn-sm" onclick="showChangePasswordModal()">
                                                <i class="ri-lock-line"></i> 修改
                                            </button>
                                        </div>
                                    </div>
                                    <div class="settings-item" style="padding:var(--space-4);background:var(--bg-muted);border-radius:var(--radius-md);">
                                        <div style="display:flex;align-items:center;justify-content:space-between;">
                                            <div>
                                                <div style="font-size:var(--text-sm);font-weight:500;margin-bottom:var(--space-1);">登录状态</div>
                                                <div style="font-size:var(--text-xs);color:var(--text-tertiary);" id="loginTimeDisplay">已登录</div>
                                            </div>
                                            <span class="tag excellent">在线</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 数据管理 -->
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title"><i class="ri-database-2-line" style="margin-right:var(--space-2);"></i>数据管理</h3>
                                </div>
                                <div class="card-body">
                                    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:var(--space-3);margin-bottom:var(--space-4);">
                                        <button class="btn btn-secondary" onclick="generateTestData()" style="flex-direction:column;padding:var(--space-4);">
                                            <i class="ri-magic-line" style="font-size:24px;margin-bottom:var(--space-2);color:var(--accent-primary);"></i>
                                            <span>生成测试数据</span>
                                        </button>
                                        <button class="btn btn-secondary" onclick="backupData()" style="flex-direction:column;padding:var(--space-4);">
                                            <i class="ri-download-cloud-line" style="font-size:24px;margin-bottom:var(--space-2);"></i>
                                            <span>备份</span>
                                        </button>
                                        <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()" style="flex-direction:column;padding:var(--space-4);">
                                            <i class="ri-upload-cloud-line" style="font-size:24px;margin-bottom:var(--space-2);"></i>
                                            <span>导入</span>
                                        </button>
                                        <button class="btn btn-danger" onclick="clearAllData()" style="flex-direction:column;padding:var(--space-4);">
                                            <i class="ri-delete-bin-line" style="font-size:24px;margin-bottom:var(--space-2);"></i>
                                            <span>清空</span>
                                        </button>
                                    </div>
                                    <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
                                    <div style="padding:var(--space-3);background:var(--bg-muted);border-radius:var(--radius-md);font-size:var(--text-xs);color:var(--text-tertiary);">
                                        <i class="ri-information-line"></i> 备份文件为 JSON 格式，可用于数据迁移或恢复
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 右列 -->
                        <div>
                            <!-- 外观设置 -->
                            <div class="card" style="margin-bottom:var(--space-5);">
                                <div class="card-header">
                                    <h3 class="card-title"><i class="ri-palette-line" style="margin-right:var(--space-2);"></i>外观设置</h3>
                                </div>
                                <div class="card-body">
                                    <div style="font-size:var(--text-sm);color:var(--text-tertiary);margin-bottom:var(--space-4);">选择界面主题</div>
                                    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:var(--space-3);">
                                        <button class="theme-btn" onclick="setTheme('light')" id="themeLightBtn">
                                            <div class="theme-preview light">
                                                <div class="theme-preview-sidebar"></div>
                                                <div class="theme-preview-content"></div>
                                            </div>
                                            <span><i class="ri-sun-line"></i> 浅色模式</span>
                                        </button>
                                        <button class="theme-btn active" onclick="setTheme('dark')" id="themeDarkBtn">
                                            <div class="theme-preview dark">
                                                <div class="theme-preview-sidebar"></div>
                                                <div class="theme-preview-content"></div>
                                            </div>
                                            <span><i class="ri-moon-line"></i> 深色模式</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- 系统信息 -->
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title"><i class="ri-information-line" style="margin-right:var(--space-2);"></i>系统信息</h3>
                                </div>
                                <div class="card-body" style="padding:0;">
                                    <div style="display:flex;flex-direction:column;">
                                        <div style="display:flex;justify-content:space-between;padding:var(--space-3) var(--space-4);border-bottom:1px solid var(--border-subtle);">
                                            <span style="font-size:var(--text-sm);color:var(--text-secondary);">系统版本</span>
                                            <span style="font-size:var(--text-sm);font-weight:500;">TalentLens v4.0</span>
                                        </div>
                                        <div style="display:flex;justify-content:space-between;padding:var(--space-3) var(--space-4);border-bottom:1px solid var(--border-subtle);">
                                            <span style="font-size:var(--text-sm);color:var(--text-secondary);">数据存储</span>
                                            <span style="font-size:var(--text-sm);font-weight:500;">LocalStorage</span>
                                        </div>
                                        <div style="display:flex;justify-content:space-between;padding:var(--space-3) var(--space-4);border-bottom:1px solid var(--border-subtle);">
                                            <span style="font-size:var(--text-sm);color:var(--text-secondary);">测评记录</span>
                                            <span style="font-size:var(--text-sm);font-weight:500;" id="settingsRecordCount">0 条</span>
                                        </div>
                                        <div style="display:flex;justify-content:space-between;padding:var(--space-3) var(--space-4);">
                                            <span style="font-size:var(--text-sm);color:var(--text-secondary);">存储占用</span>
                                            <span style="font-size:var(--text-sm);font-weight:500;" id="settingsStorageSize">0 KB</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Overlay -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal" id="modalContent" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">标题</h3>
                <button class="modal-close" onclick="closeModal()"><i class="ri-close-line"></i></button>
            </div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-footer" id="modalFooter"></div>
        </div>
    </div>

    <script>
        // ==================== Config ====================
        const CONFIG = {
            password: 'epq_admin_123',
            storageKey: 'epqRecords',
            sessionKey: 'epqAdminSession'
        };

        // ==================== State ====================
        let allRecords = [];
        let filteredRecords = [];
        let selectedRecordIds = [];
        let systemPositions = [];
        let currentSort = { field: 'createTime', order: 'desc' };
        let pagination = { page: 1, pageSize: 10, total: 0 };

        // ==================== Theme ====================
        function initTheme() {
            const saved = localStorage.getItem('theme') || 'dark';
            setTheme(saved);
        }

        function setTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            updateThemeIcon(theme);
            updateThemeButtons();
        }

        function toggleTheme() {
            const current = document.body.getAttribute('data-theme');
            const themes = ['dark', 'light', 'auto'];
            const next = themes[(themes.indexOf(current) + 1) % themes.length];
            setTheme(next);
        }

        function updateThemeIcon(theme) {
            const icon = document.getElementById('themeIcon');
            const btn = document.getElementById('themeBtn');
            if (!icon || !btn) return;
            
            const icons = { dark: 'ri-moon-line', light: 'ri-sun-line', auto: 'ri-computer-line' };
            const titles = { dark: '深色模式', light: '浅色模式', auto: '跟随系统' };
            icon.className = icons[theme] || icons.dark;
            btn.title = titles[theme] || titles.dark;
        }

        // ==================== Init ====================
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            if (sessionStorage.getItem(CONFIG.sessionKey) === 'true') {
                showMainApp();
            }
        });

        // ==================== Auth ====================
        function handleLogin(e) {
            e.preventDefault();
            const pwd = document.getElementById('passwordInput').value;
            const err = document.getElementById('loginError');
            
            if (pwd === CONFIG.password) {
                sessionStorage.setItem(CONFIG.sessionKey, 'true');
                showMainApp();
            } else {
                err.textContent = '密码错误';
                err.classList.add('show');
                setTimeout(() => err.classList.remove('show'), 3000);
            }
        }

        function handleLogout() {
            if (confirm('确定退出登录？')) {
                sessionStorage.removeItem(CONFIG.sessionKey);
                location.reload();
            }
        }

        function showMainApp() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainApp').classList.add('active');
            loadData();
            renderDashboard();
        }

        // ==================== Data ====================
        function loadData() {
            try {
                const data = localStorage.getItem(CONFIG.storageKey);
                allRecords = data ? JSON.parse(data) : [];
                allRecords = allRecords.map(r => ({
                    ...r,
                    id: r.id || `r_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,
                    scores: r.scores || { E: 0, N: 0, P: 0, L: 0 },
                    createTime: r.createTime || new Date().toISOString()
                }));
                
                const savedPos = localStorage.getItem('epqPositions');
                systemPositions = savedPos ? JSON.parse(savedPos) : [...new Set(allRecords.map(r => r.position).filter(Boolean))];
                
                const savedModel = localStorage.getItem('epqIdealModel');
                if (savedModel) {
                    const m = JSON.parse(savedModel);
                    document.getElementById('idealE').value = m.E || 18;
                    document.getElementById('idealN').value = m.N || 12;
                    document.getElementById('idealP').value = m.P || 10;
                    document.getElementById('idealL').value = m.L || 15;
                }
            } catch (e) {
                console.error('Data load error:', e);
                allRecords = [];
            }
        }

        // ==================== Navigation ====================
        function navigateTo(page) {
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.toggle('active', el.dataset.page === page);
            });
            
            document.querySelectorAll('.page-view').forEach(el => {
                el.classList.toggle('active', el.id === 'page-' + page);
            });
            
            const titles = {
                dashboard: '数据概览',
                candidates: '候选人管理',
                resumes: '简历库',
                assessments: '测评中心',
                analytics: '智能分析',
                settings: '系统设置'
            };
            document.getElementById('pageTitle').textContent = titles[page];
            
            if (page === 'dashboard') renderDashboard();
            else if (page === 'candidates') renderCandidatesPage();
            else if (page === 'analytics') renderAnalyticsPage();
            else if (page === 'assessments') renderAssessmentsPage();
            else if (page === 'settings') renderSettingsPage();
        }

        // ==================== Dashboard ====================
        function renderDashboard() {
            renderStatsCards();
            renderPositionChart();
            renderMatchChart();
            renderEpqAvgChart();
            renderTrendChart();
            renderRecentCandidates();
        }

        function renderStatsCards() {
            const today = new Date().toISOString().split('T')[0];
            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
            const monthAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);
            
            const todayCount = allRecords.filter(r => {
                try { return new Date(r.createTime).toISOString().split('T')[0] === today; } catch { return false; }
            }).length;
            
            const weekCount = allRecords.filter(r => {
                try { return new Date(r.createTime) >= weekAgo; } catch { return false; }
            }).length;
            
            const positions = [...new Set(allRecords.map(r => r.position).filter(Boolean))];
            
            // 计算平均匹配度
            const matchScores = allRecords.map(r => {
                const fit = evaluateFit(r);
                return fit.level === 'excellent' ? 100 : fit.level === 'good' ? 80 : fit.level === 'medium' ? 60 : 40;
            });
            const avgMatch = matchScores.length ? (matchScores.reduce((a,b) => a+b, 0) / matchScores.length).toFixed(0) : 0;
            
            // 计算优秀率
            const excellentCount = allRecords.filter(r => evaluateFit(r).level === 'excellent').length;
            const excellentRate = allRecords.length ? ((excellentCount / allRecords.length) * 100).toFixed(0) : 0;
            
            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card blue">
                    <div class="stat-label">总测评数</div>
                    <div class="stat-value">${allRecords.length}</div>
                    <div class="stat-change up"><i class="ri-arrow-up-s-line"></i> 累计</div>
                </div>
                <div class="stat-card green">
                    <div class="stat-label">今日新增</div>
                    <div class="stat-value">${todayCount}</div>
                    <div class="stat-change up"><i class="ri-arrow-up-s-line"></i> +${todayCount}</div>
                </div>
                <div class="stat-card orange">
                    <div class="stat-label">本周测评</div>
                    <div class="stat-value">${weekCount}</div>
                    <div class="stat-change">最近7天</div>
                </div>
                <div class="stat-card purple">
                    <div class="stat-label">岗位数量</div>
                    <div class="stat-value">${positions.length}</div>
                    <div class="stat-change">不同岗位</div>
                </div>
                <div class="stat-card cyan">
                    <div class="stat-label">平均匹配度</div>
                    <div class="stat-value">${avgMatch}%</div>
                    <div class="stat-change">整体水平</div>
                </div>
                <div class="stat-card pink">
                    <div class="stat-label">优秀率</div>
                    <div class="stat-value">${excellentRate}%</div>
                    <div class="stat-change">${excellentCount}人优秀</div>
                </div>
            `;
        }

        function getChartColors() {
            const style = getComputedStyle(document.body);
            return {
                text: style.getPropertyValue('--text-tertiary').trim() || '#71717a',
                line: style.getPropertyValue('--bg-muted').trim() || '#27272a',
                border: style.getPropertyValue('--bg-elevated').trim() || '#3f3f46'
            };
        }

        function renderPositionChart() {
            const el = document.getElementById('positionChart');
            if (!el) return;
            const chart = echarts.init(el);
            const colors = getChartColors();
            
            const positionData = {};
            allRecords.forEach(r => {
                const pos = r.position || '未指定';
                positionData[pos] = (positionData[pos] || 0) + 1;
            });
            
            const data = Object.entries(positionData).map(([name, value]) => ({ name, value }));
            
            chart.setOption({
                tooltip: { trigger: 'item', formatter: '{b}: {c}人 ({d}%)' },
                legend: { show: false },
                series: [{
                    type: 'pie',
                    radius: ['45%', '70%'],
                    center: ['50%', '50%'],
                    avoidLabelOverlap: true,
                    itemStyle: { borderRadius: 6, borderColor: 'transparent', borderWidth: 2 },
                    label: { show: true, color: colors.text, fontSize: 11 },
                    labelLine: { show: true, lineStyle: { color: colors.border } },
                    data: data,
                    color: ['#6366f1', '#22c55e', '#f59e0b', '#ef4444', '#3b82f6', '#a855f7', '#ec4899', '#14b8a6']
                }]
            });
            window.addEventListener('resize', () => chart.resize());
        }

        function renderMatchChart() {
            const el = document.getElementById('matchChart');
            if (!el) return;
            const chart = echarts.init(el);
            const colors = getChartColors();
            
            const matchData = { excellent: 0, good: 0, medium: 0, poor: 0 };
            allRecords.forEach(r => {
                const fit = evaluateFit(r);
                matchData[fit.level]++;
            });
            
            chart.setOption({
                tooltip: { trigger: 'item' },
                series: [{
                    type: 'pie',
                    radius: ['45%', '70%'],
                    center: ['50%', '50%'],
                    data: [
                        { value: matchData.excellent, name: '优秀', itemStyle: { color: '#22c55e' } },
                        { value: matchData.good, name: '良好', itemStyle: { color: '#3b82f6' } },
                        { value: matchData.medium, name: '一般', itemStyle: { color: '#f59e0b' } },
                        { value: matchData.poor, name: '较低', itemStyle: { color: '#ef4444' } }
                    ],
                    label: { show: true, color: colors.text, fontSize: 11, formatter: '{b}: {c}' },
                    labelLine: { lineStyle: { color: colors.border } }
                }]
            });
            window.addEventListener('resize', () => chart.resize());
        }

        function renderEpqAvgChart() {
            const el = document.getElementById('epqAvgChart');
            if (!el) return;
            const chart = echarts.init(el);
            const colors = getChartColors();
            
            const positions = [...new Set(allRecords.map(r => r.position).filter(Boolean))].slice(0, 5);
            const series = ['E', 'N', 'P', 'L'].map((dim, idx) => {
                const data = positions.map(pos => {
                    const posRecords = allRecords.filter(r => r.position === pos);
                    if (!posRecords.length) return 0;
                    return (posRecords.reduce((sum, r) => sum + (r.scores[dim] || 0), 0) / posRecords.length).toFixed(1);
                });
                return {
                    name: dim,
                    type: 'bar',
                    data,
                    itemStyle: { borderRadius: [4, 4, 0, 0] }
                };
            });
            
            chart.setOption({
                tooltip: { trigger: 'axis' },
                legend: { data: ['E', 'N', 'P', 'L'], textStyle: { color: colors.text }, top: 0 },
                grid: { left: 40, right: 20, top: 40, bottom: 30 },
                xAxis: { 
                    type: 'category', 
                    data: positions, 
                    axisLine: { lineStyle: { color: colors.border } }, 
                    axisLabel: { color: colors.text, fontSize: 10, rotate: 15 } 
                },
                yAxis: { 
                    type: 'value', 
                    max: 24, 
                    axisLine: { show: false }, 
                    splitLine: { lineStyle: { color: colors.line } }, 
                    axisLabel: { color: colors.text } 
                },
                series,
                color: ['#6366f1', '#f59e0b', '#3b82f6', '#22c55e']
            });
            window.addEventListener('resize', () => chart.resize());
        }

        function renderTrendChart() {
            const el = document.getElementById('trendChart');
            if (!el) return;
            const chart = echarts.init(el);
            const dates = [], counts = [];
            const colors = getChartColors();
            
            for (let i = 13; i >= 0; i--) {
                const d = new Date(Date.now() - i * 24 * 60 * 60 * 1000);
                const ds = d.toISOString().split('T')[0];
                dates.push(ds.slice(5));
                counts.push(allRecords.filter(r => {
                    try { return new Date(r.createTime).toISOString().split('T')[0] === ds; } catch { return false; }
                }).length);
            }
            
            chart.setOption({
                tooltip: { trigger: 'axis' },
                grid: { left: 40, right: 20, top: 20, bottom: 30 },
                xAxis: { type: 'category', data: dates, axisLine: { lineStyle: { color: colors.border } }, axisLabel: { color: colors.text, fontSize: 10 } },
                yAxis: { type: 'value', minInterval: 1, axisLine: { show: false }, splitLine: { lineStyle: { color: colors.line } }, axisLabel: { color: colors.text } },
                series: [{ 
                    type: 'line', 
                    data: counts, 
                    smooth: true,
                    itemStyle: { color: '#6366f1' },
                    areaStyle: { color: { type: 'linear', x: 0, y: 0, x2: 0, y2: 1, colorStops: [{ offset: 0, color: 'rgba(99,102,241,0.3)' }, { offset: 1, color: 'rgba(99,102,241,0.05)' }] } }
                }]
            });
            window.addEventListener('resize', () => chart.resize());
        }

        function renderRecentCandidates() {
            const container = document.getElementById('recentCandidates');
            if (!container) return;
            
            const recent = [...allRecords].sort((a, b) => new Date(b.createTime) - new Date(a.createTime)).slice(0, 5);
            
            if (!recent.length) {
                container.innerHTML = '<div class="empty-state" style="padding:var(--space-6);"><p>暂无测评记录</p></div>';
                return;
            }
            
            container.innerHTML = recent.map(r => {
                const fit = evaluateFit(r);
                return `
                    <div class="recent-item" onclick="navigateTo('candidates');setTimeout(()=>selectCandidate('${r.id}'),100);">
                        <div class="recent-avatar">${(r.name || '?')[0]}</div>
                        <div class="recent-info">
                            <div class="recent-name">${r.name || '未命名'}</div>
                            <div class="recent-meta">${r.position || '未指定'} · ${formatDate(r.createTime)}</div>
                        </div>
                        <div class="recent-scores">
                            <span>E:${r.scores.E}</span>
                            <span>N:${r.scores.N}</span>
                            <span>P:${r.scores.P}</span>
                            <span>L:${r.scores.L}</span>
                        </div>
                        <span class="tag ${fit.level}">${fit.label}</span>
                    </div>
                `;
            }).join('');
        }

        // ==================== Candidates ====================
        let filterDebounceTimer = null;
        function debounceFilter() {
            clearTimeout(filterDebounceTimer);
            filterDebounceTimer = setTimeout(() => applyCandidateFilters(), 300);
        }

        function renderCandidatesPage() {
            const positions = [...new Set(allRecords.map(r => r.position).filter(Boolean))];
            const sel = document.getElementById('filterPosition');
            sel.innerHTML = '<option value="">全部岗位</option>' + positions.map(p => `<option value="${p}">${p}</option>`).join('');
            applyCandidateFilters();
        }

        let dateFilterStart = null;
        let dateFilterEnd = null;

        function applyCandidateFilters() {
            const posEl = document.getElementById('filterPosition');
            const kwEl = document.getElementById('filterKeyword');
            const pos = posEl ? posEl.value : '';
            const kw = kwEl ? kwEl.value.toLowerCase() : '';
            
            filteredRecords = allRecords.filter(r => {
                if (pos && r.position !== pos) return false;
                if (dateFilterStart || dateFilterEnd) {
                    try {
                        const rd = new Date(r.createTime).toISOString().split('T')[0];
                        if (dateFilterStart && rd < dateFilterStart) return false;
                        if (dateFilterEnd && rd > dateFilterEnd) return false;
                    } catch { return false; }
                }
                if (kw) {
                    const nm = (r.name || '').toLowerCase().includes(kw);
                    const ph = (r.phone || '').toLowerCase().includes(kw);
                    if (!nm && !ph) return false;
                }
                return true;
            });
            
            pagination.page = 1;
            pagination.total = filteredRecords.length;
            sortFilteredRecords();
            renderCandidateTable();
        }

        function quickDateFilter(days) {
            const end = new Date();
            const start = new Date(Date.now() - days * 24 * 60 * 60 * 1000);
            dateFilterStart = start.toISOString().split('T')[0];
            dateFilterEnd = end.toISOString().split('T')[0];
            applyCandidateFilters();
        }

        function resetCandidateFilters() {
            const posEl = document.getElementById('filterPosition');
            const kwEl = document.getElementById('filterKeyword');
            if (posEl) posEl.value = '';
            if (kwEl) kwEl.value = '';
            dateFilterStart = null;
            dateFilterEnd = null;
            applyCandidateFilters();
        }

        function sortTable(field) {
            if (currentSort.field === field) currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
            else { currentSort.field = field; currentSort.order = 'desc'; }
            sortFilteredRecords();
            renderCandidateTable();
        }

        function sortFilteredRecords() {
            filteredRecords.sort((a, b) => {
                let va, vb;
                if (currentSort.field === 'createTime') {
                    va = new Date(a.createTime).getTime();
                    vb = new Date(b.createTime).getTime();
                } else if (currentSort.field.startsWith('scores.')) {
                    const k = currentSort.field.split('.')[1];
                    va = a.scores[k]; vb = b.scores[k];
                } else {
                    va = a[currentSort.field]; vb = b[currentSort.field];
                }
                return currentSort.order === 'asc' ? (va > vb ? 1 : -1) : (va < vb ? 1 : -1);
            });
        }

        let selectedCandidateId = null;

        function renderCandidateTable() {
            // 使用新的左右结构渲染
            renderCandidateList();
        }

        function renderCandidateList() {
            const list = document.getElementById('candidateList');
            const start = (pagination.page - 1) * pagination.pageSize;
            const pageRecords = filteredRecords.slice(start, start + pagination.pageSize);
            
            document.getElementById('totalCount').textContent = filteredRecords.length;
            
            if (pageRecords.length === 0) {
                list.innerHTML = `
                    <div class="empty-state" style="padding:var(--space-8);">
                        <i class="ri-inbox-line"></i>
                        <h3>暂无候选人</h3>
                        <p>调整筛选条件或等待新的测评提交</p>
                    </div>`;
            } else {
                list.innerHTML = pageRecords.map(r => {
                    const fit = evaluateFit(r);
                    const sel = selectedRecordIds.includes(r.id);
                    const active = selectedCandidateId === r.id;
                    return `
                        <div class="candidate-item ${active ? 'active' : ''}" onclick="selectCandidate('${r.id}')">
                            <input type="checkbox" class="checkbox" ${sel ? 'checked' : ''} onclick="event.stopPropagation();toggleRecordSelection('${r.id}')">
                            <div class="candidate-avatar">${(r.name || '?')[0]}</div>
                            <div class="candidate-info">
                                <div class="candidate-name">${r.name || '未命名'}</div>
                                <div class="candidate-meta">
                                    <span>${r.position || '未指定岗位'}</span>
                                    <span>·</span>
                                    <span>${formatDate(r.createTime)}</span>
                                </div>
                            </div>
                            <span class="tag ${fit.level}" style="flex-shrink:0;">${fit.label}</span>
                        </div>`;
                }).join('');
            }
            renderPagination();
            updateSelectionUI();
        }

        function selectCandidate(id) {
            selectedCandidateId = id;
            renderCandidateList();
            renderCandidateDetail(id);
        }

        function renderCandidateDetail(id) {
            const r = allRecords.find(x => x.id === id);
            if (!r) return;
            
            const fit = evaluateFit(r);
            const analysis = analyzePersonality(r.scores);
            const avgScore = (r.scores.E + r.scores.N + r.scores.P + r.scores.L) / 4;
            
            // 获取同岗位排名
            const samePositionRecords = allRecords.filter(x => x.position === r.position);
            const ranked = samePositionRecords.map(x => ({
                id: x.id,
                score: (x.scores.E + x.scores.N + x.scores.P + x.scores.L) / 4
            })).sort((a, b) => b.score - a.score);
            const rank = ranked.findIndex(x => x.id === r.id) + 1;
            
            // 维度分析
            const eLevel = getScoreLevel(r.scores.E, 'E');
            const nLevel = getScoreLevel(r.scores.N, 'N');
            const pLevel = getScoreLevel(r.scores.P, 'P');
            const lLevel = getScoreLevel(r.scores.L, 'L');
            
            document.getElementById('detailEmpty').style.display = 'none';
            document.getElementById('detailContent').style.display = 'block';
            document.getElementById('detailContent').innerHTML = `
                <!-- 头部信息 -->
                <div class="detail-header">
                    <div class="detail-avatar">${(r.name || '?')[0]}</div>
                    <div class="detail-title">
                        <div class="detail-name">${r.name || '未命名'}</div>
                        <div class="detail-position">${r.position || '未指定岗位'}</div>
                        <div class="detail-tags">
                            <span class="tag ${fit.level}">${fit.label}</span>
                            <span class="tag info">${analysis.temperament}</span>
                        </div>
                    </div>
                    <div class="detail-actions">
                        <button class="btn btn-secondary btn-sm" onclick="deleteRecord('${r.id}')">
                            <i class="ri-delete-bin-line"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 基本信息 -->
                <div class="detail-section">
                    <div class="detail-section-title">基本信息</div>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-item-label">手机号码</div>
                            <div class="detail-item-value">${r.phone || '-'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-item-label">测评时间</div>
                            <div class="detail-item-value">${r.createTime || '-'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-item-label">综合得分</div>
                            <div class="detail-item-value" style="color:var(--accent-primary);font-weight:600;">${avgScore.toFixed(1)} / 24</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-item-label">岗位排名</div>
                            <div class="detail-item-value">${samePositionRecords.length > 1 ? `第 ${rank} / ${samePositionRecords.length} 名` : '暂无对比'}</div>
                        </div>
                    </div>
                </div>
                
                <!-- EPQ 维度分析 -->
                <div class="detail-section">
                    <div class="detail-section-title">EPQ 维度分析</div>
                    <div class="dimension-bar">
                        <div class="dimension-label">
                            <div class="dimension-label-title">外向性 (E)</div>
                            <div class="dimension-label-sub">${eLevel.text}</div>
                        </div>
                        <div class="dimension-progress">
                            <div class="dimension-progress-bar" style="width:${(r.scores.E/24)*100}%;background:var(--accent-primary);"></div>
                        </div>
                        <div class="dimension-value">${r.scores.E}</div>
                    </div>
                    <div class="dimension-bar">
                        <div class="dimension-label">
                            <div class="dimension-label-title">神经质 (N)</div>
                            <div class="dimension-label-sub">${nLevel.text}</div>
                        </div>
                        <div class="dimension-progress">
                            <div class="dimension-progress-bar" style="width:${(r.scores.N/24)*100}%;background:var(--accent-warning);"></div>
                        </div>
                        <div class="dimension-value">${r.scores.N}</div>
                    </div>
                    <div class="dimension-bar">
                        <div class="dimension-label">
                            <div class="dimension-label-title">精神质 (P)</div>
                            <div class="dimension-label-sub">${pLevel.text}</div>
                        </div>
                        <div class="dimension-progress">
                            <div class="dimension-progress-bar" style="width:${(r.scores.P/24)*100}%;background:var(--accent-info);"></div>
                        </div>
                        <div class="dimension-value">${r.scores.P}</div>
                    </div>
                    <div class="dimension-bar">
                        <div class="dimension-label">
                            <div class="dimension-label-title">掩饰性 (L)</div>
                            <div class="dimension-label-sub">${lLevel.text}</div>
                        </div>
                        <div class="dimension-progress">
                            <div class="dimension-progress-bar" style="width:${(r.scores.L/24)*100}%;background:var(--accent-success);"></div>
                        </div>
                        <div class="dimension-value">${r.scores.L}</div>
                    </div>
                </div>
                
                <!-- 雷达图 -->
                <div class="detail-section">
                    <div class="detail-section-title">人格雷达图</div>
                    <div id="detailRadarChart" style="height:240px;"></div>
                </div>
                
                <!-- 性格特质 -->
                <div class="detail-section">
                    <div class="detail-section-title">性格特质</div>
                    <div class="traits-list">
                        ${analysis.traits.map(t => `<span class="tag ${t.type}">${t.text}</span>`).join('')}
                    </div>
                </div>
                
                <!-- 核心优势 -->
                <div class="analysis-card">
                    <div class="analysis-card-title"><i class="ri-star-line"></i> 核心优势</div>
                    <ul class="analysis-list success">
                        ${analysis.strengths.map(s => `<li>${s}</li>`).join('')}
                    </ul>
                </div>
                
                <!-- 潜在风险 -->
                ${analysis.risks.length > 0 ? `
                <div class="analysis-card">
                    <div class="analysis-card-title"><i class="ri-alert-line"></i> 潜在风险</div>
                    <ul class="analysis-list warning">
                        ${analysis.risks.map(s => `<li>${s}</li>`).join('')}
                    </ul>
                </div>
                ` : ''}
                
                <!-- 适合岗位 & 面试建议 -->
                <div class="detail-grid">
                    <div class="analysis-card" style="margin-bottom:0;">
                        <div class="analysis-card-title"><i class="ri-briefcase-line"></i> 适合岗位</div>
                        <div class="traits-list">
                            ${analysis.jobFit.map(j => `<span style="padding:var(--space-1) var(--space-3);background:var(--bg-muted);border-radius:var(--radius-full);font-size:var(--text-xs);color:var(--text-secondary);">${j}</span>`).join('')}
                        </div>
                    </div>
                    <div class="analysis-card" style="margin-bottom:0;">
                        <div class="analysis-card-title"><i class="ri-question-answer-line"></i> 面试建议</div>
                        <ul class="analysis-list" style="font-size:var(--text-xs);">
                            ${analysis.interviewTips.slice(0, 3).map(t => `<li>${t}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                
                <!-- AI 提示 -->
                <div style="margin-top:var(--space-5);padding:var(--space-4);background:rgba(99,102,241,0.1);border-radius:var(--radius-md);border:1px solid rgba(99,102,241,0.2);">
                    <div style="display:flex;align-items:center;gap:var(--space-2);margin-bottom:var(--space-2);">
                        <i class="ri-lightbulb-line" style="color:var(--accent-primary);"></i>
                        <span style="font-size:var(--text-sm);font-weight:500;color:var(--accent-primary);">AI 智能分析</span>
                    </div>
                    <p style="font-size:var(--text-xs);color:var(--text-secondary);margin:0;line-height:1.6;">
                        配置 DeepSeek API 后，可获取更深入的 AI 性格解读、简历匹配分析和个性化面试问题。
                    </p>
                </div>
            `;
            
            // 渲染雷达图
            setTimeout(() => {
                const chartEl = document.getElementById('detailRadarChart');
                if (chartEl) {
                    const colors = getChartColors();
                    const chart = echarts.init(chartEl);
                    chart.setOption({
                        radar: { 
                            indicator: [
                                { name: '外向性(E)', max: 24 }, 
                                { name: '神经质(N)', max: 24 }, 
                                { name: '精神质(P)', max: 24 }, 
                                { name: '掩饰性(L)', max: 24 }
                            ], 
                            radius: 80,
                            axisName: { color: colors.text, fontSize: 11 },
                            splitLine: { lineStyle: { color: colors.line } },
                            splitArea: { areaStyle: { color: ['transparent'] } }
                        },
                        series: [{ 
                            type: 'radar', 
                            data: [{ 
                                value: [r.scores.E, r.scores.N, r.scores.P, r.scores.L], 
                                areaStyle: { opacity: 0.3, color: '#6366f1' },
                                lineStyle: { color: '#6366f1', width: 2 },
                                itemStyle: { color: '#6366f1' }
                            }] 
                        }]
                    });
                }
            }, 100);
        }

        function formatDate(ds) {
            try {
                const d = new Date(ds);
                return `${d.getMonth()+1}/${d.getDate()} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
            } catch { return ds; }
        }

        function maskPhone(p) {
            // 完整显示手机号码
            return p || '-';
        }

        function evaluateFit(r) {
            const avg = (r.scores.E + r.scores.N + r.scores.P + r.scores.L) / 4;
            if (avg >= 18) return { level: 'excellent', label: '优秀' };
            if (avg >= 15) return { level: 'good', label: '良好' };
            if (avg >= 12) return { level: 'medium', label: '一般' };
            return { level: 'poor', label: '较低' };
        }

        function renderPagination() {
            const total = Math.ceil(pagination.total / pagination.pageSize) || 1;
            const info = document.getElementById('paginationInfo');
            const ctrl = document.getElementById('paginationControls');
            
            const s = (pagination.page - 1) * pagination.pageSize + 1;
            const e = Math.min(pagination.page * pagination.pageSize, pagination.total);
            info.textContent = pagination.total ? `${s}-${e} / ${pagination.total}` : '0 条';
            
            let html = `<button class="page-btn" onclick="goToPage(${pagination.page-1})" ${pagination.page===1?'disabled':''}><i class="ri-arrow-left-s-line"></i></button>`;
            for (let i = 1; i <= total; i++) {
                if (i === 1 || i === total || (i >= pagination.page - 1 && i <= pagination.page + 1)) {
                    html += `<button class="page-btn ${i===pagination.page?'active':''}" onclick="goToPage(${i})">${i}</button>`;
                } else if (i === pagination.page - 2 || i === pagination.page + 2) {
                    html += '<span style="padding:0 4px;color:var(--text-muted)">...</span>';
                }
            }
            html += `<button class="page-btn" onclick="goToPage(${pagination.page+1})" ${pagination.page===total?'disabled':''}><i class="ri-arrow-right-s-line"></i></button>`;
            ctrl.innerHTML = html;
        }

        function goToPage(p) {
            const total = Math.ceil(pagination.total / pagination.pageSize);
            if (p < 1 || p > total) return;
            pagination.page = p;
            renderCandidateTable();
        }

        function toggleSelectAll() {
            const all = document.getElementById('selectAll').checked;
            const start = (pagination.page - 1) * pagination.pageSize;
            const pageRecords = filteredRecords.slice(start, start + pagination.pageSize);
            
            if (all) {
                // 全选当前页
                pageRecords.forEach(r => {
                    if (!selectedRecordIds.includes(r.id)) selectedRecordIds.push(r.id);
                });
            } else {
                // 取消当前页选择
                pageRecords.forEach(r => {
                    const idx = selectedRecordIds.indexOf(r.id);
                    if (idx > -1) selectedRecordIds.splice(idx, 1);
                });
            }
            
            // 重新渲染表格以更新复选框状态
            renderCandidateTable();
        }

        function toggleRecordSelection(id) {
            const idx = selectedRecordIds.indexOf(id);
            if (idx > -1) selectedRecordIds.splice(idx, 1);
            else selectedRecordIds.push(id);
            updateSelectionUI();
            renderCandidateList(); // 重新渲染以更新复选框状态
        }

        function toggleSelectAllCandidates() {
            const checkbox = document.getElementById('selectAllCandidates');
            const start = (pagination.page - 1) * pagination.pageSize;
            const pageRecords = filteredRecords.slice(start, start + pagination.pageSize);
            
            if (checkbox.checked) {
                // 全选当前页
                pageRecords.forEach(r => {
                    if (!selectedRecordIds.includes(r.id)) {
                        selectedRecordIds.push(r.id);
                    }
                });
            } else {
                // 取消当前页全选
                pageRecords.forEach(r => {
                    const idx = selectedRecordIds.indexOf(r.id);
                    if (idx > -1) selectedRecordIds.splice(idx, 1);
                });
            }
            updateSelectionUI();
            renderCandidateList();
        }

        function updateSelectionUI() {
            const countEl = document.getElementById('selectedCount');
            if (countEl) countEl.textContent = selectedRecordIds.length;
            const btn = document.getElementById('batchDeleteBtn');
            if (btn) btn.disabled = selectedRecordIds.length === 0;
        }

        function batchDelete() {
            if (!selectedRecordIds.length) return;
            showConfirmModal(`确定删除 ${selectedRecordIds.length} 条记录？`, () => {
                allRecords = allRecords.filter(r => !selectedRecordIds.includes(r.id));
                localStorage.setItem(CONFIG.storageKey, JSON.stringify(allRecords));
                selectedRecordIds = [];
                applyCandidateFilters();
                renderDashboard();
            });
        }

        function exportFilteredData() {
            if (!filteredRecords.length) return showAlertModal('没有数据可导出');
            const headers = ['时间', '姓名', '手机', '岗位', 'E', 'N', 'P', 'L', '匹配度'];
            const rows = filteredRecords.map(r => [r.createTime, r.name, r.phone, r.position, r.scores.E, r.scores.N, r.scores.P, r.scores.L, evaluateFit(r).label]);
            const csv = [headers, ...rows].map(r => r.join(',')).join('\n');
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `candidates_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // ==================== 人格分析引擎 ====================
        function analyzePersonality(scores) {
            const { E, N, P, L } = scores;
            
            // 性格类型判定
            const isExtroverted = E > 12;
            const isStable = N < 12;
            const isAgreeable = P < 12;
            const isHonest = L > 12;
            
            // 四象限类型
            let temperament = '';
            if (isExtroverted && isStable) temperament = '多血质（活泼型）';
            else if (isExtroverted && !isStable) temperament = '胆汁质（急躁型）';
            else if (!isExtroverted && isStable) temperament = '粘液质（稳重型）';
            else temperament = '抑郁质（敏感型）';
            
            // 性格标签
            const traits = [];
            if (E >= 18) traits.push({ text: '高度外向', type: 'info' });
            else if (E >= 12) traits.push({ text: '中度外向', type: 'good' });
            else if (E >= 6) traits.push({ text: '中度内向', type: 'medium' });
            else traits.push({ text: '高度内向', type: 'medium' });
            
            if (N >= 18) traits.push({ text: '情绪敏感', type: 'warning' });
            else if (N >= 12) traits.push({ text: '情绪波动', type: 'medium' });
            else if (N >= 6) traits.push({ text: '情绪稳定', type: 'good' });
            else traits.push({ text: '高度稳定', type: 'excellent' });
            
            if (P >= 18) traits.push({ text: '独立思考', type: 'info' });
            else if (P >= 12) traits.push({ text: '适度坚持', type: 'medium' });
            else if (P >= 6) traits.push({ text: '合作导向', type: 'good' });
            else traits.push({ text: '高度合作', type: 'excellent' });
            
            // 优势分析
            const strengths = [];
            if (E >= 15) strengths.push('沟通能力强，善于表达');
            if (E >= 12 && N < 12) strengths.push('社交自信，情绪稳定');
            if (N < 10) strengths.push('抗压能力强，心态平和');
            if (P < 10) strengths.push('团队协作好，易于相处');
            if (L >= 15) strengths.push('诚实可靠，值得信任');
            if (E < 10 && N < 10) strengths.push('沉稳内敛，思考深入');
            if (strengths.length === 0) strengths.push('性格特质均衡');
            
            // 潜在风险
            const risks = [];
            if (E >= 20) risks.push('可能过于外向，需注意倾听');
            if (N >= 18) risks.push('情绪波动较大，压力管理需关注');
            if (P >= 18) risks.push('个性较强，团队融入需观察');
            if (L < 8) risks.push('社会期望倾向高，需深入了解');
            if (E < 6 && N >= 15) risks.push('可能较为敏感内向，沟通需耐心');
            
            // 岗位适配建议
            const jobFit = [];
            if (E >= 15 && N < 12) jobFit.push('销售', '市场', '公关', '管理');
            if (E < 10 && N < 12 && P < 12) jobFit.push('研发', '财务', '分析', '质控');
            if (E >= 12 && P < 10) jobFit.push('客服', 'HR', '行政', '培训');
            if (P >= 15 && N < 12) jobFit.push('创意', '设计', '策划', '产品');
            if (jobFit.length === 0) jobFit.push('通用岗位');
            
            // 面试建议
            const interviewTips = [];
            if (E >= 15) interviewTips.push('可通过开放性问题观察其表达能力');
            if (E < 10) interviewTips.push('给予充足思考时间，避免压迫感');
            if (N >= 15) interviewTips.push('关注压力情境下的反应和情绪管理');
            if (P >= 15) interviewTips.push('探讨团队合作经历和冲突处理方式');
            if (L < 10) interviewTips.push('通过行为面试验证回答的真实性');
            interviewTips.push('结合实际工作场景进行情境模拟');
            
            return { temperament, traits, strengths, risks, jobFit, interviewTips };
        }

        function getScoreLevel(score, dimension) {
            const levels = {
                E: { high: 18, mid: 12, labels: ['高度外向', '中度外向', '中度内向', '高度内向'] },
                N: { high: 18, mid: 12, labels: ['高度敏感', '中度敏感', '中度稳定', '高度稳定'] },
                P: { high: 18, mid: 12, labels: ['高度独立', '中度独立', '中度合作', '高度合作'] },
                L: { high: 18, mid: 12, labels: ['高度诚实', '中度诚实', '中度掩饰', '高度掩饰'] }
            };
            const l = levels[dimension];
            if (score >= l.high) return { level: 0, text: l.labels[0], color: dimension === 'N' ? 'warning' : 'info' };
            if (score >= l.mid) return { level: 1, text: l.labels[1], color: 'medium' };
            if (score >= 6) return { level: 2, text: l.labels[2], color: 'good' };
            return { level: 3, text: l.labels[3], color: dimension === 'N' ? 'excellent' : 'medium' };
        }

        function viewCandidate(id) {
            const r = allRecords.find(x => x.id === id);
            if (!r) return;
            const fit = evaluateFit(r);
            const analysis = analyzePersonality(r.scores);
            const avgScore = (r.scores.E + r.scores.N + r.scores.P + r.scores.L) / 4;
            
            // 获取同岗位排名
            const samePositionRecords = allRecords.filter(x => x.position === r.position);
            const ranked = samePositionRecords.map(x => ({
                id: x.id,
                score: (x.scores.E + x.scores.N + x.scores.P + x.scores.L) / 4
            })).sort((a, b) => b.score - a.score);
            const rank = ranked.findIndex(x => x.id === r.id) + 1;
            
            // 维度分析
            const eLevel = getScoreLevel(r.scores.E, 'E');
            const nLevel = getScoreLevel(r.scores.N, 'N');
            const pLevel = getScoreLevel(r.scores.P, 'P');
            const lLevel = getScoreLevel(r.scores.L, 'L');
            
            showModal('候选人画像', `
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:var(--space-5);">
                    <!-- 左侧：基本信息 + 雷达图 -->
                    <div>
                        <div style="display:flex;align-items:center;gap:var(--space-4);margin-bottom:var(--space-5);">
                            <div style="width:64px;height:64px;border-radius:var(--radius-lg);background:var(--gradient-primary);display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:700;color:white;">
                                ${(r.name || '?')[0]}
                            </div>
                            <div>
                                <div style="font-size:var(--text-xl);font-weight:600;color:var(--text-primary);">${r.name || '未命名'}</div>
                                <div style="font-size:var(--text-sm);color:var(--text-tertiary);">${r.position || '未指定岗位'}</div>
                                <div style="display:flex;gap:var(--space-2);margin-top:var(--space-2);">
                                    <span class="tag ${fit.level}">${fit.label}</span>
                                    <span class="tag info">${analysis.temperament}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-grid" style="margin-bottom:var(--space-4);">
                            <div class="info-item"><div class="info-label">手机号码</div><div class="info-value">${r.phone || '-'}</div></div>
                            <div class="info-item"><div class="info-label">测评时间</div><div class="info-value">${formatDate(r.createTime)}</div></div>
                            <div class="info-item"><div class="info-label">综合得分</div><div class="info-value" style="color:var(--accent-primary);font-weight:600;">${avgScore.toFixed(1)} / 24</div></div>
                            <div class="info-item"><div class="info-label">岗位排名</div><div class="info-value">${samePositionRecords.length > 1 ? `第 ${rank} / ${samePositionRecords.length} 名` : '暂无对比'}</div></div>
                        </div>
                        
                        <h4 class="section-title" style="margin-top:var(--space-4);">EPQ 人格雷达</h4>
                        <div id="detailRadar" style="height:240px;"></div>
                    </div>
                    
                    <!-- 右侧：详细分析 -->
                    <div>
                        <h4 class="section-title" style="margin-top:0;">维度分析</h4>
                        <div style="display:flex;flex-direction:column;gap:var(--space-3);margin-bottom:var(--space-5);">
                            <div style="display:flex;align-items:center;justify-content:space-between;padding:var(--space-3);background:var(--bg-muted);border-radius:var(--radius-md);">
                                <div>
                                    <div style="font-size:var(--text-sm);font-weight:500;">外向性 (E)</div>
                                    <div style="font-size:var(--text-xs);color:var(--text-tertiary);">${eLevel.text}</div>
                                </div>
                                <div style="display:flex;align-items:center;gap:var(--space-2);">
                                    <div style="width:100px;height:6px;background:var(--bg-elevated);border-radius:3px;overflow:hidden;">
                                        <div style="width:${(r.scores.E/24)*100}%;height:100%;background:var(--accent-primary);border-radius:3px;"></div>
                                    </div>
                                    <span style="font-weight:600;min-width:24px;">${r.scores.E}</span>
                                </div>
                            </div>
                            <div style="display:flex;align-items:center;justify-content:space-between;padding:var(--space-3);background:var(--bg-muted);border-radius:var(--radius-md);">
                                <div>
                                    <div style="font-size:var(--text-sm);font-weight:500;">神经质 (N)</div>
                                    <div style="font-size:var(--text-xs);color:var(--text-tertiary);">${nLevel.text}</div>
                                </div>
                                <div style="display:flex;align-items:center;gap:var(--space-2);">
                                    <div style="width:100px;height:6px;background:var(--bg-elevated);border-radius:3px;overflow:hidden;">
                                        <div style="width:${(r.scores.N/24)*100}%;height:100%;background:var(--accent-warning);border-radius:3px;"></div>
                                    </div>
                                    <span style="font-weight:600;min-width:24px;">${r.scores.N}</span>
                                </div>
                            </div>
                            <div style="display:flex;align-items:center;justify-content:space-between;padding:var(--space-3);background:var(--bg-muted);border-radius:var(--radius-md);">
                                <div>
                                    <div style="font-size:var(--text-sm);font-weight:500;">精神质 (P)</div>
                                    <div style="font-size:var(--text-xs);color:var(--text-tertiary);">${pLevel.text}</div>
                                </div>
                                <div style="display:flex;align-items:center;gap:var(--space-2);">
                                    <div style="width:100px;height:6px;background:var(--bg-elevated);border-radius:3px;overflow:hidden;">
                                        <div style="width:${(r.scores.P/24)*100}%;height:100%;background:var(--accent-info);border-radius:3px;"></div>
                                    </div>
                                    <span style="font-weight:600;min-width:24px;">${r.scores.P}</span>
                                </div>
                            </div>
                            <div style="display:flex;align-items:center;justify-content:space-between;padding:var(--space-3);background:var(--bg-muted);border-radius:var(--radius-md);">
                                <div>
                                    <div style="font-size:var(--text-sm);font-weight:500;">掩饰性 (L)</div>
                                    <div style="font-size:var(--text-xs);color:var(--text-tertiary);">${lLevel.text}</div>
                                </div>
                                <div style="display:flex;align-items:center;gap:var(--space-2);">
                                    <div style="width:100px;height:6px;background:var(--bg-elevated);border-radius:3px;overflow:hidden;">
                                        <div style="width:${(r.scores.L/24)*100}%;height:100%;background:var(--accent-success);border-radius:3px;"></div>
                                    </div>
                                    <span style="font-weight:600;min-width:24px;">${r.scores.L}</span>
                                </div>
                            </div>
                        </div>
                        
                        <h4 class="section-title">性格特质</h4>
                        <div style="display:flex;flex-wrap:wrap;gap:var(--space-2);margin-bottom:var(--space-5);">
                            ${analysis.traits.map(t => `<span class="tag ${t.type}">${t.text}</span>`).join('')}
                        </div>
                        
                        <h4 class="section-title">核心优势</h4>
                        <ul style="margin:0 0 var(--space-5) var(--space-4);color:var(--text-secondary);font-size:var(--text-sm);line-height:1.8;">
                            ${analysis.strengths.map(s => `<li style="color:var(--accent-success);">${s}</li>`).join('')}
                        </ul>
                        
                        ${analysis.risks.length > 0 ? `
                        <h4 class="section-title">潜在风险</h4>
                        <ul style="margin:0 0 var(--space-5) var(--space-4);color:var(--text-secondary);font-size:var(--text-sm);line-height:1.8;">
                            ${analysis.risks.map(s => `<li style="color:var(--accent-warning);">${s}</li>`).join('')}
                        </ul>
                        ` : ''}
                    </div>
                </div>
                
                <div style="border-top:1px solid var(--border-subtle);margin-top:var(--space-5);padding-top:var(--space-5);">
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:var(--space-5);">
                        <div>
                            <h4 class="section-title" style="margin-top:0;">适合岗位类型</h4>
                            <div style="display:flex;flex-wrap:wrap;gap:var(--space-2);">
                                ${analysis.jobFit.map(j => `<span style="padding:var(--space-1) var(--space-3);background:var(--bg-muted);border-radius:var(--radius-full);font-size:var(--text-xs);color:var(--text-secondary);">${j}</span>`).join('')}
                            </div>
                        </div>
                        <div>
                            <h4 class="section-title" style="margin-top:0;">面试建议</h4>
                            <ul style="margin:0 0 0 var(--space-4);color:var(--text-secondary);font-size:var(--text-xs);line-height:1.8;">
                                ${analysis.interviewTips.slice(0, 3).map(t => `<li>${t}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top:var(--space-5);padding:var(--space-4);background:rgba(99,102,241,0.1);border-radius:var(--radius-md);border:1px solid rgba(99,102,241,0.2);">
                    <div style="display:flex;align-items:center;gap:var(--space-2);margin-bottom:var(--space-2);">
                        <i class="ri-lightbulb-line" style="color:var(--accent-primary);"></i>
                        <span style="font-size:var(--text-sm);font-weight:500;color:var(--accent-primary);">AI 分析提示</span>
                    </div>
                    <p style="font-size:var(--text-xs);color:var(--text-secondary);margin:0;line-height:1.6;">
                        以上分析基于 EPQ 测评结果自动生成。如需更深入的 AI 性格解读、简历匹配分析和个性化面试问题，请升级至 AI 增强版本。
                    </p>
                </div>
            `, null, true);
            
            setTimeout(() => {
                const colors = getChartColors();
                const chart = echarts.init(document.getElementById('detailRadar'));
                chart.setOption({
                    radar: { 
                        indicator: [
                            { name: '外向性(E)', max: 24 }, 
                            { name: '神经质(N)', max: 24 }, 
                            { name: '精神质(P)', max: 24 }, 
                            { name: '掩饰性(L)', max: 24 }
                        ], 
                        radius: 80,
                        axisName: { color: colors.text },
                        splitLine: { lineStyle: { color: colors.line } },
                        splitArea: { areaStyle: { color: ['transparent'] } }
                    },
                    series: [{ 
                        type: 'radar', 
                        data: [{ 
                            value: [r.scores.E, r.scores.N, r.scores.P, r.scores.L], 
                            areaStyle: { opacity: 0.3, color: '#6366f1' },
                            lineStyle: { color: '#6366f1', width: 2 },
                            itemStyle: { color: '#6366f1' }
                        }] 
                    }]
                });
            }, 150);
        }

        // ==================== Analytics ====================
        function renderAnalyticsPage() {
            const positions = [...new Set(allRecords.map(r => r.position).filter(Boolean))];
            const sel = document.getElementById('analyticsPosition');
            sel.innerHTML = '<option value="">全部岗位</option>' + positions.map(p => `<option value="${p}">${p}</option>`).join('');
            refreshAnalytics();
        }

        function refreshAnalytics() {
            const pos = document.getElementById('analyticsPosition').value;
            const records = pos ? allRecords.filter(r => r.position === pos) : allRecords;
            
            renderMatchRadar(records);
            renderCompetitive(records);
            renderPersonality(records);
            renderDimension(records);
        }

        function renderMatchRadar(records) {
            const el = document.getElementById('matchRadarChart');
            if (!records.length) { el.innerHTML = '<div class="empty-state"><i class="ri-radar-line"></i><h3>暂无数据</h3></div>'; return; }
            
            const chart = echarts.init(el);
            const avg = { E: 0, N: 0, P: 0, L: 0 };
            records.forEach(r => { avg.E += r.scores.E; avg.N += r.scores.N; avg.P += r.scores.P; avg.L += r.scores.L; });
            Object.keys(avg).forEach(k => avg[k] = avg[k] / records.length);
            
            const ideal = {
                E: parseInt(document.getElementById('idealE').value) || 18,
                N: parseInt(document.getElementById('idealN').value) || 12,
                P: parseInt(document.getElementById('idealP').value) || 10,
                L: parseInt(document.getElementById('idealL').value) || 15
            };
            
            chart.setOption({
                legend: { data: ['候选人', '理想模型'], bottom: 0, textStyle: { color: '#a1a1aa' } },
                radar: { indicator: [{ name: 'E', max: 24 }, { name: 'N', max: 24 }, { name: 'P', max: 24 }, { name: 'L', max: 24 }], radius: 120 },
                series: [{
                    type: 'radar',
                    data: [
                        { value: [avg.E, avg.N, avg.P, avg.L], name: '候选人', areaStyle: { opacity: 0.3 }, itemStyle: { color: '#6366f1' } },
                        { value: [ideal.E, ideal.N, ideal.P, ideal.L], name: '理想模型', lineStyle: { type: 'dashed' }, itemStyle: { color: '#22c55e' } }
                    ]
                }]
            });
            window.addEventListener('resize', () => chart.resize());
        }

        function renderCompetitive(records) {
            const el = document.getElementById('competitiveChart');
            if (!records.length) { el.innerHTML = '<div class="empty-state"><i class="ri-bar-chart-line"></i><h3>暂无数据</h3></div>'; return; }
            
            const chart = echarts.init(el);
            const ranked = records.map(r => ({ name: r.name || '未命名', score: (r.scores.E + r.scores.N + r.scores.P + r.scores.L) / 4 }))
                .sort((a, b) => b.score - a.score).slice(0, 8);
            
            chart.setOption({
                tooltip: { trigger: 'axis' },
                grid: { left: 60, right: 20, top: 20, bottom: 30 },
                xAxis: { type: 'category', data: ranked.map(r => r.name), axisLabel: { color: '#71717a', rotate: 30 }, axisLine: { lineStyle: { color: '#3f3f46' } } },
                yAxis: { type: 'value', max: 24, axisLabel: { color: '#71717a' }, splitLine: { lineStyle: { color: '#27272a' } } },
                series: [{ type: 'bar', data: ranked.map(r => r.score.toFixed(1)), itemStyle: { color: '#6366f1', borderRadius: [4, 4, 0, 0] }, barWidth: 24, label: { show: true, position: 'top', color: '#a1a1aa', fontSize: 11 } }]
            });
            window.addEventListener('resize', () => chart.resize());
        }

        function renderPersonality(records) {
            const el = document.getElementById('personalityChart');
            if (!records.length) { el.innerHTML = '<div class="empty-state"><i class="ri-pie-chart-line"></i><h3>暂无数据</h3></div>'; return; }
            
            const chart = echarts.init(el);
            const types = { '外向稳定': 0, '外向不稳定': 0, '内向稳定': 0, '内向不稳定': 0 };
            records.forEach(r => {
                const ext = r.scores.E > 12, sta = r.scores.N < 12;
                if (ext && sta) types['外向稳定']++;
                else if (ext && !sta) types['外向不稳定']++;
                else if (!ext && sta) types['内向稳定']++;
                else types['内向不稳定']++;
            });
            
            chart.setOption({
                tooltip: { trigger: 'item', formatter: '{b}: {c} ({d}%)' },
                legend: { bottom: 0, textStyle: { color: '#a1a1aa' } },
                series: [{
                    type: 'pie', radius: ['45%', '70%'],
                    itemStyle: { borderRadius: 6, borderColor: '#18181b', borderWidth: 2 },
                    label: { show: false },
                    data: Object.entries(types).map(([name, value]) => ({ name, value })),
                    color: ['#6366f1', '#22c55e', '#f59e0b', '#ef4444']
                }]
            });
            window.addEventListener('resize', () => chart.resize());
        }

        function renderDimension(records) {
            const el = document.getElementById('dimensionChart');
            if (!records.length) { el.innerHTML = '<div class="empty-state"><i class="ri-bar-chart-grouped-line"></i><h3>暂无数据</h3></div>'; return; }
            
            const chart = echarts.init(el);
            const dims = ['E', 'N', 'P', 'L'];
            const avgs = dims.map(d => (records.reduce((s, r) => s + r.scores[d], 0) / records.length).toFixed(1));
            
            chart.setOption({
                tooltip: { trigger: 'axis' },
                grid: { left: 40, right: 20, top: 20, bottom: 30 },
                xAxis: { type: 'category', data: dims, axisLabel: { color: '#71717a' }, axisLine: { lineStyle: { color: '#3f3f46' } } },
                yAxis: { type: 'value', max: 24, axisLabel: { color: '#71717a' }, splitLine: { lineStyle: { color: '#27272a' } } },
                series: [{ type: 'bar', data: avgs, itemStyle: { color: '#8b5cf6', borderRadius: [4, 4, 0, 0] }, barWidth: 40, label: { show: true, position: 'top', color: '#a1a1aa' } }]
            });
            window.addEventListener('resize', () => chart.resize());
        }

        // ==================== Assessments ====================
        function renderAssessmentsPage() {
            const base = window.location.href.substring(0, window.location.href.lastIndexOf('/'));
            document.getElementById('testLink').value = base + '/test.html';
            
            // 渲染岗位列表
            renderPositionListAssessment();
            
            // 加载理想模型
            loadIdealModel();
        }

        function switchAssessmentTab(tab) {
            // 更新Tab按钮状态
            document.querySelectorAll('.assessment-tab').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tab);
            });
            
            // 更新Tab内容显示
            document.querySelectorAll('.assessment-tab-content').forEach(content => {
                content.classList.toggle('active', content.id === 'tab-' + tab);
            });
            
            // 如果切换到岗位管理，刷新列表
            if (tab === 'positions') {
                renderPositionListAssessment();
            }
            // 如果切换到理想模型，加载设置
            if (tab === 'idealModel') {
                loadIdealModel();
            }
        }

        // 岗位理想模型存储
        let positionIdealModels = JSON.parse(localStorage.getItem('positionIdealModels') || '{}');

        function renderPositionListAssessment() {
            const list = document.getElementById('positionListAssessment');
            if (!list) return;
            
            if (!systemPositions.length) {
                list.innerHTML = `
                    <div class="empty-state" style="padding:var(--space-8);">
                        <i class="ri-briefcase-line"></i>
                        <h3>暂无岗位</h3>
                        <p>点击上方"添加岗位"按钮创建</p>
                    </div>`;
                return;
            }
            
            list.innerHTML = systemPositions.map((p, i) => {
                const model = positionIdealModels[p];
                const hasModel = model && (model.E !== undefined);
                return `
                <div class="position-item">
                    <div class="position-info">
                        <h4>${p}</h4>
                        <p>${allRecords.filter(r => r.position === p).length} 位候选人</p>
                        ${hasModel ? `<div class="position-model-tags">
                            <span class="mini-tag">E:${model.E}</span>
                            <span class="mini-tag">N:${model.N}</span>
                            <span class="mini-tag">P:${model.P}</span>
                            <span class="mini-tag">L:${model.L}</span>
                        </div>` : '<p style="font-size:var(--text-xs);color:var(--accent-warning);"><i class="ri-alert-line"></i> 未设置理想模型</p>'}
                    </div>
                    <div class="position-actions">
                        <button class="btn btn-secondary btn-sm" onclick="showPositionModelModal('${p}')" title="设置理想模型">
                            <i class="ri-radar-line"></i>
                        </button>
                        <button class="btn btn-ghost btn-sm" onclick="editPosition(${i})"><i class="ri-edit-line"></i></button>
                        <button class="btn btn-ghost btn-sm" onclick="deletePosition(${i})"><i class="ri-delete-bin-line"></i></button>
                    </div>
                </div>`;
            }).join('');
        }

        // 题库导入功能
        function downloadQuestionnaireTemplate() {
            const template = {
                name: "自定义问卷名称",
                id: "custom_questionnaire",
                description: "问卷描述",
                dimensions: ["A", "B", "C", "D"],
                dimensionNames: {
                    A: "维度A名称",
                    B: "维度B名称",
                    C: "维度C名称",
                    D: "维度D名称"
                },
                answerType: "yesno",
                questions: [
                    { id: 1, text: "第一道题目内容？", dimension: "A", positive: true },
                    { id: 2, text: "第二道题目内容？", dimension: "B", positive: true },
                    { id: 3, text: "第三道题目内容？", dimension: "C", positive: false }
                ]
            };
            
            const blob = new Blob([JSON.stringify(template, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'questionnaire_template.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importQuestionnaire(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let data;
                    if (file.name.endsWith('.json')) {
                        data = JSON.parse(e.target.result);
                    } else if (file.name.endsWith('.csv')) {
                        data = parseCSVQuestionnaire(e.target.result);
                    } else {
                        throw new Error('不支持的文件格式');
                    }
                    
                    // 验证数据结构
                    if (!data.questions || !Array.isArray(data.questions) || data.questions.length === 0) {
                        throw new Error('问卷必须包含 questions 数组');
                    }
                    
                    // 保存到 localStorage
                    const customQuestionnaires = JSON.parse(localStorage.getItem('customQuestionnaires') || '[]');
                    const existingIndex = customQuestionnaires.findIndex(q => q.id === data.id);
                    if (existingIndex > -1) {
                        customQuestionnaires[existingIndex] = data;
                    } else {
                        customQuestionnaires.push(data);
                    }
                    localStorage.setItem('customQuestionnaires', JSON.stringify(customQuestionnaires));
                    
                    showAlertModal(`成功导入问卷「${data.name || data.id}」，共 ${data.questions.length} 道题目`);
                    event.target.value = '';
                } catch (err) {
                    showAlertModal('导入失败：' + err.message);
                    event.target.value = '';
                }
            };
            reader.readAsText(file);
        }

        function parseCSVQuestionnaire(csvText) {
            const lines = csvText.trim().split('\n');
            if (lines.length < 2) throw new Error('CSV 文件格式错误');
            
            const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
            const questions = [];
            const dimensions = new Set();
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim());
                const q = {};
                headers.forEach((h, idx) => {
                    if (h === 'id') q.id = parseInt(values[idx]) || i;
                    else if (h === 'text') q.text = values[idx];
                    else if (h === 'dimension') {
                        q.dimension = values[idx];
                        dimensions.add(values[idx]);
                    }
                    else if (h === 'positive') q.positive = values[idx].toLowerCase() === 'true' || values[idx] === '1';
                    else if (h === 'optiona') q.optionA = values[idx];
                    else if (h === 'optionb') q.optionB = values[idx];
                });
                if (q.text && q.dimension) questions.push(q);
            }
            
            return {
                id: 'csv_import_' + Date.now(),
                name: 'CSV导入问卷',
                dimensions: Array.from(dimensions),
                answerType: questions[0].optionA ? 'choice' : 'yesno',
                questions: questions
            };
        }

        // 问卷启用状态管理
        let enabledQuestionnaires = JSON.parse(localStorage.getItem('enabledQuestionnaires') || '{"epq": true, "mbti": false, "disc": false, "values": false}');

        function selectQuestionnaire(type) {
            document.querySelectorAll('.questionnaire-card').forEach(card => {
                card.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            const isEnabled = enabledQuestionnaires[type] || false;
            const questionnaireInfo = {
                epq: {
                    name: 'EPQ 人格测评',
                    status: isEnabled || type === 'epq' ? '已启用' : '未启用',
                    canEnable: true,
                    description: '艾森克人格问卷（Eysenck Personality Questionnaire）是由英国心理学家艾森克编制的一种人格测验。',
                    dimensions: [
                        { name: 'E（外向性）', desc: '测量个体的社交性、活力和乐观程度' },
                        { name: 'N（神经质）', desc: '测量情绪稳定性、焦虑和紧张程度' },
                        { name: 'P（精神质）', desc: '测量独立性、创造力和固执程度' },
                        { name: 'L（掩饰性）', desc: '测量社会期望倾向和诚实程度' }
                    ],
                    questions: 48,
                    time: '约5分钟',
                    usedCount: allRecords.length
                },
                mbti: {
                    name: 'MBTI 职业性格',
                    status: enabledQuestionnaires.mbti ? '已启用' : '可启用',
                    canEnable: true,
                    description: 'MBTI（Myers-Briggs Type Indicator）是一种基于荣格心理类型理论的人格测评工具，将人格分为16种类型。',
                    dimensions: [
                        { name: 'E-I（外向-内向）', desc: '能量来源：外部世界还是内心世界' },
                        { name: 'S-N（感觉-直觉）', desc: '信息收集：具体事实还是抽象概念' },
                        { name: 'T-F（思考-情感）', desc: '决策方式：逻辑分析还是价值判断' },
                        { name: 'J-P（判断-感知）', desc: '生活方式：有计划还是灵活应变' }
                    ],
                    questions: 93,
                    time: '约15分钟',
                    usedCount: 0
                },
                disc: {
                    name: 'DISC 行为风格',
                    status: enabledQuestionnaires.disc ? '已启用' : '可启用',
                    canEnable: true,
                    description: 'DISC 是一种行为风格评估工具，帮助了解个人的沟通风格和团队协作模式。',
                    dimensions: [
                        { name: 'D（支配型）', desc: '强调结果、竞争和控制' },
                        { name: 'I（影响型）', desc: '强调热情、乐观和协作' },
                        { name: 'S（稳健型）', desc: '强调耐心、可靠和团队合作' },
                        { name: 'C（谨慎型）', desc: '强调质量、准确和专业' }
                    ],
                    questions: 28,
                    time: '约8分钟',
                    usedCount: 0
                },
                values: {
                    name: '职业价值观',
                    status: '规划中',
                    canEnable: false,
                    description: '职业价值观测评帮助了解个人在工作中最看重的因素，用于判断候选人与企业文化的匹配程度。',
                    dimensions: [
                        { name: '成就感', desc: '追求工作中的成就和认可' },
                        { name: '独立性', desc: '重视工作的自主权和决策权' },
                        { name: '经济报酬', desc: '关注薪资和物质回报' },
                        { name: '人际关系', desc: '重视同事关系和团队氛围' },
                        { name: '安全稳定', desc: '追求工作的稳定性和安全感' },
                        { name: '社会地位', desc: '关注职业的社会认可度' },
                        { name: '创造性', desc: '追求创新和创造的机会' },
                        { name: '生活方式', desc: '重视工作与生活的平衡' }
                    ],
                    questions: 40,
                    time: '约10分钟',
                    usedCount: 0
                }
            };
            
            const info = questionnaireInfo[type];
            if (!info) return;
            
            showModal(info.name, `
                <div class="questionnaire-detail">
                    <div class="qd-status ${info.status === '已启用' ? 'enabled' : 'disabled'}">
                        <i class="ri-${info.status === '已启用' ? 'check-line' : 'time-line'}"></i>
                        ${info.status}
                    </div>
                    
                    <p class="qd-desc">${info.description}</p>
                    
                    <div class="qd-stats">
                        <div class="qd-stat">
                            <i class="ri-file-list-line"></i>
                            <span>${info.questions} 道题目</span>
                        </div>
                        <div class="qd-stat">
                            <i class="ri-time-line"></i>
                            <span>${info.time}</span>
                        </div>
                        <div class="qd-stat">
                            <i class="ri-user-line"></i>
                            <span>${info.usedCount} 人已测</span>
                        </div>
                    </div>
                    
                    <h4 class="qd-section-title">测评维度</h4>
                    <div class="qd-dimensions">
                        ${info.dimensions.map(d => `
                            <div class="qd-dimension">
                                <div class="qd-dim-name">${d.name}</div>
                                <div class="qd-dim-desc">${d.desc}</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    ${info.status === '规划中' ? `
                        <div class="qd-coming-soon">
                            <i class="ri-rocket-line"></i>
                            <p>该问卷正在规划中，敬请期待！</p>
                            <p class="qd-tip">如需优先开发，请联系管理员</p>
                        </div>
                    ` : info.status === '已启用' ? `
                        <div class="qd-actions">
                            <button class="btn btn-secondary" onclick="toggleQuestionnaire('${type}', false)">
                                <i class="ri-close-line"></i> 禁用问卷
                            </button>
                            <button class="btn btn-primary" onclick="closeModal();navigateTo('assessments');switchAssessmentTab('distribute');">
                                <i class="ri-send-plane-line"></i> 分发测评
                            </button>
                        </div>
                    ` : `
                        <div class="qd-actions">
                            <button class="btn btn-primary" onclick="toggleQuestionnaire('${type}', true)">
                                <i class="ri-check-line"></i> 启用此问卷
                            </button>
                        </div>
                        <p class="qd-tip" style="text-align:center;margin-top:var(--space-3);font-size:var(--text-xs);color:var(--text-tertiary);">
                            启用后，候选人可在测评页面选择此问卷进行测评
                        </p>
                    `}
                </div>
            `, null, true);
        }

        function toggleQuestionnaire(type, enable) {
            enabledQuestionnaires[type] = enable;
            localStorage.setItem('enabledQuestionnaires', JSON.stringify(enabledQuestionnaires));
            closeModal();
            showAlertModal(enable ? `已启用「${type.toUpperCase()}」问卷` : `已禁用「${type.toUpperCase()}」问卷`);
            // 刷新问卷卡片状态
            renderQuestionnaireCards();
        }

        function renderQuestionnaireCards() {
            const cards = document.querySelectorAll('.questionnaire-card');
            cards.forEach(card => {
                const type = card.getAttribute('onclick')?.match(/'(\w+)'/)?.[1];
                if (type && type !== 'values') {
                    const statusTag = card.querySelector('.tag');
                    if (statusTag) {
                        const isEnabled = enabledQuestionnaires[type];
                        statusTag.className = `tag ${isEnabled ? 'excellent' : 'medium'}`;
                        statusTag.innerHTML = `<i class="ri-${isEnabled ? 'check-line' : 'add-line'}"></i> ${isEnabled ? '已启用' : '可启用'}`;
                    }
                }
            });
        }

        function showChangePasswordModal() {
            showModal('修改密码', `
                <div class="form-group">
                    <label class="form-label">当前密码</label>
                    <input type="password" class="form-input" id="currentPassword" placeholder="请输入当前密码">
                </div>
                <div class="form-group">
                    <label class="form-label">新密码</label>
                    <input type="password" class="form-input" id="newPassword" placeholder="请输入新密码">
                </div>
                <div class="form-group">
                    <label class="form-label">确认新密码</label>
                    <input type="password" class="form-input" id="confirmPassword" placeholder="请再次输入新密码">
                </div>
            `, () => {
                const current = document.getElementById('currentPassword').value;
                const newPwd = document.getElementById('newPassword').value;
                const confirm = document.getElementById('confirmPassword').value;
                
                if (current !== CONFIG.password) {
                    showAlertModal('当前密码错误');
                    return;
                }
                if (newPwd.length < 6) {
                    showAlertModal('新密码至少6位');
                    return;
                }
                if (newPwd !== confirm) {
                    showAlertModal('两次输入的密码不一致');
                    return;
                }
                
                // 注意：纯前端无法真正修改密码，这里只是演示
                showAlertModal('密码修改成功（演示模式，实际未生效）');
                closeModal();
            });
        }

        // 保留旧的统计渲染函数以兼容
        function renderAssessmentsPageOld() {
            const today = new Date().toISOString().split('T')[0];
            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
            
            const todayCount = allRecords.filter(r => { try { return new Date(r.createTime).toISOString().split('T')[0] === today; } catch { return false; } }).length;
            const weekCount = allRecords.filter(r => { try { return new Date(r.createTime) >= weekAgo; } catch { return false; } }).length;
            
            const statsEl = document.getElementById('assessmentStats');
            if (statsEl) statsEl.innerHTML = `
                <div class="stat-card blue"><div class="stat-label">总测评</div><div class="stat-value">${allRecords.length}</div></div>
                <div class="stat-card green"><div class="stat-label">今日</div><div class="stat-value">${todayCount}</div></div>
                <div class="stat-card orange"><div class="stat-label">本周</div><div class="stat-value">${weekCount}</div></div>
                <div class="stat-card purple"><div class="stat-label">平均时长</div><div class="stat-value">~5分钟</div></div>
            `;
        }

        function copyTestLink() {
            const input = document.getElementById('testLink');
            input.select();
            document.execCommand('copy');
            showAlertModal('链接已复制');
        }

        function generateQRCode() {
            const link = document.getElementById('testLink').value;
            showModal('测评二维码', `
                <div style="text-align:center;padding:var(--space-4);">
                    <div id="qrcodeContainer" style="display:inline-block;padding:var(--space-4);background:white;border-radius:var(--radius-md);margin-bottom:var(--space-4);">
                        <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(link)}" alt="QR Code" style="display:block;">
                    </div>
                    <p style="font-size:var(--text-sm);color:var(--text-secondary);margin-bottom:var(--space-2);">扫描二维码进入测评</p>
                    <p style="font-size:var(--text-xs);color:var(--text-tertiary);word-break:break-all;">${link}</p>
                </div>
            `);
        }

        // ==================== Settings ====================
        function renderSettingsPage() {
            updateSettingsInfo();
            updateThemeButtons();
        }

        function updateSettingsInfo() {
            const recordCountEl = document.getElementById('settingsRecordCount');
            const storageSizeEl = document.getElementById('settingsStorageSize');
            if (recordCountEl) recordCountEl.textContent = allRecords.length + ' 条';
            if (storageSizeEl) {
                const storageSize = new Blob([JSON.stringify(localStorage)]).size;
                storageSizeEl.textContent = (storageSize / 1024).toFixed(1) + ' KB';
            }
        }

        function updateThemeButtons() {
            const currentTheme = document.body.getAttribute('data-theme') || 'dark';
            const lightBtn = document.getElementById('themeLightBtn');
            const darkBtn = document.getElementById('themeDarkBtn');
            if (lightBtn) lightBtn.classList.toggle('active', currentTheme === 'light');
            if (darkBtn) darkBtn.classList.toggle('active', currentTheme === 'dark');
        }

        // 多问卷理想模型存储
        let idealModels = JSON.parse(localStorage.getItem('idealModels') || '{}');

        function loadIdealModel() {
            // 加载 EPQ 模型
            const epqModel = idealModels.epq || { E: 18, N: 8, P: 10, L: 15 };
            ['E', 'N', 'P', 'L'].forEach(d => {
                const el = document.getElementById('ideal' + d);
                if (el) {
                    el.value = epqModel[d] || 15;
                    updateIdealDisplay(d);
                }
            });

            // 加载 MBTI 模型
            const mbtiModel = idealModels.mbti || { EI: 'any', SN: 'any', TF: 'any', JP: 'any' };
            document.querySelectorAll('.mbti-option').forEach(btn => {
                const dim = btn.dataset.dim;
                const val = btn.dataset.val;
                btn.classList.toggle('active', mbtiModel[dim] === val);
            });
            updateMbtiResult();

            // 加载 DISC 模型
            const discModel = idealModels.disc || { D: 25, I: 25, S: 25, C: 25 };
            ['D', 'I', 'S', 'C'].forEach(d => {
                const el = document.getElementById('ideal' + d);
                if (el) {
                    el.value = discModel[d] || 25;
                }
            });
            updateDiscDisplay();
        }

        function switchModelType(type) {
            document.querySelectorAll('.model-type-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.type === type);
            });
            document.querySelectorAll('.model-type-content').forEach(content => {
                content.classList.toggle('active', content.id === 'model-' + type);
            });
        }

        function toggleMbtiOption(btn) {
            const dim = btn.dataset.dim;
            // 同一维度只能选一个
            document.querySelectorAll(`.mbti-option[data-dim="${dim}"]`).forEach(b => {
                b.classList.remove('active');
            });
            btn.classList.add('active');
            updateMbtiResult();
        }

        function updateMbtiResult() {
            const result = [];
            ['EI', 'SN', 'TF', 'JP'].forEach(dim => {
                const active = document.querySelector(`.mbti-option[data-dim="${dim}"].active`);
                if (active && active.dataset.val !== 'any') {
                    result.push(active.dataset.val);
                }
            });
            const resultEl = document.getElementById('mbtiIdealResult');
            if (resultEl) {
                if (result.length === 0) {
                    resultEl.innerHTML = '当前理想类型：<strong>不限</strong>';
                } else if (result.length === 4) {
                    resultEl.innerHTML = `当前理想类型：<strong>${result.join('')}</strong>`;
                } else {
                    resultEl.innerHTML = `当前理想倾向：<strong>${result.join(' + ')}</strong>`;
                }
            }
        }

        function updateDiscDisplay() {
            let total = 0;
            ['D', 'I', 'S', 'C'].forEach(d => {
                const el = document.getElementById('ideal' + d);
                const valEl = document.getElementById('ideal' + d + 'Val');
                if (el && valEl) {
                    valEl.textContent = el.value;
                    total += parseInt(el.value);
                }
            });
            const totalEl = document.getElementById('discTotal');
            if (totalEl) {
                const color = total === 100 ? 'var(--accent-success)' : 'var(--accent-warning)';
                totalEl.innerHTML = `权重总和：<strong style="color:${color}">${total}%</strong>`;
            }
        }

        function saveIdealModel(type) {
            if (type === 'epq') {
                idealModels.epq = {
                    E: parseInt(document.getElementById('idealE').value),
                    N: parseInt(document.getElementById('idealN').value),
                    P: parseInt(document.getElementById('idealP').value),
                    L: parseInt(document.getElementById('idealL').value)
                };
            } else if (type === 'mbti') {
                idealModels.mbti = {};
                ['EI', 'SN', 'TF', 'JP'].forEach(dim => {
                    const active = document.querySelector(`.mbti-option[data-dim="${dim}"].active`);
                    idealModels.mbti[dim] = active ? active.dataset.val : 'any';
                });
            } else if (type === 'disc') {
                idealModels.disc = {
                    D: parseInt(document.getElementById('idealD').value),
                    I: parseInt(document.getElementById('idealI').value),
                    S: parseInt(document.getElementById('idealS').value),
                    C: parseInt(document.getElementById('idealC').value)
                };
            }
            localStorage.setItem('idealModels', JSON.stringify(idealModels));
            showAlertModal(`${type.toUpperCase()} 理想模型已保存`);
        }

        function updateIdealDisplay(dim) {
            const el = document.getElementById('ideal' + dim);
            const valEl = document.getElementById('ideal' + dim + 'Val');
            if (el && valEl) {
                valEl.textContent = el.value;
            }
        }

        function renderPositionList() {
            const list = document.getElementById('positionList');
            if (!systemPositions.length) {
                list.innerHTML = '<div class="empty-state"><i class="ri-briefcase-line"></i><h3>暂无岗位</h3></div>';
                return;
            }
            list.innerHTML = systemPositions.map((p, i) => `
                <div class="settings-item">
                    <div class="settings-item-info">
                        <h4>${p}</h4>
                        <p>${allRecords.filter(r => r.position === p).length} 位候选人</p>
                    </div>
                    <div class="settings-item-actions">
                        <button class="btn btn-ghost btn-sm" onclick="editPosition(${i})"><i class="ri-edit-line"></i></button>
                        <button class="btn btn-ghost btn-sm" onclick="deletePosition(${i})"><i class="ri-delete-bin-line"></i></button>
                    </div>
                </div>
            `).join('');
        }

        function showAddPositionModal() {
            showInputModal('添加岗位', '岗位名称', '', (val) => {
                if (!val.trim()) return;
                if (systemPositions.includes(val.trim())) return showAlertModal('岗位已存在');
                systemPositions.push(val.trim());
                localStorage.setItem('epqPositions', JSON.stringify(systemPositions));
                renderPositionList();
                renderPositionListAssessment();
            });
        }

        function showPositionModelModal(positionName) {
            const models = positionIdealModels[positionName] || { 
                epq: { E: 15, N: 10, P: 10, L: 15 },
                mbti: { EI: 'any', SN: 'any', TF: 'any', JP: 'any' },
                disc: { D: 25, I: 25, S: 25, C: 25 }
            };
            const epq = models.epq || { E: 15, N: 10, P: 10, L: 15 };
            window._currentPositionName = positionName;
            
            showModal(`设置「${positionName}」理想人才模型`, `
                <div class="pos-model-tabs">
                    <button class="pos-model-tab active" onclick="switchPosModelTab('epq')">EPQ</button>
                    <button class="pos-model-tab" onclick="switchPosModelTab('mbti')">MBTI</button>
                    <button class="pos-model-tab" onclick="switchPosModelTab('disc')">DISC</button>
                </div>
                
                <div class="pos-model-content active" id="posModel-epq">
                    <p style="font-size:var(--text-xs);color:var(--text-tertiary);margin-bottom:var(--space-3);">设置 EPQ 各维度理想分值</p>
                    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:var(--space-3);">
                        <div class="form-group">
                            <label class="form-label" style="font-size:var(--text-xs);">E 外向性</label>
                            <input type="range" id="posModelE" min="0" max="24" value="${epq.E}" style="width:100%;" oninput="document.getElementById('posModelEVal').textContent=this.value">
                            <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--text-tertiary);"><span>0</span><span id="posModelEVal">${epq.E}</span><span>24</span></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" style="font-size:var(--text-xs);">N 神经质</label>
                            <input type="range" id="posModelN" min="0" max="24" value="${epq.N}" style="width:100%;" oninput="document.getElementById('posModelNVal').textContent=this.value">
                            <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--text-tertiary);"><span>0</span><span id="posModelNVal">${epq.N}</span><span>24</span></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" style="font-size:var(--text-xs);">P 精神质</label>
                            <input type="range" id="posModelP" min="0" max="24" value="${epq.P}" style="width:100%;" oninput="document.getElementById('posModelPVal').textContent=this.value">
                            <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--text-tertiary);"><span>0</span><span id="posModelPVal">${epq.P}</span><span>24</span></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" style="font-size:var(--text-xs);">L 掩饰性</label>
                            <input type="range" id="posModelL" min="0" max="24" value="${epq.L}" style="width:100%;" oninput="document.getElementById('posModelLVal').textContent=this.value">
                            <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--text-tertiary);"><span>0</span><span id="posModelLVal">${epq.L}</span><span>24</span></div>
                        </div>
                    </div>
                </div>
                
                <div class="pos-model-content" id="posModel-mbti">
                    <p style="font-size:var(--text-xs);color:var(--text-tertiary);margin-bottom:var(--space-3);">选择理想的 MBTI 维度倾向</p>
                    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:var(--space-3);">
                        <div class="mbti-mini-dim"><span>E-I</span><select id="posModelEI"><option value="any">不限</option><option value="E">E 外向</option><option value="I">I 内向</option></select></div>
                        <div class="mbti-mini-dim"><span>S-N</span><select id="posModelSN"><option value="any">不限</option><option value="S">S 感觉</option><option value="N">N 直觉</option></select></div>
                        <div class="mbti-mini-dim"><span>T-F</span><select id="posModelTF"><option value="any">不限</option><option value="T">T 思考</option><option value="F">F 情感</option></select></div>
                        <div class="mbti-mini-dim"><span>J-P</span><select id="posModelJP"><option value="any">不限</option><option value="J">J 判断</option><option value="P">P 感知</option></select></div>
                    </div>
                </div>
                
                <div class="pos-model-content" id="posModel-disc">
                    <p style="font-size:var(--text-xs);color:var(--text-tertiary);margin-bottom:var(--space-3);">设置 DISC 各维度权重</p>
                    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:var(--space-3);">
                        <div class="form-group"><label class="form-label" style="font-size:var(--text-xs);color:#ef4444;">D 支配型</label><input type="range" id="posModelD" min="0" max="100" value="25" style="width:100%;"></div>
                        <div class="form-group"><label class="form-label" style="font-size:var(--text-xs);color:#f59e0b;">I 影响型</label><input type="range" id="posModelI" min="0" max="100" value="25" style="width:100%;"></div>
                        <div class="form-group"><label class="form-label" style="font-size:var(--text-xs);color:#22c55e;">S 稳健型</label><input type="range" id="posModelS" min="0" max="100" value="25" style="width:100%;"></div>
                        <div class="form-group"><label class="form-label" style="font-size:var(--text-xs);color:#3b82f6;">C 谨慎型</label><input type="range" id="posModelC" min="0" max="100" value="25" style="width:100%;"></div>
                    </div>
                </div>
            `, `<button class="btn btn-secondary" onclick="closeModal()">取消</button>
                <button class="btn btn-primary" onclick="savePositionModel()">保存全部</button>`, true);
        }

        function switchPosModelTab(type) {
            document.querySelectorAll('.pos-model-tab').forEach(t => t.classList.toggle('active', t.textContent === type.toUpperCase()));
            document.querySelectorAll('.pos-model-content').forEach(c => c.classList.toggle('active', c.id === 'posModel-' + type));
        }

        function savePositionModel() {
            const positionName = window._currentPositionName;
            positionIdealModels[positionName] = {
                epq: {
                    E: parseInt(document.getElementById('posModelE').value),
                    N: parseInt(document.getElementById('posModelN').value),
                    P: parseInt(document.getElementById('posModelP').value),
                    L: parseInt(document.getElementById('posModelL').value)
                },
                mbti: {
                    EI: document.getElementById('posModelEI').value,
                    SN: document.getElementById('posModelSN').value,
                    TF: document.getElementById('posModelTF').value,
                    JP: document.getElementById('posModelJP').value
                },
                disc: {
                    D: parseInt(document.getElementById('posModelD').value),
                    I: parseInt(document.getElementById('posModelI').value),
                    S: parseInt(document.getElementById('posModelS').value),
                    C: parseInt(document.getElementById('posModelC').value)
                }
            };
            localStorage.setItem('positionIdealModels', JSON.stringify(positionIdealModels));
            closeModal();
            renderPositionListAssessment();
            showAlertModal('理想模型已保存');
        }

        function editPosition(idx) {
            const old = systemPositions[idx];
            showInputModal('编辑岗位', '岗位名称', old, (val) => {
                if (!val.trim() || val.trim() === old) return;
                if (systemPositions.includes(val.trim())) return showAlertModal('岗位已存在');
                allRecords.forEach(r => { if (r.position === old) r.position = val.trim(); });
                localStorage.setItem(CONFIG.storageKey, JSON.stringify(allRecords));
                // 更新理想模型的key
                if (positionIdealModels[old]) {
                    positionIdealModels[val.trim()] = positionIdealModels[old];
                    delete positionIdealModels[old];
                    localStorage.setItem('positionIdealModels', JSON.stringify(positionIdealModels));
                }
                systemPositions[idx] = val.trim();
                localStorage.setItem('epqPositions', JSON.stringify(systemPositions));
                renderPositionList();
                renderPositionListAssessment();
            });
        }

        function deletePosition(idx) {
            const pos = systemPositions[idx];
            const count = allRecords.filter(r => r.position === pos).length;
            showConfirmModal(`删除岗位"${pos}"？${count ? `（${count}条记录将清空岗位）` : ''}`, () => {
                allRecords.forEach(r => { if (r.position === pos) r.position = ''; });
                localStorage.setItem(CONFIG.storageKey, JSON.stringify(allRecords));
                systemPositions.splice(idx, 1);
                localStorage.setItem('epqPositions', JSON.stringify(systemPositions));
                renderPositionList();
            });
        }

        function saveIdealModel() {
            const model = {
                E: parseInt(document.getElementById('idealE').value),
                N: parseInt(document.getElementById('idealN').value),
                P: parseInt(document.getElementById('idealP').value),
                L: parseInt(document.getElementById('idealL').value)
            };
            localStorage.setItem('epqIdealModel', JSON.stringify(model));
            showAlertModal('保存成功');
        }

        function backupData() {
            const data = { records: allRecords, positions: systemPositions, idealModel: JSON.parse(localStorage.getItem('epqIdealModel') || '{}'), time: new Date().toISOString() };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `epq_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        function importData(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(ev) {
                try {
                    const data = JSON.parse(ev.target.result);
                    showConfirmModal('确定导入？将覆盖现有数据', () => {
                        if (data.records) { allRecords = data.records; localStorage.setItem(CONFIG.storageKey, JSON.stringify(allRecords)); }
                        if (data.positions) { systemPositions = data.positions; localStorage.setItem('epqPositions', JSON.stringify(systemPositions)); }
                        if (data.idealModel) localStorage.setItem('epqIdealModel', JSON.stringify(data.idealModel));
                        location.reload();
                    });
                } catch { showAlertModal('文件格式错误'); }
            };
            reader.readAsText(file);
            e.target.value = '';
        }

        function clearAllData() {
            showConfirmModal('确定清空所有数据？此操作不可恢复', () => {
                localStorage.removeItem(CONFIG.storageKey);
                localStorage.removeItem('epqPositions');
                localStorage.removeItem('epqIdealModel');
                location.reload();
            });
        }

        // 生成测试数据
        function generateTestData() {
            const names = ['张伟', '李娜', '王强', '刘洋', '陈明', '杨芳', '赵磊', '黄丽', '周杰', '吴敏', 
                           '郑涛', '孙静', '马超', '朱婷', '胡军', '林燕', '何欣', '高峰', '罗琳', '谢宇'];
            const positions = systemPositions.length > 0 ? systemPositions : ['产品经理', '前端开发', '后端开发', '设计师', '运营专员'];
            
            const count = 20;
            const newRecords = [];
            
            for (let i = 0; i < count; i++) {
                const name = names[Math.floor(Math.random() * names.length)];
                const position = positions[Math.floor(Math.random() * positions.length)];
                const phone = '1' + ['3', '5', '7', '8', '9'][Math.floor(Math.random() * 5)] + Math.random().toString().slice(2, 11);
                
                // 随机生成过去30天内的时间
                const daysAgo = Math.floor(Math.random() * 30);
                const date = new Date(Date.now() - daysAgo * 24 * 60 * 60 * 1000);
                const createTime = date.getFullYear() + '-' + 
                    String(date.getMonth() + 1).padStart(2, '0') + '-' + 
                    String(date.getDate()).padStart(2, '0') + ' ' +
                    String(date.getHours()).padStart(2, '0') + ':' +
                    String(date.getMinutes()).padStart(2, '0') + ':' +
                    String(date.getSeconds()).padStart(2, '0');
                
                // 随机生成EPQ分数
                const scores = {
                    E: Math.floor(Math.random() * 20) + 4,
                    N: Math.floor(Math.random() * 20) + 2,
                    P: Math.floor(Math.random() * 18) + 3,
                    L: Math.floor(Math.random() * 20) + 4
                };
                
                newRecords.push({
                    id: 'test_' + Date.now() + '_' + i,
                    name: name,
                    phone: phone,
                    position: position,
                    remark: '',
                    scores: scores,
                    answers: {},
                    createTime: createTime
                });
            }
            
            // 合并到现有数据
            allRecords = [...allRecords, ...newRecords];
            localStorage.setItem(CONFIG.storageKey, JSON.stringify(allRecords));
            
            // 确保岗位存在
            positions.forEach(pos => {
                if (!systemPositions.includes(pos)) {
                    systemPositions.push(pos);
                }
            });
            localStorage.setItem('epqPositions', JSON.stringify(systemPositions));
            
            showAlertModal(`成功生成 ${count} 条测试数据`);
            loadData();
            navigateTo('overview');
        }

        // ==================== Modal System ====================
        function showModal(title, body, footer = null, large = false) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = body;
            document.getElementById('modalFooter').innerHTML = footer || '';
            document.getElementById('modalContent').classList.toggle('large', large);
            document.getElementById('modalOverlay').classList.add('show');
        }

        function closeModal(e) {
            if (e && e.target !== e.currentTarget) return;
            document.getElementById('modalOverlay').classList.remove('show');
        }

        function showAlertModal(msg) {
            showModal('提示', `<p style="text-align:center;color:var(--text-secondary);padding:var(--space-4) 0;">${msg}</p>`, 
                '<button class="btn btn-primary" onclick="closeModal()">确定</button>');
        }

        function showConfirmModal(msg, onConfirm) {
            showModal('确认', `<p style="text-align:center;color:var(--text-secondary);padding:var(--space-4) 0;">${msg}</p>`,
                `<button class="btn btn-secondary" onclick="closeModal()">取消</button>
                 <button class="btn btn-primary" onclick="closeModal();(${onConfirm.toString()})()">确定</button>`);
        }

        let _inputModalCallback = null;
        
        function showInputModal(title, label, value, onSubmit) {
            _inputModalCallback = onSubmit;
            showModal(title, `
                <div class="form-group" style="margin:0;">
                    <label class="form-label">${label}</label>
                    <input type="text" class="form-input" id="modalInput" value="${value}">
                </div>`,
                `<button class="btn btn-secondary" onclick="closeModal()">取消</button>
                 <button class="btn btn-primary" onclick="submitInputModal()">确定</button>`);
            setTimeout(() => document.getElementById('modalInput').focus(), 100);
        }

        function submitInputModal() {
            const v = document.getElementById('modalInput').value;
            closeModal();
            if (_inputModalCallback) {
                _inputModalCallback(v);
                _inputModalCallback = null;
            }
        }

        // ==================== Expose ====================
        window.handleLogin = handleLogin;
        window.handleLogout = handleLogout;
        window.navigateTo = navigateTo;
        window.applyCandidateFilters = applyCandidateFilters;
        window.resetCandidateFilters = resetCandidateFilters;
        window.quickDateFilter = quickDateFilter;
        window.sortTable = sortTable;
        window.goToPage = goToPage;
        window.toggleSelectAll = toggleSelectAll;
        window.toggleRecordSelection = toggleRecordSelection;
        window.batchDelete = batchDelete;
        window.exportFilteredData = exportFilteredData;
        window.viewCandidate = viewCandidate;
        window.refreshAnalytics = refreshAnalytics;
        window.copyTestLink = copyTestLink;
        window.showAddPositionModal = showAddPositionModal;
        window.editPosition = editPosition;
        window.deletePosition = deletePosition;
        window.saveIdealModel = saveIdealModel;
        window.submitInputModal = submitInputModal;
        window.backupData = backupData;
        window.importData = importData;
        window.clearAllData = clearAllData;
        window.generateTestData = generateTestData;
        window.toggleQuestionnaire = toggleQuestionnaire;
        window.renderQuestionnaireCards = renderQuestionnaireCards;
        window.closeModal = closeModal;
    </script>
</body>
</html>


