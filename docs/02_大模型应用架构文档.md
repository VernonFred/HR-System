# QZ·TalentLens 大模型架构文档

**文档版本**: V3.0 
**最后更新**: 2025-12-12

---

## 📋 大模型在系统中的定位

### 核心理念

**大模型不是"黑盒"，而是"AI副驾驶"**

- ❌ 错误理解：AI完全接管决策
- ✅ 正确定位：AI提供专业洞察，HR保留最终决策权

**设计哲学**:
```
传统系统: 数据 → 人工解读 → 决策
我们的系统: 数据 → AI洞察 + 算法验证 → HR决策
```

---

## 🤖 大模型选型策略

### 1. 多模型分层架构

**为什么不用单一模型？**

| 单一模型问题 | 多模型解决方案 |
|------------|---------------|
| 成本高（全用大模型） | 分层调用，成本降低80% |
| 速度慢（全用大模型） | 快速场景用小模型 |
| 质量不稳定（全用小模型） | 关键场景用顶级模型 |

### 2. 三层模型矩阵

```
┌─────────────────────────────────────────────────────────┐
│                  大模型分层路由架构                        │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  Tier 1: 专家级分析 (15%场景)                             │
│  ├─ 模型: DeepSeek-R1 (671B参数，深度推理)               │
│  ├─ 特点: 长思维链 (CoT)，深度推理                        │
│  ├─ 速度: ~15秒/次                                       │
│  ├─ 成本: ¥0.14/次                                       │
│  └─ 场景: 管理岗、核心岗、复杂背景候选人                   │
│                                                           │
│  Tier 2: 深度分析 (70%场景) ⭐ 推荐                       │
│  ├─ 模型: Qwen2.5-32B                                    │
│  ├─ 特点: 性能均衡，中文优化                              │
│  ├─ 速度: ~7秒/次                                        │
│  ├─ 成本: ¥0.024/次                                      │
│  └─ 场景: 通用岗位、日常招聘                              │
│                                                           │
│  Tier 3: 快速分析 (5%场景)                               │
│  ├─ 模型: Qwen2.5-7B                                     │
│  ├─ 特点: 快速响应，兜底                                  │
│  ├─ 速度: ~3秒/次                                        │
│  ├─ 成本: ¥0.005/次                                      │
│  └─ 场景: 快速预览、AI超时兜底                            │
│                                                           │
│  Tier 4: 规则引擎 (10%场景)                              │
│  ├─ 模型: 无 (基于规则)                                  │
│  ├─ 特点: 100%可用性                                     │
│  ├─ 速度: <1秒                                           │
│  ├─ 成本: ¥0                                             │
│  └─ 场景: AI失败降级、离线场景                            │
│                                                           │
└─────────────────────────────────────────────────────────┘
```

### 3. 模型详细对比

#### 模型1: DeepSeek-R1 (专家级)

**技术特点**:
- 参数规模: 671B (全球顶级)
- 核心能力: **深度推理** (Reasoning)
- 思维链长度: 平均3000+ tokens
- 中文能力: ⭐⭐⭐⭐⭐

**适用场景**:
1. **管理岗位候选人**
   - 需要深度分析领导风格
   - 预测团队管理能力
   - 评估战略思维

2. **复杂背景候选人**
   - 跨行业转型
   - 空白期较长
   - 职业路径非传统

3. **关键岗位**
   - 核心技术岗
   - 高级产品岗
   - 业务负责人

**输出质量示例**:

```
【专家分析 - DeepSeek-R1】

候选人张三具有典型的"产品思维型人格"，在MBTI测评中展现的ENTP特质
与简历中"0到1产品经历"高度吻合。

深度洞察:
1. 适合场景: B轮-C轮快速扩张期的产品经理
   - 原因: 其"敢于试错、快速迭代"的特质与创业公司节奏匹配
   - 上级搭配: 需要强执行力的技术leader，弥补其细节把控短板
   - 组织要求: 扁平化、快节奏、容错度高

2. 避雷指南:
   - ❌ 成熟期大厂: 规范化流程限制创新发挥
   - ❌ 传统行业: 决策链条过长，难以适应
   - ❌ 强KPI导向: 可能因过于关注创新而忽视数据

3. 面试建议:
   - 重点验证: 执行力、细节把控、团队协作
   - 关键问题: "如何平衡创新与执行？"
   - 风险点: 是否有过度理想化倾向

预测: 入职前3个月表现优异，6个月后需关注执行力瓶颈。
```

---

#### 模型2: Qwen2.5-32B (默认推荐)

**技术特点**:
- 参数规模: 32B
- 核心能力: **中文理解+逻辑推理**
- 响应速度: 快 (7秒)
- 性价比: ⭐⭐⭐⭐⭐

**适用场景**:
1. **通用岗位** (80%场景)
   - 产品、运营、市场、设计
   - 技术岗 (非架构师)
   - 职能岗

2. **日常招聘**
   - 快速初筛
   - 批量评估
   - 标准化岗位

**输出质量示例**:

```
【深度分析 - Qwen2.5-32B】

候选人张三在MBTI测评中展现出ENTP特质，具有较强的创新能力和外向性格。

岗位推荐:
最适合产品经理岗位，尤其是需要快速迭代和创新的场景。建议匹配强执行
力的团队配合。

优势:
- 创新思维活跃，善于发现新机会
- 沟通能力强，能有效推动跨部门协作

风险:
- 执行细节可能不够严谨
- 面对重复性工作可能缺乏耐心

发展建议:
- 加强项目管理能力训练
- 学习数据驱动决策方法
```

**对比DeepSeek-R1**:
- ✅ 速度快50%
- ✅ 成本降低85%
- ⚠️ 洞察深度略浅（但对通用岗位足够）
- ⚠️ 预测性不如DeepSeek-R1

---

#### 模型3: Qwen2.5-7B (快速兜底)

**技术特点**:
- 参数规模: 7B
- 核心能力: **快速响应**
- 响应速度: 极快 (3秒)
- 定位: 兜底保障

**适用场景**:
1. **快速预览**
   - HR快速浏览候选人
   - 不需要深度分析

2. **AI超时兜底**
   - 32B模型超时时自动降级
   - 保证系统可用性

**输出质量示例**:

```
【快速分析 - Qwen2.5-7B】

基于MBTI测评结果，候选人张三展现出ENTP特质。

推荐岗位: 产品经理、项目管理
优势: 创新能力强，善于沟通
风险: 执行细节需注意
```

**特点**:
- ✅ 速度极快
- ✅ 兜底保障
- ⚠️ 洞察较浅
- ⚠️ 建议作为备选，非主力

---

## 🎯 大模型在各功能中的应用

### 应用1: 人才画像生成

#### 调用时机
```
HR打开候选人画像卡片
    ↓
检查缓存 (是否有对应分析级别的缓存)
    ├─ 有 → 直接返回缓存
    └─ 无 → 触发大模型调用
        ↓
        判断分析级别
        ├─ Expert → DeepSeek-R1
        ├─ Pro → Qwen2.5-32B
        └─ Normal → Qwen2.5-7B
        ↓
        AI生成画像
        ↓
        缓存结果 (7天有效期)
        ↓
        返回给前端
```

#### Prompt 工程策略

**System Prompt (系统角色)**:
```
你是一位资深的人力资源专家和心理学顾问，拥有20年以上的人才评估经验。

核心能力:
1. 深度解读专业测评结果 (MBTI/DISC/EPQ)
2. 分析候选人简历，识别核心能力和潜在风险
3. 提供岗位匹配建议，包含场景分析和上级搭配
4. 预测候选人在不同工作环境中的表现

输出要求:
- 洞察而非描述: 不只说"外向"，而要说"外向如何影响工作表现"
- 场景化建议: 不只推荐岗位名称，而要说明适合"什么样的"岗位
- 风险识别: 主动指出可能的风险点，而非只说优点
- 行为预测: 预测候选人在具体场景中的可能行为
```

**User Prompt (用户输入)**:
```
【候选人基本信息】
姓名: 张三
应聘岗位: 产品经理

【测评结果】
测评类型: MBTI
结果: ENTP
行为特征观察:
- 外向性: 85分 (喜欢与人交流，精力充沛)
- 直觉思维: 78分 (善于抽象思考，关注未来可能性)
- 思考型: 72分 (决策理性，重逻辑轻情感)
- 感知型: 80分 (灵活应变，不喜欢固定流程)

【简历分析】
工作经历:
- 2022-2024: 某创业公司，产品经理，从0到1搭建SaaS产品
- 2020-2022: 阿里巴巴，产品运营，负责用户增长

项目经验:
- B端SaaS产品从0到1
- 用户增长策略设计与落地
- 跨部门协作推动产品迭代

【能力匹配算法分析】  ← 🟢 P2-3增强
基于候选人的能力维度评估，系统识别出以下岗位在"硬实力"上与候选人
较为匹配:

候选岗位:
  • 产品经理 (匹配度: 92分)
  • 项目管理 (匹配度: 78分)
  • 运营专员 (匹配度: 65分)

⚠️ 重要提醒:
这只是"能力层面"的初步筛选，你的任务是从更深层次分析真正的适配性。

【你需要深度分析的核心问题】
1. 最适合什么样的具体场景？
   - 组织阶段 (种子期/A轮/B轮/成熟期)
   - 团队类型 (创业团队/大厂/传统企业)
   - 管理风格 (扁平化/科层制)

2. 为什么这个场景最适合？
   - 候选人的哪些性格特质与场景匹配？
   - 哪些能力可以在这个场景发挥？

3. 需要什么样的上级/团队配合？
   - 上级应具备什么特质？
   - 团队成员应如何搭配？

4. 避免什么场景？
   - 哪些场景会限制候选人发挥？
   - 可能导致什么风险？

【严格禁止】
❌ 简单罗列: "适合产品经理"
✅ 正确深度: "最适合B轮-C轮快速扩张期的产品经理岗位，需要..."

❌ 泛泛而谈: "沟通能力强"
✅ 正确深度: "在跨部门协作中能快速建立信任，但需注意..."

【输出格式】
请按以下JSON格式输出:
{
  "personality_analysis": "人格特质分析...",
  "competency_assessment": {
    "沟通协调": {"score": 85, "description": "具体行为描述..."},
    ...
  },
  "strengths": ["优势1", "优势2", ...],
  "risks": ["风险1", "风险2", ...],
  "suitable_positions": ["深度场景分析..."],
  "unsuitable_positions": ["避雷指南..."],
  "interview_focus": ["面试验证点1", ...],
  "development_suggestions": ["发展建议1", ...]
}
```

#### Prompt 迭代历史

**V1.0 (2025-12月1日)** - 基础版
```
问题: AI只推荐岗位名称，没有场景分析
改进: 增加"为什么适合"的要求
```

**V2.0 (2025-12月8日)** - 场景化
```
问题: AI的建议过于泛泛，缺乏可执行性
改进: 增加"上级搭配"、"避雷指南"、"面试建议"
```

**V3.0 (2025-12月10日)** - 算法融合 ⭐ 当前版本
```
问题: AI推荐的岗位可能不在HR的岗位库中
改进: 先用算法推荐候选岗位，AI基于候选岗位进行深度分析
结果: 既有数据依据，又有深度洞察
```

---

### 应用2: 简历解析

#### 调用时机
```
HR上传简历
    ↓
文本提取 (PDF/Word → 纯文本)
    ↓
调用大模型解析
    ├─ 模型: Qwen2.5-32B (固定)
    ├─ 任务: 结构化提取
    └─ 超时: 15秒
    ↓
返回结构化数据
    ├─ 基本信息
    ├─ 教育背景
    ├─ 工作经历
    ├─ 项目经验
    └─ 技能列表
    ↓
存储到数据库
```

#### Prompt 设计

**System Prompt**:
```
你是一个专业的简历解析助手，擅长从非结构化文本中提取关键信息。

任务:
1. 提取基本信息: 姓名、联系方式、求职意向
2. 提取教育背景: 学校、专业、学历、时间
3. 提取工作经历: 公司、职位、时间、职责、成果
4. 提取项目经验: 项目名称、角色、技术、成效
5. 提取技能列表: 专业技能、语言、证书

输出要求:
- 严格JSON格式
- 时间统一为YYYY-MM格式
- 无信息则返回null，不要编造
```

**User Prompt**:
```
请解析以下简历，提取关键信息:

【简历文本】
张三
联系方式: 13800138000
邮箱: zhangsan@example.com

教育背景:
2016-2020 清华大学 计算机科学与技术 本科

工作经历:
2022-2024 某创业公司
产品经理
- 从0到1搭建B端SaaS产品...
...

【输出格式】
{
  "basic_info": {...},
  "education": [...],
  "work_experience": [...],
  "projects": [...],
  "skills": [...]
}
```

---

### 应用3: JD解析 (岗位画像配置)

#### 调用时机
```
HR点击"导入JD"
    ↓
粘贴岗位描述
    ↓
调用大模型解析
    ├─ 模型: Qwen2.5-32B
    ├─ 任务: 提取能力维度
    └─ 超时: 10秒
    ↓
返回能力维度列表
    ├─ 维度名称
    ├─ 重要程度 (1-5)
    └─ 依据 (从JD中提取的原文)
    ↓
HR确认/修改
    ↓
保存岗位画像
```

#### Prompt 设计

**System Prompt**:
```
你是一个岗位分析专家，擅长从JD中提取关键能力要求。

任务:
1. 识别岗位的核心能力维度
2. 评估每个能力的重要程度 (1-5)
3. 提供依据 (从JD原文中提取)

能力维度参考:
- 沟通协调、团队协作、学习能力、抗压能力
- 问题解决、创新思维、执行力、领导力

输出要求:
- 严格JSON格式
- 重要程度必须有明确依据
- 不要编造JD中没有的要求
```

**User Prompt**:
```
请分析以下岗位描述，提取能力维度:

【JD】
岗位: 产品经理
职责:
1. 负责产品规划和需求分析
2. 跨部门协作推动产品落地
3. 数据驱动产品迭代优化

要求:
1. 3年以上产品经验
2. 优秀的沟通协调能力
3. 逻辑思维清晰，善于分析问题
4. 有0到1产品经验优先

【输出格式】
{
  "dimensions": [
    {
      "name": "沟通协调",
      "importance": 5,
      "evidence": "跨部门协作推动产品落地"
    },
    ...
  ]
}
```

---

## 🔧 大模型调用架构

### 1. 统一调用层

```
┌─────────────────────────────────────────────────────────┐
│               AI Service 统一调用层                        │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  功能1: 模型路由                                          │
│  ├─ 根据分析级别选择模型                                  │
│  ├─ 自动降级 (超时/失败)                                  │
│  └─ 成本控制                                             │
│                                                           │
│  功能2: Prompt 管理                                       │
│  ├─ 统一Prompt模板                                       │
│  ├─ 动态参数注入                                         │
│  └─ 版本控制                                             │
│                                                           │
│  功能3: 结果验证                                          │
│  ├─ JSON格式校验                                         │
│  ├─ 必填字段检查                                         │
│  └─ 降级重试                                             │
│                                                           │
│  功能4: 缓存管理                                          │
│  ├─ 按分析级别缓存                                        │
│  ├─ 版本控制 (数据变更失效)                               │
│  └─ 有效期管理 (7天)                                     │
│                                                           │
│  功能5: 监控告警                                          │
│  ├─ 成功率监控                                           │
│  ├─ 耗时监控                                             │
│  └─ 成本监控                                             │
│                                                           │
└─────────────────────────────────────────────────────────┘
```

### 2. 调用流程

```python
# 伪代码示例

async def generate_portrait(candidate_id, analysis_level):
    # 1. 检查缓存
    cache_key = f"portrait:{candidate_id}:{analysis_level}"
    if cached := get_cache(cache_key):
        return cached
    
    # 2. 准备数据
    data = prepare_data(candidate_id)
    
    # 3. 选择模型
    model = select_model(analysis_level)
    # Expert → DeepSeek-R1
    # Pro → Qwen2.5-32B
    # Normal → Qwen2.5-7B
    
    # 4. 构建Prompt
    prompt = build_prompt(data, analysis_level)
    
    # 5. 调用大模型
    try:
        result = await call_ai(model, prompt, timeout=15)
    except TimeoutError:
        # 降级到小模型
        result = await call_ai("qwen2.5-7b", prompt, timeout=8)
    except Exception:
        # 降级到规则引擎
        result = fallback_analysis(data)
    
    # 6. 验证结果
    validated = validate_result(result)
    
    # 7. 缓存结果
    set_cache(cache_key, validated, ttl=7*24*3600)
    
    # 8. 返回
    return validated
```

### 3. 降级保护策略

**降级链路**:
```
DeepSeek-R1 (15秒超时)
    ↓ 失败/超时
Qwen2.5-32B (10秒超时)
    ↓ 失败/超时
Qwen2.5-7B (8秒超时)
    ↓ 失败/超时
规则引擎 (100%可用)
```

**降级触发条件**:
1. **超时**: 超过预设时间
2. **API错误**: 模型服务不可用
3. **格式错误**: 返回结果无法解析
4. **成本限制**: 达到日成本上限

**降级标识**:
- 前端显示"规则分析"徽章
- 提示"AI暂时不可用，已使用规则分析"
- 提供"重新生成"按钮

---

## 📊 大模型性能监控

### 核心指标

| 指标 | 目标值 | 告警阈值 |
|-----|--------|---------|
| AI成功率 | ≥95% | <90% |
| 平均耗时 (32B) | <8秒 | >12秒 |
| 平均耗时 (R1) | <18秒 | >25秒 |
| 日成本 | <¥100 | >¥150 |
| 缓存命中率 | ≥70% | <50% |

### 成本预估

**月度成本预估** (假设100个候选人/月):

| 场景 | 调用次数 | 模型 | 单价 | 小计 |
|-----|---------|------|------|------|
| 首次生成 (Pro) | 70 | 32B | ¥0.024 | ¥1.68 |
| 首次生成 (Expert) | 15 | R1 | ¥0.14 | ¥2.10 |
| 重新生成 | 30 | 32B | ¥0.024 | ¥0.72 |
| 简历解析 | 80 | 32B | ¥0.02 | ¥1.60 |
| JD解析 | 20 | 32B | ¥0.015 | ¥0.30 |
| **总计** | - | - | - | **¥6.4/月** |

**成本优化手段**:
- ✅ 缓存机制: 降低70%重复调用
- ✅ 分层路由: 大部分场景用32B
- ✅ 批量处理: 减少API调用次数

---

## 🎯 大模型优化路线图

### 已完成

- ✅ 多模型分层架构
- ✅ Prompt工程优化 (V3.0)
- ✅ 算法+AI融合 (P2-3)
- ✅ 降级保护机制
- ✅ 缓存机制

### 进行中

- 🔄 Fine-tuning (针对HR场景)
- 🔄 Few-shot学习 (提供示例)
- 🔄 输出质量评分 (人工标注)

### 规划中

- 📅 自定义Prompt模板 (HR可配置)
- 📅 多轮对话 (HR追问AI)
- 📅 AI解释性增强 (显示推理过程)

---

## 📝 总结

### 大模型的核心价值

1. **深度洞察**
   - 不只是数据展示，而是提供专业解读
   - 不只是岗位推荐，而是场景适配分析

2. **效率提升**
   - 自动化简历解析: 节省80%阅读时间
   - 自动化JD分析: 5分钟完成岗位配置
   - 自动化画像生成: 10秒完成专家级分析

3. **决策支持**
   - 提供多维度数据支撑
   - 识别潜在风险点
   - 给出面试验证建议

4. **持续进化**
   - 模型可升级
   - Prompt可优化
   - 算法可迭代

### 与传统系统的本质差异

| 维度 | 传统系统 | 我们的系统 |
|-----|---------|----------|
| 数据处理 | 统计分析 | AI深度推理 |
| 输出内容 | 数字+维度 | 洞察+建议 |
| 更新方式 | 重新测评 | 实时重新生成 |
| 可解释性 | 黑盒 | 白盒 (显示推理依据) |
| 适应性 | 固定规则 | 动态学习 |

---

**文档维护**: 产品架构人员（企业综合事务部）   
**版本历史**: V1.0 (2025-12) → VV3.0 (2025-12)

