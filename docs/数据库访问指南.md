# ğŸ“Š æ•°æ®åº“è®¿é—®æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•è®¿é—®å’Œç®¡ç† HR äººäº‹ç³»ç»Ÿçš„ SQLite æ•°æ®åº“ã€‚

---

## ğŸ“ æ•°æ®åº“ä½ç½®

æ•°æ®åº“æ–‡ä»¶ä½äºï¼š
```
/Users/Pythoné¡¹ç›®/HRäººäº‹/backend/hr.db
```

---

## ğŸ› ï¸ è®¿é—®æ–¹å¼

### æ–¹å¼1ï¼šä½¿ç”¨ SQLite å‘½ä»¤è¡Œå·¥å…·ï¼ˆæ¨èï¼‰âœ…

#### 1.1 æ£€æŸ¥æ˜¯å¦å·²å®‰è£… SQLite
```bash
sqlite3 --version
```

å¦‚æœæœªå®‰è£…ï¼ŒMac ç³»ç»Ÿé€šå¸¸è‡ªå¸¦ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚

#### 1.2 è¿æ¥åˆ°æ•°æ®åº“
```bash
cd /Users/Pythoné¡¹ç›®/HRäººäº‹/backend
sqlite3 hr.db
```

#### 1.3 å¸¸ç”¨ SQLite å‘½ä»¤

**æŸ¥çœ‹æ‰€æœ‰è¡¨**ï¼š
```sql
.tables
```

**æŸ¥çœ‹è¡¨ç»“æ„**ï¼š
```sql
.schema candidates
.schema submissions
.schema questionnaires
```

**æŸ¥çœ‹è¡¨æ•°æ®**ï¼š
```sql
-- æŸ¥çœ‹æ‰€æœ‰å€™é€‰äºº
SELECT * FROM candidates;

-- æŸ¥çœ‹æäº¤è®°å½•
SELECT * FROM submissions;

-- æŸ¥çœ‹é—®å·ä¿¡æ¯
SELECT * FROM questionnaires;
```

**æ ¼å¼åŒ–è¾“å‡º**ï¼š
```sql
-- è®¾ç½®åˆ—æ¨¡å¼
.mode column

-- æ˜¾ç¤ºè¡¨å¤´
.headers on

-- è®¾ç½®åˆ—å®½
.width 10 20 15 10
```

**å¯¼å‡ºæŸ¥è¯¢ç»“æœåˆ°æ–‡ä»¶**ï¼š
```sql
-- å¯¼å‡ºä¸º CSV
.mode csv
.output /Users/Pythoné¡¹ç›®/HRäººäº‹/backend/export.csv
SELECT * FROM candidates;
.output stdout
```

**é€€å‡º SQLite**ï¼š
```sql
.quit
-- æˆ–è€…
.exit
```

---

### æ–¹å¼2ï¼šä½¿ç”¨å›¾å½¢åŒ–å·¥å…·ï¼ˆæ›´å‹å¥½ï¼‰âœ¨

#### æ¨èå·¥å…·ï¼š

**1. DB Browser for SQLiteï¼ˆå…è´¹ï¼Œæ¨èï¼‰**
- ä¸‹è½½åœ°å€ï¼šhttps://sqlitebrowser.org/
- æ”¯æŒï¼šmacOS, Windows, Linux
- åŠŸèƒ½ï¼šå¯è§†åŒ–æµè§ˆã€ç¼–è¾‘ã€æŸ¥è¯¢æ•°æ®åº“

**å®‰è£…æ­¥éª¤**ï¼š
```bash
# ä½¿ç”¨ Homebrew å®‰è£…ï¼ˆMacï¼‰
brew install --cask db-browser-for-sqlite
```

**ä½¿ç”¨æ­¥éª¤**ï¼š
1. æ‰“å¼€ DB Browser
2. ç‚¹å‡» "Open Database"
3. é€‰æ‹©æ–‡ä»¶ï¼š`/Users/Pythoné¡¹ç›®/HRäººäº‹/backend/hr.db`
4. åœ¨ "Browse Data" æ ‡ç­¾é¡µæŸ¥çœ‹è¡¨æ•°æ®
5. åœ¨ "Execute SQL" æ ‡ç­¾é¡µæ‰§è¡ŒæŸ¥è¯¢

**2. SQLiteStudioï¼ˆå…è´¹ï¼‰**
- ä¸‹è½½åœ°å€ï¼šhttps://sqlitestudio.pl/
- è·¨å¹³å°ï¼ŒåŠŸèƒ½å¼ºå¤§

**3. TablePlusï¼ˆä»˜è´¹ï¼Œä½†æœ‰å…è´¹ç‰ˆï¼‰**
- ä¸‹è½½åœ°å€ï¼šhttps://tableplus.com/
- ç•Œé¢ç¾è§‚ï¼Œä½“éªŒå¥½

---

### æ–¹å¼3ï¼šä½¿ç”¨ Python è„šæœ¬

#### 3.1 åˆ›å»ºæŸ¥è¯¢è„šæœ¬

åˆ›å»ºæ–‡ä»¶ï¼š`/Users/Pythoné¡¹ç›®/HRäººäº‹/backend/query_db.py`

```python
#!/usr/bin/env python3
"""
æ•°æ®åº“æŸ¥è¯¢å·¥å…·è„šæœ¬
"""
import sqlite3
import sys
from pathlib import Path

# æ•°æ®åº“è·¯å¾„
DB_PATH = Path(__file__).parent / "hr.db"

def connect_db():
    """è¿æ¥æ•°æ®åº“"""
    return sqlite3.connect(DB_PATH)

def show_tables():
    """æ˜¾ç¤ºæ‰€æœ‰è¡¨"""
    conn = connect_db()
    cursor = conn.cursor()
    cursor.execute("SELECT name FROM sqlite_master WHERE type='table';")
    tables = cursor.fetchall()
    print("ğŸ“Š æ•°æ®åº“ä¸­çš„è¡¨ï¼š")
    for table in tables:
        print(f"  - {table[0]}")
    conn.close()

def show_table_info(table_name):
    """æ˜¾ç¤ºè¡¨ç»“æ„"""
    conn = connect_db()
    cursor = conn.cursor()
    cursor.execute(f"PRAGMA table_info({table_name});")
    columns = cursor.fetchall()
    print(f"\nğŸ“‹ è¡¨ '{table_name}' çš„ç»“æ„ï¼š")
    print(f"{'ID':<5} {'åˆ—å':<30} {'ç±»å‹':<15} {'éç©º':<5} {'é»˜è®¤å€¼':<10} {'ä¸»é”®':<5}")
    print("-" * 80)
    for col in columns:
        print(f"{col[0]:<5} {col[1]:<30} {col[2]:<15} {col[3]:<5} {str(col[4]):<10} {col[5]:<5}")
    conn.close()

def query_table(table_name, limit=10):
    """æŸ¥è¯¢è¡¨æ•°æ®"""
    conn = connect_db()
    conn.row_factory = sqlite3.Row  # ä½¿ç”¨ Row å·¥å‚ä»¥ä¾¿æŒ‰åˆ—åè®¿é—®
    cursor = conn.cursor()
    cursor.execute(f"SELECT * FROM {table_name} LIMIT {limit};")
    rows = cursor.fetchall()
    
    if not rows:
        print(f"\nâŒ è¡¨ '{table_name}' æ²¡æœ‰æ•°æ®")
        conn.close()
        return
    
    print(f"\nğŸ“„ è¡¨ '{table_name}' çš„æ•°æ®ï¼ˆå‰ {limit} æ¡ï¼‰ï¼š")
    
    # æ‰“å°åˆ—å
    columns = rows[0].keys()
    header = " | ".join([f"{col:<20}" for col in columns])
    print(header)
    print("-" * len(header))
    
    # æ‰“å°æ•°æ®
    for row in rows:
        data = " | ".join([f"{str(row[col]):<20}" for col in columns])
        print(data)
    
    conn.close()

def count_records(table_name):
    """ç»Ÿè®¡è¡¨è®°å½•æ•°"""
    conn = connect_db()
    cursor = conn.cursor()
    cursor.execute(f"SELECT COUNT(*) FROM {table_name};")
    count = cursor.fetchone()[0]
    print(f"  {table_name}: {count} æ¡è®°å½•")
    conn.close()
    return count

def show_statistics():
    """æ˜¾ç¤ºæ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯"""
    print("\nğŸ“ˆ æ•°æ®åº“ç»Ÿè®¡ï¼š")
    tables = ['candidates', 'submissions', 'questionnaires', 'assessments']
    for table in tables:
        try:
            count_records(table)
        except sqlite3.OperationalError:
            print(f"  {table}: è¡¨ä¸å­˜åœ¨")

def custom_query(sql):
    """æ‰§è¡Œè‡ªå®šä¹‰ SQL æŸ¥è¯¢"""
    conn = connect_db()
    conn.row_factory = sqlite3.Row
    cursor = conn.cursor()
    try:
        cursor.execute(sql)
        rows = cursor.fetchall()
        
        if not rows:
            print("âœ… æŸ¥è¯¢æˆåŠŸï¼Œä½†æ²¡æœ‰è¿”å›æ•°æ®")
            conn.close()
            return
        
        # æ‰“å°ç»“æœ
        columns = rows[0].keys()
        header = " | ".join([f"{col:<20}" for col in columns])
        print(header)
        print("-" * len(header))
        
        for row in rows:
            data = " | ".join([f"{str(row[col]):<20}" for col in columns])
            print(data)
    except Exception as e:
        print(f"âŒ æŸ¥è¯¢å¤±è´¥: {e}")
    finally:
        conn.close()

def main():
    """ä¸»å‡½æ•°"""
    if len(sys.argv) < 2:
        print("ğŸ“š ä½¿ç”¨æ–¹æ³•:")
        print("  python query_db.py tables              # æ˜¾ç¤ºæ‰€æœ‰è¡¨")
        print("  python query_db.py stats               # æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯")
        print("  python query_db.py info <è¡¨å>          # æ˜¾ç¤ºè¡¨ç»“æ„")
        print("  python query_db.py query <è¡¨å> [æ•°é‡]  # æŸ¥è¯¢è¡¨æ•°æ®")
        print("  python query_db.py sql '<SQLè¯­å¥>'      # æ‰§è¡Œè‡ªå®šä¹‰SQL")
        print("\nç¤ºä¾‹:")
        print("  python query_db.py tables")
        print("  python query_db.py info candidates")
        print("  python query_db.py query submissions 5")
        print("  python query_db.py sql 'SELECT name, phone FROM candidates'")
        return
    
    command = sys.argv[1]
    
    if command == "tables":
        show_tables()
    elif command == "stats":
        show_statistics()
    elif command == "info" and len(sys.argv) >= 3:
        show_table_info(sys.argv[2])
    elif command == "query" and len(sys.argv) >= 3:
        table_name = sys.argv[2]
        limit = int(sys.argv[3]) if len(sys.argv) >= 4 else 10
        query_table(table_name, limit)
    elif command == "sql" and len(sys.argv) >= 3:
        custom_query(sys.argv[2])
    else:
        print("âŒ æ— æ•ˆçš„å‘½ä»¤æˆ–å‚æ•°")
        main()

if __name__ == "__main__":
    main()
```

#### 3.2 ä½¿ç”¨æŸ¥è¯¢è„šæœ¬

```bash
cd /Users/Pythoné¡¹ç›®/HRäººäº‹/backend

# æ˜¾ç¤ºæ‰€æœ‰è¡¨
python query_db.py tables

# æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
python query_db.py stats

# æ˜¾ç¤ºè¡¨ç»“æ„
python query_db.py info candidates

# æŸ¥è¯¢è¡¨æ•°æ®ï¼ˆå‰10æ¡ï¼‰
python query_db.py query candidates

# æŸ¥è¯¢è¡¨æ•°æ®ï¼ˆå‰5æ¡ï¼‰
python query_db.py query submissions 5

# æ‰§è¡Œè‡ªå®šä¹‰SQL
python query_db.py sql "SELECT name, phone, gender FROM candidates"
```

---

## ğŸ“Š æ ¸å¿ƒè¡¨ç»“æ„è¯´æ˜

### 1. `candidates` è¡¨ï¼ˆå€™é€‰äººä¿¡æ¯ï¼‰
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | INTEGER | ä¸»é”® |
| name | VARCHAR | å§“å |
| phone | VARCHAR | ç”µè¯ï¼ˆå”¯ä¸€ï¼‰ |
| email | VARCHAR | é‚®ç®± |
| gender | VARCHAR | æ€§åˆ« |
| position | VARCHAR | åº”è˜å²—ä½ |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |

### 2. `submissions` è¡¨ï¼ˆæäº¤è®°å½•ï¼‰
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | INTEGER | ä¸»é”® |
| candidate_id | INTEGER | å…³è”å€™é€‰äººID |
| questionnaire_id | INTEGER | å…³è”é—®å·ID |
| assessment_id | INTEGER | å…³è”æµ‹è¯„ID |
| answers | JSON | ç­”é¢˜è®°å½• |
| scores | JSON | åˆ†æ•°è®°å½• |
| result_details | JSON | ç»“æœè¯¦æƒ… |
| submitted_at | DATETIME | æäº¤æ—¶é—´ |

### 3. `questionnaires` è¡¨ï¼ˆé—®å·/æµ‹è¯„ï¼‰
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | INTEGER | ä¸»é”® |
| title | VARCHAR | æ ‡é¢˜ |
| type | VARCHAR | ç±»å‹ï¼ˆEPQ/DISC/MBTIç­‰ï¼‰ |
| category | VARCHAR | åˆ†ç±» |
| questions | JSON | é¢˜ç›®å†…å®¹ |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |

---

## ğŸ” å¸¸ç”¨æŸ¥è¯¢ç¤ºä¾‹

### æŸ¥è¯¢æ‰€æœ‰å€™é€‰äººåŠå…¶æäº¤è®°å½•
```sql
SELECT 
    c.id,
    c.name,
    c.phone,
    c.gender,
    c.position,
    COUNT(s.id) as submission_count
FROM candidates c
LEFT JOIN submissions s ON c.id = s.candidate_id
GROUP BY c.id;
```

### æŸ¥è¯¢ç‰¹å®šå€™é€‰äººçš„æ‰€æœ‰æµ‹è¯„è®°å½•
```sql
SELECT 
    c.name,
    q.title as questionnaire_title,
    q.type as questionnaire_type,
    s.submitted_at
FROM submissions s
JOIN candidates c ON s.candidate_id = c.id
JOIN questionnaires q ON s.questionnaire_id = q.id
WHERE c.name = 'èµµå…­';
```

### æŸ¥è¯¢EPQæµ‹è¯„çš„æ‰€æœ‰æäº¤è®°å½•
```sql
SELECT 
    c.name,
    c.phone,
    s.submitted_at,
    s.scores
FROM submissions s
JOIN candidates c ON s.candidate_id = c.id
JOIN questionnaires q ON s.questionnaire_id = q.id
WHERE q.type = 'EPQ';
```

### æŸ¥è¯¢æ²¡æœ‰æäº¤è®°å½•çš„å€™é€‰äºº
```sql
SELECT 
    c.id,
    c.name,
    c.phone
FROM candidates c
LEFT JOIN submissions s ON c.id = s.candidate_id
WHERE s.id IS NULL;
```

### æŸ¥è¯¢æœ€è¿‘7å¤©çš„æäº¤è®°å½•
```sql
SELECT 
    c.name,
    q.title,
    s.submitted_at
FROM submissions s
JOIN candidates c ON s.candidate_id = c.id
JOIN questionnaires q ON s.questionnaire_id = q.id
WHERE s.submitted_at >= datetime('now', '-7 days')
ORDER BY s.submitted_at DESC;
```

---

## ğŸ›¡ï¸ å®‰å…¨æé†’

âš ï¸ **é‡è¦æ³¨æ„äº‹é¡¹**ï¼š

1. **å¤‡ä»½æ•°æ®åº“**ï¼šåœ¨è¿›è¡Œä»»ä½•ä¿®æ”¹æ“ä½œå‰ï¼Œè¯·å…ˆå¤‡ä»½æ•°æ®åº“
   ```bash
   cp /Users/Pythoné¡¹ç›®/HRäººäº‹/backend/hr.db /Users/Pythoné¡¹ç›®/HRäººäº‹/backend/hr_backup_$(date +%Y%m%d_%H%M%S).db
   ```

2. **åªè¯»è®¿é—®**ï¼šå¦‚æœåªæ˜¯æŸ¥çœ‹æ•°æ®ï¼Œä½¿ç”¨åªè¯»æ¨¡å¼æ‰“å¼€
   ```bash
   sqlite3 -readonly hr.db
   ```

3. **è°¨æ…åˆ é™¤**ï¼šæ‰§è¡Œ DELETE æˆ– DROP æ“ä½œå‰ï¼Œè¯·ä¸‰æ€
   ```sql
   -- âŒ å±é™©æ“ä½œç¤ºä¾‹ï¼ˆè¯·å‹¿éšæ„æ‰§è¡Œï¼‰
   DELETE FROM candidates;  -- åˆ é™¤æ‰€æœ‰å€™é€‰äºº
   DROP TABLE submissions;   -- åˆ é™¤æäº¤è®°å½•è¡¨
   ```

4. **äº‹åŠ¡ç®¡ç†**ï¼šä¿®æ”¹æ•°æ®æ—¶ä½¿ç”¨äº‹åŠ¡
   ```sql
   BEGIN TRANSACTION;
   -- æ‰§è¡Œä¿®æ”¹æ“ä½œ
   UPDATE candidates SET gender = 'ç”·' WHERE id = 1;
   -- å¦‚æœç¡®è®¤æ— è¯¯ï¼Œæäº¤äº‹åŠ¡
   COMMIT;
   -- å¦‚æœéœ€è¦æ’¤é”€ï¼Œå›æ»šäº‹åŠ¡
   -- ROLLBACK;
   ```

---

## ğŸ”§ æ•°æ®åº“ç»´æŠ¤

### 1. æ•°æ®åº“å®Œæ•´æ€§æ£€æŸ¥
```bash
sqlite3 hr.db "PRAGMA integrity_check;"
```

### 2. ä¼˜åŒ–æ•°æ®åº“ï¼ˆæ•´ç†ç¢ç‰‡ï¼‰
```bash
sqlite3 hr.db "VACUUM;"
```

### 3. æŸ¥çœ‹æ•°æ®åº“å¤§å°
```bash
ls -lh /Users/Pythoné¡¹ç›®/HRäººäº‹/backend/hr.db
```

### 4. å¯¼å‡ºæ•´ä¸ªæ•°æ®åº“ä¸º SQL
```bash
sqlite3 hr.db .dump > hr_backup.sql
```

### 5. ä» SQL æ–‡ä»¶æ¢å¤æ•°æ®åº“
```bash
sqlite3 hr_new.db < hr_backup.sql
```

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q1: æç¤º"database is locked"æ€ä¹ˆåŠï¼Ÿ
**A**: è¯´æ˜æ•°æ®åº“æ­£åœ¨è¢«å…¶ä»–è¿›ç¨‹ä½¿ç”¨ï¼ˆå¦‚åç«¯æœåŠ¡ï¼‰ã€‚è¯·å…ˆåœæ­¢åç«¯æœåŠ¡ï¼Œæˆ–ä½¿ç”¨åªè¯»æ¨¡å¼è®¿é—®ã€‚

### Q2: å¦‚ä½•æŸ¥çœ‹æŸä¸ªå­—æ®µçš„æ‰€æœ‰ä¸é‡å¤å€¼ï¼Ÿ
**A**: ä½¿ç”¨ DISTINCT
```sql
SELECT DISTINCT gender FROM candidates;
SELECT DISTINCT type FROM questionnaires;
```

### Q3: å¦‚ä½•å¯¼å‡ºæ•°æ®ä¸º Excelï¼Ÿ
**A**: å…ˆå¯¼å‡ºä¸º CSVï¼Œç„¶åç”¨ Excel æ‰“å¼€
```sql
.mode csv
.output candidates.csv
SELECT * FROM candidates;
.output stdout
```

### Q4: å¦‚ä½•æ¸…ç©ºæŸä¸ªè¡¨çš„æ‰€æœ‰æ•°æ®ä½†ä¿ç•™è¡¨ç»“æ„ï¼Ÿ
**A**: 
```sql
DELETE FROM table_name;
-- æˆ–è€…ï¼ˆæ›´å¿«ï¼‰
TRUNCATE TABLE table_name;  -- SQLite ä¸æ”¯æŒ TRUNCATEï¼Œä½¿ç”¨ DELETE
```

---

## ğŸ“š å‚è€ƒèµ„æº

- SQLite å®˜æ–¹æ–‡æ¡£ï¼šhttps://www.sqlite.org/docs.html
- SQLite å‘½ä»¤é€ŸæŸ¥ï¼šhttps://www.sqlitetutorial.net/
- DB Browser ä½¿ç”¨æ•™ç¨‹ï¼šhttps://sqlitebrowser.org/

---

**æœ€åæ›´æ–°æ—¶é—´**: 2025-12-10

