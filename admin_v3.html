<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPQ äººæ‰æµ‹è¯„ç³»ç»Ÿ v3.0</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* ä¸»è‰²è°ƒ */
            --primary: #3B82F6;
            --primary-hover: #2563EB;
            --primary-light: #DBEAFE;
            
            /* æˆåŠŸ/è­¦å‘Š/å±é™© */
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --info: #6366F1;
            
            /* ä¾§è¾¹æ  */
            --sidebar-bg: #1F2937;
            --sidebar-text: #D1D5DB;
            --sidebar-active: #3B82F6;
            --sidebar-hover: #374151;
            
            /* èƒŒæ™¯å’Œæ–‡å­— */
            --bg-primary: #FFFFFF;
            --bg-secondary: #F9FAFB;
            --bg-tertiary: #F3F4F6;
            --text-primary: #111827;
            --text-secondary: #6B7280;
            --text-tertiary: #9CA3AF;
            --border: #E5E7EB;
            
            /* å°ºå¯¸ */
            --sidebar-width: 240px;
            --topbar-height: 60px;
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            min-width: 1280px;
            overflow-x: auto;
        }

        /* ========== ç™»å½•é¡µé¢ ========== */
        #loginPage {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        #loginPage.hidden {
            display: none;
        }

        .login-card {
            background: white;
            border-radius: 16px;
            padding: 40px;
            width: 400px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .login-card h1 {
            color: var(--primary);
            margin-bottom: 10px;
            text-align: center;
        }

        .login-card p {
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
        }

        .error-message {
            color: var(--danger);
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        /* ========== ä¸»å¸ƒå±€ ========== */
        #mainApp {
            display: none;
        }

        #mainApp.active {
            display: flex;
            height: 100vh;
        }

        /* å·¦ä¾§å¯¼èˆªæ  */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--sidebar-bg);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            display: flex;
            flex-direction: column;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
            font-size: 18px;
            font-weight: 700;
        }

        .sidebar-logo i {
            font-size: 28px;
            color: var(--primary);
        }

        .sidebar-menu {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }

        .menu-item {
            padding: 12px 20px;
            color: var(--sidebar-text);
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }

        .menu-item:hover {
            background: var(--sidebar-hover);
            color: white;
        }

        .menu-item.active {
            background: var(--sidebar-active);
            color: white;
        }

        .menu-item i {
            font-size: 20px;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--sidebar-text);
            margin-bottom: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
        }

        .btn-logout {
            width: 100%;
            padding: 10px;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
            color: var(--sidebar-text);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            margin-left: var(--sidebar-width);
            width: calc(100% - var(--sidebar-width));
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .topbar {
            height: var(--topbar-height);
            background: white;
            border-bottom: 1px solid var(--border);
            padding: 0 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 999;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
        }

        .breadcrumb-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .breadcrumb-item.active {
            color: var(--text-primary);
            font-weight: 600;
        }

        .topbar-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 8px 35px 8px 15px;
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            width: 250px;
            font-size: 14px;
        }

        .search-box i {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        /* é¡µé¢å†…å®¹ */
        .page-content {
            flex: 1;
            padding: 30px;
        }

        .page-header {
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .stat-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .stat-card-title {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        .stat-card-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-card-icon.blue {
            background: #DBEAFE;
            color: #3B82F6;
        }

        .stat-card-icon.green {
            background: #D1FAE5;
            color: #10B981;
        }

        .stat-card-icon.orange {
            background: #FED7AA;
            color: #F59E0B;
        }

        .stat-card-icon.purple {
            background: #E0E7FF;
            color: #6366F1;
        }

        .stat-card-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .stat-card-footer {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 13px;
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .stat-trend.up {
            background: #D1FAE5;
            color: #059669;
        }

        .stat-trend.down {
            background: #FEE2E2;
            color: #DC2626;
        }

        /* å¡ç‰‡å®¹å™¨ */
        .card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .card-actions {
            display: flex;
            gap: 12px;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 64px;
            color: var(--text-tertiary);
            margin-bottom: 16px;
        }

        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
        }

        /* é¡µé¢åˆ‡æ¢ */
        .page-view {
            display: none;
        }

        .page-view.active {
            display: block;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            height: 400px;
            margin-top: 20px;
        }

        /* å“åº”å¼ */
        @media (max-width: 1400px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* ========== ç­›é€‰é¢æ¿ ========== */
        .filter-panel {
            background: white;
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .filter-row {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .filter-item {
            flex: 1;
            min-width: 180px;
        }

        .filter-item label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 14px;
        }

        .filter-item select,
        .filter-item input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 14px;
            transition: all 0.3s;
        }

        .filter-item select:focus,
        .filter-item input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .filter-actions {
            display: flex;
            gap: 12px;
        }

        /* ========== æ•°æ®è¡¨æ ¼ ========== */
        .data-table {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .table-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .table-info {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .table-info strong {
            color: var(--primary);
        }

        .table-actions {
            display: flex;
            gap: 12px;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--bg-tertiary);
        }

        thead th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
            white-space: nowrap;
            cursor: pointer;
            user-select: none;
        }

        thead th:hover {
            background: var(--border);
        }

        thead th.sortable::after {
            content: 'â‡…';
            margin-left: 6px;
            opacity: 0.3;
        }

        thead th.sort-asc::after {
            content: 'â†‘';
            opacity: 1;
        }

        thead th.sort-desc::after {
            content: 'â†“';
            opacity: 1;
        }

        tbody tr {
            border-bottom: 1px solid var(--border);
            transition: all 0.2s;
        }

        tbody tr:hover {
            background: var(--bg-secondary);
        }

        tbody td {
            padding: 16px;
            color: var(--text-primary);
            font-size: 14px;
        }

        /* å¤é€‰æ¡† */
        .checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* æ ‡ç­¾æ ·å¼ */
        .tag {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .tag.excellent {
            background: #D1FAE5;
            color: #059669;
        }

        .tag.good {
            background: #DBEAFE;
            color: #2563EB;
        }

        .tag.medium {
            background: #FED7AA;
            color: #D97706;
        }

        .tag.poor {
            background: #FEE2E2;
            color: #DC2626;
        }

        /* åˆ†é¡µ */
        .pagination {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            border-top: 1px solid var(--border);
        }

        .pagination-info {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .pagination-controls {
            display: flex;
            gap: 8px;
        }

        .page-btn {
            padding: 8px 12px;
            border: 1px solid var(--border);
            background: white;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .page-btn:hover:not(:disabled) {
            background: var(--bg-secondary);
            border-color: var(--primary);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            background: none;
            border: none;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 24px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-item {
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
        }

        .info-label {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 6px;
        }

        .info-value {
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin: 30px 0 16px;
            color: var(--text-primary);
        }

        .score-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 30px;
        }

        .score-item {
            text-align: center;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
        }

        .score-label {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 8px;
        }

        .score-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
        }

        /* å¿«æ·æŒ‰é’® */
        .quick-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .quick-btn {
            padding: 4px 10px;
            background: var(--bg-tertiary);
            border: none;
            border-radius: var(--radius-sm);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-btn:hover {
            background: var(--border);
        }
    </style>
</head>
<body>
    <!-- ç™»å½•é¡µé¢ -->
    <div id="loginPage">
        <div class="login-card">
            <h1>EPQ äººæ‰æµ‹è¯„ç³»ç»Ÿ</h1>
            <p>æ™ºèƒ½æ‹›è˜ Â· ç²¾å‡†åŒ¹é…</p>
            
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>ç®¡ç†å‘˜å¯†ç </label>
                    <input type="password" id="passwordInput" placeholder="è¯·è¾“å…¥å¯†ç " required>
                </div>
                
                <div class="error-message" id="loginError"></div>
                
                <button type="submit" class="btn btn-primary">
                    <i class="ri-login-box-line"></i> ç™»å½•
                </button>
                
                <p style="margin-top: 20px; font-size: 13px; text-align: center;">
                    é»˜è®¤å¯†ç ï¼šepq_admin_123
                </p>
            </form>
        </div>
    </div>

    <!-- ä¸»åº”ç”¨ -->
    <div id="mainApp">
        <!-- å·¦ä¾§å¯¼èˆªæ  -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i class="ri-bar-chart-box-line"></i>
                    <span>EPQ æµ‹è¯„ç³»ç»Ÿ</span>
                </div>
            </div>

            <div class="sidebar-menu">
                <a class="menu-item active" onclick="navigateTo('dashboard')" data-page="dashboard">
                    <i class="ri-dashboard-line"></i>
                    <span>æ•°æ®æ¦‚è§ˆ</span>
                </a>
                <a class="menu-item" onclick="navigateTo('candidates')" data-page="candidates">
                    <i class="ri-user-line"></i>
                    <span>å€™é€‰äººç®¡ç†</span>
                </a>
                <a class="menu-item" onclick="navigateTo('resumes')" data-page="resumes">
                    <i class="ri-file-text-line"></i>
                    <span>ç®€å†åº“</span>
                </a>
                <a class="menu-item" onclick="navigateTo('analytics')" data-page="analytics">
                    <i class="ri-line-chart-line"></i>
                    <span>æ™ºèƒ½åˆ†æ</span>
                </a>
                <a class="menu-item" onclick="navigateTo('settings')" data-page="settings">
                    <i class="ri-settings-3-line"></i>
                    <span>ç³»ç»Ÿè®¾ç½®</span>
                </a>
                <a class="menu-item" onclick="navigateTo('assessments')" data-page="assessments">
                    <i class="ri-file-list-3-line"></i>
                    <span>æµ‹è¯„ç®¡ç†</span>
                </a>
            </div>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">A</div>
                    <div>
                        <div style="font-weight: 600; font-size: 14px;">Admin</div>
                        <div style="font-size: 12px; opacity: 0.7;">ç®¡ç†å‘˜</div>
                    </div>
                </div>
                <button class="btn-logout" onclick="handleLogout()">
                    <i class="ri-logout-box-line"></i> é€€å‡ºç™»å½•
                </button>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <div class="topbar">
                <div class="breadcrumb">
                    <div class="breadcrumb-item">
                        <i class="ri-home-4-line"></i>
                        <span>é¦–é¡µ</span>
                    </div>
                    <i class="ri-arrow-right-s-line"></i>
                    <div class="breadcrumb-item active" id="currentPage">æ•°æ®æ¦‚è§ˆ</div>
                </div>

                <div class="topbar-actions">
                    <div class="search-box">
                        <input type="text" placeholder="æœç´¢å€™é€‰äºº..." id="globalSearch">
                        <i class="ri-search-line"></i>
                    </div>
                </div>
            </div>

            <!-- é¡µé¢å†…å®¹ -->
            <div class="page-content">
                <!-- æ•°æ®æ¦‚è§ˆé¡µé¢ -->
                <div class="page-view active" id="page-dashboard">
                    <div class="page-header">
                        <h1 class="page-title">æ•°æ®æ¦‚è§ˆ</h1>
                        <p class="page-subtitle">æŸ¥çœ‹ç³»ç»Ÿå…³é”®æ•°æ®å’Œè¶‹åŠ¿</p>
                    </div>

                    <!-- ç»Ÿè®¡å¡ç‰‡ -->
                    <div class="stats-grid" id="statsGrid"></div>

                    <!-- å›¾è¡¨ -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">æœ¬å‘¨æµ‹è¯„è¶‹åŠ¿</h3>
                        </div>
                        <div class="chart-container" id="trendChart"></div>
                    </div>
                </div>

                <!-- å€™é€‰äººç®¡ç†é¡µé¢ -->
                <div class="page-view" id="page-candidates">
                    <div class="page-header">
                        <h1 class="page-title">å€™é€‰äººç®¡ç†</h1>
                        <p class="page-subtitle">ç®¡ç†å’ŒæŸ¥çœ‹æ‰€æœ‰å€™é€‰äººä¿¡æ¯</p>
                    </div>

                    <!-- ç­›é€‰é¢æ¿ -->
                    <div class="filter-panel">
                        <div class="filter-row">
                            <div class="filter-item">
                                <label>åº”è˜å²—ä½</label>
                                <select id="filterPosition">
                                    <option value="">å…¨éƒ¨å²—ä½</option>
                                </select>
                            </div>
                            <div class="filter-item">
                                <label>å¼€å§‹æ—¥æœŸ</label>
                                <input type="date" id="filterStartDate">
                            </div>
                            <div class="filter-item">
                                <label>ç»“æŸæ—¥æœŸ</label>
                                <input type="date" id="filterEndDate">
                            </div>
                            <div class="filter-item">
                                <label>å…³é”®è¯æœç´¢</label>
                                <input type="text" id="filterKeyword" placeholder="å§“åæˆ–æ‰‹æœºå·">
                            </div>
                        </div>
                        <div class="filter-row">
                            <div class="filter-item">
                                <label>E åˆ†æ•°èŒƒå›´</label>
                                <input type="text" id="filterEScore" placeholder="ä¾‹: 10-20">
                            </div>
                            <div class="filter-item">
                                <label>N åˆ†æ•°èŒƒå›´</label>
                                <input type="text" id="filterNScore" placeholder="ä¾‹: 10-20">
                            </div>
                            <div class="filter-item">
                                <label>P åˆ†æ•°èŒƒå›´</label>
                                <input type="text" id="filterPScore" placeholder="ä¾‹: 10-20">
                            </div>
                            <div class="filter-item">
                                <label>L åˆ†æ•°èŒƒå›´</label>
                                <input type="text" id="filterLScore" placeholder="ä¾‹: 10-20">
                            </div>
                        </div>
                        <div class="filter-actions">
                            <button class="btn btn-primary btn-sm" onclick="applyCandidateFilters()">
                                <i class="ri-search-line"></i> åº”ç”¨ç­›é€‰
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="resetCandidateFilters()">
                                <i class="ri-refresh-line"></i> é‡ç½®
                            </button>
                            <div class="quick-buttons">
                                <button class="quick-btn" onclick="quickDateFilter(7)">æœ€è¿‘7å¤©</button>
                                <button class="quick-btn" onclick="quickDateFilter(30)">æœ€è¿‘30å¤©</button>
                                <button class="quick-btn" onclick="quickDateFilter(90)">æœ€è¿‘90å¤©</button>
                            </div>
                        </div>
                    </div>

                    <!-- æ•°æ®è¡¨æ ¼ -->
                    <div class="data-table">
                        <div class="table-header">
                            <div class="table-info">
                                å…± <strong id="totalCount">0</strong> æ¡è®°å½•ï¼Œ
                                å·²é€‰ <strong id="selectedCount">0</strong> æ¡
                            </div>
                            <div class="table-actions">
                                <button class="btn btn-danger btn-sm" onclick="batchDelete()" id="batchDeleteBtn" disabled>
                                    <i class="ri-delete-bin-line"></i> æ‰¹é‡åˆ é™¤
                                </button>
                                <button class="btn btn-primary btn-sm" onclick="exportFilteredData()">
                                    <i class="ri-download-line"></i> å¯¼å‡ºæ•°æ®
                                </button>
                            </div>
                        </div>

                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th style="width: 50px;">
                                            <input type="checkbox" class="checkbox" id="selectAll" onchange="toggleSelectAll()">
                                        </th>
                                        <th class="sortable" onclick="sortTable('createTime')">æäº¤æ—¶é—´</th>
                                        <th>å§“å</th>
                                        <th>æ‰‹æœºå·</th>
                                        <th>åº”è˜å²—ä½</th>
                                        <th class="sortable" onclick="sortTable('scores.E')">E åˆ†æ•°</th>
                                        <th class="sortable" onclick="sortTable('scores.N')">N åˆ†æ•°</th>
                                        <th class="sortable" onclick="sortTable('scores.P')">P åˆ†æ•°</th>
                                        <th class="sortable" onclick="sortTable('scores.L')">L åˆ†æ•°</th>
                                        <th>å²—ä½åŒ¹é…</th>
                                        <th style="width: 150px;">æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody id="candidateTableBody">
                                    <!-- åŠ¨æ€å¡«å…… -->
                                </tbody>
                            </table>
                        </div>

                        <div class="pagination">
                            <div class="pagination-info" id="paginationInfo"></div>
                            <div class="pagination-controls" id="paginationControls"></div>
                        </div>
                    </div>
                </div>

                <!-- ç®€å†åº“é¡µé¢ -->
                <div class="page-view" id="page-resumes">
                    <div class="page-header">
                        <h1 class="page-title">ç®€å†åº“</h1>
                        <p class="page-subtitle">ä¸Šä¼ å’Œç®¡ç†å€™é€‰äººç®€å†</p>
                    </div>
                    
                    <div class="card">
                        <div class="empty-state">
                            <i class="ri-file-upload-line"></i>
                            <h3>åŠŸèƒ½å¼€å‘ä¸­</h3>
                            <p>ç®€å†ä¸Šä¼ åŠŸèƒ½å°†åœ¨ç¬¬ä¸‰é˜¶æ®µå®ç°</p>
                        </div>
                    </div>
                </div>

                <!-- æ™ºèƒ½åˆ†æé¡µé¢ -->
<div class="page-view" id="page-analytics">
                    <div class="page-header">
                        <h1 class="page-title">æ™ºèƒ½åˆ†æ</h1>
                        <p class="page-subtitle">åŸºäº EPQ çš„å¤šç»´åº¦äººæ‰åˆ†æ</p>
                    </div>

                    <!-- åˆ†æç­›é€‰ -->
                    <div class="filter-panel">
                        <div class="filter-row">
                            <div class="filter-item">
                                <label>é€‰æ‹©å²—ä½</label>
                                <select id="analyticsPosition">
                                    <option value="">å…¨éƒ¨å²—ä½</option>
                                </select>
                            </div>
                            <div class="filter-actions" style="margin-left: auto;">
                                <button class="btn btn-primary btn-sm" onclick="refreshAnalytics()">
                                    <i class="ri-refresh-line"></i> åˆ·æ–°åˆ†æ
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- åˆ†æå›¾è¡¨ -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">å²—ä½åŒ¹é…åº¦é›·è¾¾åˆ†æ</h3>
                        </div>
                        <div class="chart-container" id="matchRadarChart"></div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">å€™é€‰äººç«äº‰åŠ›æ’å</h3>
                        </div>
                        <div class="chart-container" id="competitiveChart"></div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">äººæ ¼ç±»å‹åˆ†å¸ƒ</h3>
                        </div>
                        <div class="chart-container" id="personalityChart"></div>
                    </div>
                </div>

                <!-- ç³»ç»Ÿè®¾ç½®é¡µé¢ -->
                <div class="page-view" id="page-settings">
                    <div class="page-header">
                        <h1 class="page-title">ç³»ç»Ÿè®¾ç½®</h1>
                        <p class="page-subtitle">é…ç½®ç³»ç»Ÿå‚æ•°å’Œè§„åˆ™</p>
                    </div>

                    <!-- å²—ä½ç®¡ç† -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">å²—ä½ç®¡ç†</h3>
                            <button class="btn btn-primary btn-sm" onclick="addPosition()">
                                <i class="ri-add-line"></i> æ·»åŠ å²—ä½
                            </button>
                        </div>
                        <div id="positionList" style="padding: 0 24px 24px;"></div>
                    </div>

                    <!-- ç†æƒ³æ¨¡å‹é…ç½® -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ç†æƒ³EPQæ¨¡å‹</h3>
                            <button class="btn btn-primary btn-sm" onclick="saveIdealModel()">
                                <i class="ri-save-line"></i> ä¿å­˜é…ç½®
                            </button>
                        </div>
                        <div style="padding: 0 24px 24px;">
                            <div class="filter-row">
                                <div class="filter-item">
                                    <label>å¤–å‘æ€§ (E) ç†æƒ³å€¼</label>
                                    <input type="number" id="idealE" min="0" max="24" value="18">
                                </div>
                                <div class="filter-item">
                                    <label>ç¥ç»è´¨ (N) ç†æƒ³å€¼</label>
                                    <input type="number" id="idealN" min="0" max="24" value="12">
                                </div>
                                <div class="filter-item">
                                    <label>ç²¾ç¥è´¨ (P) ç†æƒ³å€¼</label>
                                    <input type="number" id="idealP" min="0" max="24" value="10">
                                </div>
                                <div class="filter-item">
                                    <label>è°è¨€æ€§ (L) ç†æƒ³å€¼</label>
                                    <input type="number" id="idealL" min="0" max="24" value="15">
                                </div>
                            </div>
                            <p style="color: var(--text-secondary); font-size: 13px; margin-top: 12px;">
                                ğŸ’¡ ç†æƒ³æ¨¡å‹å°†ç”¨äºæ™ºèƒ½åˆ†æä¸­çš„é›·è¾¾å›¾å¯¹æ¯”
                            </p>
                        </div>
                    </div>

                    <!-- æ•°æ®ç®¡ç† -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">æ•°æ®ç®¡ç†</h3>
                        </div>
                        <div style="padding: 0 24px 24px;">
                            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                <button class="btn btn-secondary btn-sm" onclick="backupData()">
                                    <i class="ri-download-cloud-line"></i> å¤‡ä»½æ•°æ®
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="document.getElementById('importFile').click()">
                                    <i class="ri-upload-cloud-line"></i> å¯¼å…¥æ•°æ®
                                </button>
                                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                                <button class="btn btn-danger btn-sm" onclick="clearAllData()">
                                    <i class="ri-delete-bin-line"></i> æ¸…ç©ºæ‰€æœ‰æ•°æ®
                                </button>
                            </div>
                            <p style="color: var(--text-secondary); font-size: 13px; margin-top: 12px;">
                                âš ï¸ æ¸…ç©ºæ•°æ®æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œ
                            </p>
                        </div>
                    </div>
                </div>

                <!-- æµ‹è¯„ç®¡ç†é¡µé¢ -->
                <div class="page-view" id="page-assessments">
                    <div class="page-header">
                        <h1 class="page-title">æµ‹è¯„ç®¡ç†</h1>
                        <p class="page-subtitle">ç®¡ç† EPQ æµ‹è¯„é“¾æ¥å’Œè®°å½•</p>
                    </div>

                    <!-- æµ‹è¯„é“¾æ¥ -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">æµ‹è¯„é“¾æ¥</h3>
                        </div>
                        <div style="padding: 0 24px 24px;">
                            <div style="background: var(--bg-secondary); padding: 20px; border-radius: var(--radius-md); margin-bottom: 16px;">
                                <div style="font-weight: 600; margin-bottom: 12px; color: var(--text-primary);">å€™é€‰äººæµ‹è¯„é“¾æ¥</div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <input type="text" id="testLink" readonly 
                                        style="flex: 1; padding: 10px 12px; border: 1px solid var(--border); border-radius: var(--radius-md); background: white; font-family: monospace;"
                                        value="">
                                    <button class="btn btn-primary btn-sm" onclick="copyTestLink()">
                                        <i class="ri-file-copy-line"></i> å¤åˆ¶é“¾æ¥
                                    </button>
                                    <button class="btn btn-secondary btn-sm" onclick="generateQRCode()">
                                        <i class="ri-qr-code-line"></i> ç”ŸæˆäºŒç»´ç 
                                    </button>
                                </div>
                                <p style="color: var(--text-secondary); font-size: 13px; margin-top: 12px;">
                                    ğŸ’¡ å°†æ­¤é“¾æ¥å‘é€ç»™å€™é€‰äººï¼Œä»–ä»¬å¯ä»¥ç›´æ¥å¡«å†™æµ‹è¯„
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- æµ‹è¯„ç»Ÿè®¡ -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">æµ‹è¯„ç»Ÿè®¡</h3>
                        </div>
                        <div style="padding: 0 24px 24px;">
                            <div class="stats-grid" style="margin: 0;">
                                <div class="stat-card" style="box-shadow: none; background: var(--bg-secondary);">
                                    <div class="stat-card-header">
                                        <div class="stat-card-title">æ€»æµ‹è¯„æ•°</div>
                                        <div class="stat-card-icon blue">
                                            <i class="ri-file-list-line"></i>
                                        </div>
                                    </div>
                                    <div class="stat-card-value" id="assessmentTotal">0</div>
                                </div>
                                <div class="stat-card" style="box-shadow: none; background: var(--bg-secondary);">
                                    <div class="stat-card-header">
                                        <div class="stat-card-title">æœ¬å‘¨æ–°å¢</div>
                                        <div class="stat-card-icon green">
                                            <i class="ri-calendar-check-line"></i>
                                        </div>
                                    </div>
                                    <div class="stat-card-value" id="assessmentWeek">0</div>
                                </div>
                                <div class="stat-card" style="box-shadow: none; background: var(--bg-secondary);">
                                    <div class="stat-card-header">
                                        <div class="stat-card-title">ä»Šæ—¥æ–°å¢</div>
                                        <div class="stat-card-icon orange">
                                            <i class="ri-calendar-today-line"></i>
                                        </div>
                                    </div>
                                    <div class="stat-card-value" id="assessmentToday">0</div>
                                </div>
                                <div class="stat-card" style="box-shadow: none; background: var(--bg-secondary);">
                                    <div class="stat-card-header">
                                        <div class="stat-card-title">å¹³å‡å®Œæˆæ—¶é•¿</div>
                                        <div class="stat-card-icon purple">
                                            <i class="ri-time-line"></i>
                                        </div>
                                    </div>
                                    <div class="stat-card-value" style="font-size: 24px;">~5 åˆ†é’Ÿ</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å¿«é€Ÿæ“ä½œ -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">å¿«é€Ÿæ“ä½œ</h3>
                        </div>
                        <div style="padding: 0 24px 24px;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                                <button class="btn btn-primary" onclick="navigateTo('candidates')" style="padding: 20px;">
                                    <i class="ri-user-search-line" style="font-size: 32px; margin-bottom: 8px;"></i>
                                    <div>æŸ¥çœ‹å€™é€‰äºº</div>
                                </button>
                                <button class="btn btn-secondary" onclick="exportFilteredData()" style="padding: 20px;">
                                    <i class="ri-download-line" style="font-size: 32px; margin-bottom: 8px;"></i>
                                    <div>å¯¼å‡ºå…¨éƒ¨æ•°æ®</div>
                                </button>
                                <button class="btn btn-secondary" onclick="backupData()" style="padding: 20px;">
                                    <i class="ri-save-line" style="font-size: 32px; margin-bottom: 8px;"></i>
                                    <div>å¤‡ä»½æ•°æ®</div>
                                </button>
                                <button class="btn btn-secondary" onclick="navigateTo('settings')" style="padding: 20px;">
                                    <i class="ri-settings-3-line" style="font-size: 32px; margin-bottom: 8px;"></i>
                                    <div>ç³»ç»Ÿè®¾ç½®</div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å€™é€‰äººè¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="candidateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">å€™é€‰äººè¯¦æƒ…</h3>
                <button class="modal-close" onclick="closeModal()">
                    <i class="ri-close-line"></i>
                </button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- åŠ¨æ€å¡«å…… -->
            </div>
        </div>
    </div>

    <script>
        // ==================== å…¨å±€é…ç½® ====================
        const CONFIG = {
            password: 'epq_admin_123',
            storageKey: 'epqRecords',
            sessionKey: 'epqAdminSession'
        };

        // ==================== å…¨å±€æ•°æ® ====================
        let allRecords = [];
        let filteredRecords = [];
        let selectedRecordIds = [];
        let currentPage = 'dashboard';
        let currentSort = { field: 'createTime', order: 'desc' };
        let pagination = { page: 1, pageSize: 10, total: 0 };

        // ==================== åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', function() {
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            if (sessionStorage.getItem(CONFIG.sessionKey) === 'true') {
                showMainApp();
            }
        });

        // ==================== ç™»å½•ç›¸å…³ ====================
        function handleLogin(event) {
            event.preventDefault();
            const password = document.getElementById('passwordInput').value;
            const errorEl = document.getElementById('loginError');

            if (password === CONFIG.password) {
                sessionStorage.setItem(CONFIG.sessionKey, 'true');
                showMainApp();
            } else {
                errorEl.textContent = 'âŒ å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•';
                errorEl.classList.add('show');
                setTimeout(() => errorEl.classList.remove('show'), 3000);
            }
        }

        function handleLogout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                sessionStorage.removeItem(CONFIG.sessionKey);
                document.getElementById('loginPage').classList.remove('hidden');
                document.getElementById('mainApp').classList.remove('active');
                document.getElementById('passwordInput').value = '';
            }
        }

        function showMainApp() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainApp').classList.add('active');
            loadData();
            renderDashboard();
        }

        // ==================== æ•°æ®åŠ è½½ ====================
        function loadData() {
            try {
                const data = localStorage.getItem(CONFIG.storageKey);
                allRecords = data ? JSON.parse(data) : [];
                
                // æ•°æ®æ ¼å¼å…¼å®¹æ€§ä¿®å¤
                allRecords = allRecords.map(record => ({
                    ...record,
                    scores: record.scores || { E: 0, N: 0, P: 0, L: 0 },
                    createTime: record.createTime || new Date().toISOString()
                }));
                
                console.log('âœ… æ•°æ®åŠ è½½æˆåŠŸ:', allRecords.length, 'æ¡è®°å½•');
            } catch (error) {
                console.error('âŒ æ•°æ®åŠ è½½å¤±è´¥:', error);
                allRecords = [];
            }
        }

        // ==================== é¡µé¢å¯¼èˆª ====================
        function navigateTo(page) {
            // æ›´æ–°èœå•æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === page) {
                    item.classList.add('active');
                }
            });

            // æ›´æ–°é¢åŒ…å±‘
            const pageNames = {
                dashboard: 'æ•°æ®æ¦‚è§ˆ',
                candidates: 'å€™é€‰äººç®¡ç†',
                resumes: 'ç®€å†åº“',
                analytics: 'æ™ºèƒ½åˆ†æ',
                settings: 'ç³»ç»Ÿè®¾ç½®',
                assessments: 'æµ‹è¯„ç®¡ç†'
            };
            document.getElementById('currentPage').textContent = pageNames[page];

            // åˆ‡æ¢é¡µé¢æ˜¾ç¤º
            document.querySelectorAll('.page-view').forEach(view => {
                view.classList.remove('active');
            });
            document.getElementById('page-' + page).classList.add('active');

            currentPage = page;

            // å¦‚æœæ˜¯æ•°æ®æ¦‚è§ˆï¼Œåˆ·æ–°æ•°æ®
            if (page === 'dashboard') {
                renderDashboard();
            } else if (page === 'candidates') {
                renderCandidatesPage();
            } else if (page === 'analytics') {
                renderAnalyticsPage();
            } else if (page === 'settings') {
                renderSettingsPage();
            } else if (page === 'assessments') {
                renderAssessmentsPage();
            }
        }

        // ==================== æ•°æ®æ¦‚è§ˆæ¸²æŸ“ ====================
        function renderDashboard() {
            renderStatsCards();
            renderTrendChart();
        }

        function renderStatsCards() {
            const today = new Date().toISOString().split('T')[0];
            const todayRecords = allRecords.filter(r => {
                try {
                    const recordDate = new Date(r.createTime).toISOString().split('T')[0];
                    return recordDate === today;
                } catch (e) {
                    return false;
                }
            });

            const positions = [...new Set(allRecords.map(r => r.position).filter(Boolean))];

            // æœ¬å‘¨æ•°æ®
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const weekRecords = allRecords.filter(r => {
                try {
                    return new Date(r.createTime) >= weekAgo;
                } catch (e) {
                    return false;
                }
            });

            const html = `
                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-card-title">æ€»æµ‹è¯„äººæ•°</div>
                        <div class="stat-card-icon blue">
                            <i class="ri-user-line"></i>
                        </div>
                    </div>
                    <div class="stat-card-value">${allRecords.length}</div>
                    <div class="stat-card-footer">
                        <span>ç´¯è®¡å‚ä¸æµ‹è¯„</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-card-title">ä»Šæ—¥æ–°å¢</div>
                        <div class="stat-card-icon green">
                            <i class="ri-calendar-check-line"></i>
                        </div>
                    </div>
                    <div class="stat-card-value">${todayRecords.length}</div>
                    <div class="stat-card-footer">
                        <span class="stat-trend up">
                            <i class="ri-arrow-up-line"></i> +${todayRecords.length}
                        </span>
                        <span>è¾ƒæ˜¨æ—¥</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-card-title">åº”è˜å²—ä½</div>
                        <div class="stat-card-icon orange">
                            <i class="ri-briefcase-line"></i>
                        </div>
                    </div>
                    <div class="stat-card-value">${positions.length}</div>
                    <div class="stat-card-footer">
                        <span>ä¸åŒèŒä½ç±»å‹</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-card-title">æœ¬å‘¨æµ‹è¯„</div>
                        <div class="stat-card-icon purple">
                            <i class="ri-bar-chart-line"></i>
                        </div>
                    </div>
                    <div class="stat-card-value">${weekRecords.length}</div>
                    <div class="stat-card-footer">
                        <span>æœ€è¿‘7å¤©</span>
                    </div>
                </div>
            `;

            document.getElementById('statsGrid').innerHTML = html;
        }

        function renderTrendChart() {
            const chart = echarts.init(document.getElementById('trendChart'));

            // è®¡ç®—æœ€è¿‘7å¤©çš„æ•°æ®
            const dates = [];
            const counts = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                dates.push(dateStr.slice(5)); // MM-DD
                
                const count = allRecords.filter(r => {
                    try {
                        const recordDate = new Date(r.createTime).toISOString().split('T')[0];
                        return recordDate === dateStr;
                    } catch (e) {
                        return false;
                    }
                }).length;
                
                counts.push(count);
            }

            const option = {
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'shadow' }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: dates,
                    axisTick: { alignWithLabel: true }
                },
                yAxis: {
                    type: 'value',
                    minInterval: 1
                },
                series: [{
                    name: 'æµ‹è¯„äººæ•°',
                    type: 'bar',
                    data: counts,
                    itemStyle: {
                        color: '#3B82F6',
                        borderRadius: [8, 8, 0, 0]
                    },
                    label: {
                        show: true,
                        position: 'top',
                        fontSize: 12,
                        fontWeight: 'bold'
                    }
                }]
            };

            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // ==================== å€™é€‰äººç®¡ç† ====================
        function renderCandidatesPage() {
            // åˆå§‹åŒ–å²—ä½ç­›é€‰å™¨
            const positions = [...new Set(allRecords.map(r => r.position).filter(Boolean))];
            const positionSelect = document.getElementById('filterPosition');
            positionSelect.innerHTML = '<option value="">å…¨éƒ¨å²—ä½</option>';
            positions.forEach(pos => {
                positionSelect.innerHTML += `<option value="${pos}">${pos}</option>`;
            });

            // åº”ç”¨ç­›é€‰
            applyCandidateFilters();
        }

        function applyCandidateFilters() {
            const position = document.getElementById('filterPosition').value;
            const startDate = document.getElementById('filterStartDate').value;
            const endDate = document.getElementById('filterEndDate').value;
            const keyword = document.getElementById('filterKeyword').value.toLowerCase();
            const eScore = document.getElementById('filterEScore').value;
            const nScore = document.getElementById('filterNScore').value;
            const pScore = document.getElementById('filterPScore').value;
            const lScore = document.getElementById('filterLScore').value;

            filteredRecords = allRecords.filter(record => {
                // å²—ä½ç­›é€‰
                if (position && record.position !== position) return false;

                // æ—¥æœŸç­›é€‰
                if (startDate || endDate) {
                    try {
                        const recordDate = new Date(record.createTime).toISOString().split('T')[0];
                        if (startDate && recordDate < startDate) return false;
                        if (endDate && recordDate > endDate) return false;
                    } catch (e) {
                        return false;
                    }
                }

                // å…³é”®è¯ç­›é€‰
                if (keyword) {
                    const nameMatch = (record.name || '').toLowerCase().includes(keyword);
                    const phoneMatch = (record.phone || '').toLowerCase().includes(keyword);
                    if (!nameMatch && !phoneMatch) return false;
                }

                // åˆ†æ•°ç­›é€‰
                if (eScore && !checkScoreRange(record.scores.E, eScore)) return false;
                if (nScore && !checkScoreRange(record.scores.N, nScore)) return false;
                if (pScore && !checkScoreRange(record.scores.P, pScore)) return false;
                if (lScore && !checkScoreRange(record.scores.L, lScore)) return false;

                return true;
            });

            // é‡ç½®åˆ†é¡µ
            pagination.page = 1;
            pagination.total = filteredRecords.length;

            // æ’åº
            sortFilteredRecords();

            // æ¸²æŸ“è¡¨æ ¼
            renderCandidateTable();
        }

        function checkScoreRange(score, range) {
            const match = range.match(/(\d+)-(\d+)/);
            if (!match) return true;
            const min = parseInt(match[1]);
            const max = parseInt(match[2]);
            return score >= min && score <= max;
        }

        function resetCandidateFilters() {
            document.getElementById('filterPosition').value = '';
            document.getElementById('filterStartDate').value = '';
            document.getElementById('filterEndDate').value = '';
            document.getElementById('filterKeyword').value = '';
            document.getElementById('filterEScore').value = '';
            document.getElementById('filterNScore').value = '';
            document.getElementById('filterPScore').value = '';
            document.getElementById('filterLScore').value = '';
            applyCandidateFilters();
        }

        function quickDateFilter(days) {
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - days);
            
            document.getElementById('filterStartDate').value = startDate.toISOString().split('T')[0];
            document.getElementById('filterEndDate').value = endDate.toISOString().split('T')[0];
            applyCandidateFilters();
        }

        function sortTable(field) {
            if (currentSort.field === field) {
                currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.field = field;
                currentSort.order = 'desc';
            }
            sortFilteredRecords();
            renderCandidateTable();
        }

        function sortFilteredRecords() {
            filteredRecords.sort((a, b) => {
                let valA, valB;

                if (currentSort.field === 'createTime') {
                    valA = new Date(a.createTime).getTime();
                    valB = new Date(b.createTime).getTime();
                } else if (currentSort.field.startsWith('scores.')) {
                    const scoreKey = currentSort.field.split('.')[1];
                    valA = a.scores[scoreKey];
                    valB = b.scores[scoreKey];
                } else {
                    valA = a[currentSort.field];
                    valB = b[currentSort.field];
                }

                if (currentSort.order === 'asc') {
                    return valA > valB ? 1 : -1;
                } else {
                    return valA < valB ? 1 : -1;
                }
            });
        }

        function renderCandidateTable() {
            const tbody = document.getElementById('candidateTableBody');
            const start = (pagination.page - 1) * pagination.pageSize;
            const end = start + pagination.pageSize;
            const pageRecords = filteredRecords.slice(start, end);

            // æ›´æ–°ç»Ÿè®¡
            document.getElementById('totalCount').textContent = filteredRecords.length;
            document.getElementById('selectedCount').textContent = selectedRecordIds.length;

            // æ¸²æŸ“è¡¨æ ¼
            if (pageRecords.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <i class="ri-inbox-line" style="font-size: 48px; display: block; margin-bottom: 16px; opacity: 0.5;"></i>
                            æš‚æ— æ•°æ®
                        </td>
                    </tr>
                `;
            } else {
                tbody.innerHTML = pageRecords.map(record => {
                    const fit = evaluateFit(record);
                    const isSelected = selectedRecordIds.includes(record.id);
                    const recordId = record.id || `record_${Date.now()}_${Math.random()}`;
                    
                    return `
                        <tr>
                            <td>
                                <input type="checkbox" class="checkbox" ${isSelected ? 'checked' : ''} 
                                    onchange="toggleRecordSelection('${recordId}')">
                            </td>
                            <td>${formatDate(record.createTime)}</td>
                            <td>${record.name || '-'}</td>
                            <td>${maskPhone(record.phone || '-')}</td>
                            <td>${record.position || '-'}</td>
                            <td><strong>${record.scores.E}</strong></td>
                            <td><strong>${record.scores.N}</strong></td>
                            <td><strong>${record.scores.P}</strong></td>
                            <td><strong>${record.scores.L}</strong></td>
                            <td><span class="tag ${fit.level}">${fit.label}</span></td>
                            <td>
                                <button class="btn btn-sm btn-primary" onclick="viewCandidate('${recordId}')" 
                                    style="padding: 6px 12px; font-size: 13px;">
                                    <i class="ri-eye-line"></i> æŸ¥çœ‹
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            // æ›´æ–°æ’åºå›¾æ ‡
            document.querySelectorAll('thead th').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });
            const sortTh = document.querySelector(`thead th[onclick*="${currentSort.field}"]`);
            if (sortTh) {
                sortTh.classList.add(currentSort.order === 'asc' ? 'sort-asc' : 'sort-desc');
            }

            // æ¸²æŸ“åˆ†é¡µ
            renderPagination();
        }

        function formatDate(dateStr) {
            try {
                const date = new Date(dateStr);
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const hour = String(date.getHours()).padStart(2, '0');
                const minute = String(date.getMinutes()).padStart(2, '0');
                return `${year}-${month}-${day} ${hour}:${minute}`;
            } catch (e) {
                return dateStr;
            }
        }

        function maskPhone(phone) {
            if (!phone || phone === '-') return '-';
            if (phone.length === 11) {
                return phone.substring(0, 3) + '****' + phone.substring(7);
            }
            return phone;
        }

        function evaluateFit(record) {
            // ç®€åŒ–çš„åŒ¹é…è¯„ä¼°
            const avgScore = (record.scores.E + record.scores.N + record.scores.P + record.scores.L) / 4;
            
            if (avgScore >= 18) return { level: 'excellent', label: 'ä¼˜ç§€åŒ¹é…' };
            if (avgScore >= 15) return { level: 'good', label: 'è‰¯å¥½åŒ¹é…' };
            if (avgScore >= 12) return { level: 'medium', label: 'ä¸€èˆ¬åŒ¹é…' };
            return { level: 'poor', label: 'è¾ƒä½åŒ¹é…' };
        }

        function renderPagination() {
            const totalPages = Math.ceil(pagination.total / pagination.pageSize);
            const info = document.getElementById('paginationInfo');
            const controls = document.getElementById('paginationControls');

            const start = (pagination.page - 1) * pagination.pageSize + 1;
            const end = Math.min(pagination.page * pagination.pageSize, pagination.total);

            info.textContent = `æ˜¾ç¤º ${start}-${end} æ¡ï¼Œå…± ${pagination.total} æ¡`;

            // ç”Ÿæˆåˆ†é¡µæŒ‰é’®
            let html = `
                <button class="page-btn" onclick="goToPage(${pagination.page - 1})" ${pagination.page === 1 ? 'disabled' : ''}>
                    <i class="ri-arrow-left-s-line"></i>
                </button>
            `;

            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= pagination.page - 2 && i <= pagination.page + 2)) {
                    html += `
                        <button class="page-btn ${i === pagination.page ? 'active' : ''}" onclick="goToPage(${i})">
                            ${i}
                        </button>
                    `;
                } else if (i === pagination.page - 3 || i === pagination.page + 3) {
                    html += `<span style="padding: 0 8px;">...</span>`;
                }
            }

            html += `
                <button class="page-btn" onclick="goToPage(${pagination.page + 1})" ${pagination.page === totalPages ? 'disabled' : ''}>
                    <i class="ri-arrow-right-s-line"></i>
                </button>
            `;

            controls.innerHTML = html;
        }

        function goToPage(page) {
            const totalPages = Math.ceil(pagination.total / pagination.pageSize);
            if (page < 1 || page > totalPages) return;
            pagination.page = page;
            renderCandidateTable();
        }

        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAll').checked;
            const start = (pagination.page - 1) * pagination.pageSize;
            const end = start + pagination.pageSize;
            const pageRecords = filteredRecords.slice(start, end);

            if (selectAll) {
                pageRecords.forEach(record => {
                    const id = record.id || `record_${record.createTime}`;
                    if (!selectedRecordIds.includes(id)) {
                        selectedRecordIds.push(id);
                    }
                });
            } else {
                pageRecords.forEach(record => {
                    const id = record.id || `record_${record.createTime}`;
                    const index = selectedRecordIds.indexOf(id);
                    if (index > -1) {
                        selectedRecordIds.splice(index, 1);
                    }
                });
            }

            updateSelectionUI();
        }

        function toggleRecordSelection(id) {
            const index = selectedRecordIds.indexOf(id);
            if (index > -1) {
                selectedRecordIds.splice(index, 1);
            } else {
                selectedRecordIds.push(id);
            }
            updateSelectionUI();
        }

        function updateSelectionUI() {
            document.getElementById('selectedCount').textContent = selectedRecordIds.length;
            document.getElementById('batchDeleteBtn').disabled = selectedRecordIds.length === 0;
            renderCandidateTable();
        }

        function batchDelete() {
            if (selectedRecordIds.length === 0) return;
            
            if (confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedRecordIds.length} æ¡è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
                allRecords = allRecords.filter(r => {
                    const id = r.id || `record_${r.createTime}`;
                    return !selectedRecordIds.includes(id);
                });
                
                localStorage.setItem(CONFIG.storageKey, JSON.stringify(allRecords));
                selectedRecordIds = [];
                applyCandidateFilters();
                renderDashboard();
                alert('âœ… åˆ é™¤æˆåŠŸï¼');
            }
        }

        function exportFilteredData() {
            if (filteredRecords.length === 0) {
                alert('âš ï¸ æ²¡æœ‰æ•°æ®å¯å¯¼å‡º');
                return;
            }

            const headers = ['æäº¤æ—¶é—´', 'å§“å', 'æ‰‹æœºå·', 'åº”è˜å²—ä½', 'Eåˆ†æ•°', 'Nåˆ†æ•°', 'Påˆ†æ•°', 'Låˆ†æ•°', 'å²—ä½åŒ¹é…'];
            const rows = filteredRecords.map(record => {
                const fit = evaluateFit(record);
                return [
                    record.createTime || '',
                    record.name || '',
                    record.phone || '',
                    record.position || '',
                    record.scores.E,
                    record.scores.N,
                    record.scores.P,
                    record.scores.L,
                    fit.label
                ];
            });

            const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `å€™é€‰äººæ•°æ®_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        function viewCandidate(id) {
            const record = allRecords.find(r => (r.id || `record_${r.createTime}`) === id);
            if (!record) return;

            const fit = evaluateFit(record);
            const modalBody = document.getElementById('modalBody');

            modalBody.innerHTML = `
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">å§“å</div>
                        <div class="info-value">${record.name || '-'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">æ‰‹æœºå·</div>
                        <div class="info-value">${record.phone || '-'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">åº”è˜å²—ä½</div>
                        <div class="info-value">${record.position || '-'}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">æäº¤æ—¶é—´</div>
                        <div class="info-value">${formatDate(record.createTime)}</div>
                    </div>
                </div>

                ${record.remark ? `
                    <div class="info-item" style="margin-bottom: 20px;">
                        <div class="info-label">å¤‡æ³¨</div>
                        <div class="info-value">${record.remark}</div>
                    </div>
                ` : ''}

                <h4 class="section-title">EPQ åˆ†æ•°</h4>
                <div class="score-grid">
                    <div class="score-item">
                        <div class="score-label">å¤–å‘æ€§ (E)</div>
                        <div class="score-value">${record.scores.E}</div>
                    </div>
                    <div class="score-item">
                        <div class="score-label">ç¥ç»è´¨ (N)</div>
                        <div class="score-value">${record.scores.N}</div>
                    </div>
                    <div class="score-item">
                        <div class="score-label">ç²¾ç¥è´¨ (P)</div>
                        <div class="score-value">${record.scores.P}</div>
                    </div>
                    <div class="score-item">
                        <div class="score-label">è°è¨€æ€§ (L)</div>
                        <div class="score-value">${record.scores.L}</div>
                    </div>
                </div>

                <h4 class="section-title">å²—ä½åŒ¹é…åº¦</h4>
                <div class="info-item">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span class="tag ${fit.level}" style="font-size: 16px; padding: 8px 16px;">${fit.label}</span>
                        <span style="color: var(--text-secondary);">ç»¼åˆè¯„åˆ†: ${((record.scores.E + record.scores.N + record.scores.P + record.scores.L) / 4).toFixed(1)}</span>
                    </div>
                </div>

                <h4 class="section-title">EPQ é›·è¾¾å›¾</h4>
                <div id="detailRadarChart" style="height: 400px;"></div>
            `;

            document.getElementById('candidateModal').classList.add('show');

            // æ¸²æŸ“é›·è¾¾å›¾
            setTimeout(() => {
                const chart = echarts.init(document.getElementById('detailRadarChart'));
                const option = {
                    radar: {
                        indicator: [
                            { name: 'å¤–å‘æ€§ (E)', max: 24 },
                            { name: 'ç¥ç»è´¨ (N)', max: 24 },
                            { name: 'ç²¾ç¥è´¨ (P)', max: 24 },
                            { name: 'è°è¨€æ€§ (L)', max: 24 }
                        ],
                        radius: 120
                    },
                    series: [{
                        type: 'radar',
                        data: [{
                            value: [record.scores.E, record.scores.N, record.scores.P, record.scores.L],
                            name: 'å€™é€‰äººåˆ†æ•°',
                            areaStyle: { opacity: 0.5 },
                            itemStyle: { color: '#3B82F6' }
                        }]
                    }]
                };
                chart.setOption(option);
            }, 100);
        }

        function closeModal() {
            document.getElementById('candidateModal').classList.remove('show');
        }

        // ==================== æ™ºèƒ½åˆ†æ ====================
        function renderAnalyticsPage() {
            // åˆå§‹åŒ–å²—ä½é€‰æ‹©
            const positions = [...new Set(allRecords.map(r => r.position).filter(Boolean))];
            const positionSelect = document.getElementById('analyticsPosition');
            positionSelect.innerHTML = '<option value="">å…¨éƒ¨å²—ä½</option>';
            positions.forEach(pos => {
                positionSelect.innerHTML += `<option value="${pos}">${pos}</option>`;
            });

            refreshAnalytics();
        }

        function refreshAnalytics() {
            const position = document.getElementById('analyticsPosition').value;
            const records = position ? allRecords.filter(r => r.position === position) : allRecords;

            renderMatchRadarChart(records);
            renderCompetitiveChart(records);
            renderPersonalityChart(records);
        }

        function renderMatchRadarChart(records) {
            if (records.length === 0) {
                document.getElementById('matchRadarChart').innerHTML = `
                    <div class="empty-state">
                        <i class="ri-radar-line"></i>
                        <h3>æš‚æ— æ•°æ®</h3>
                        <p>è¯·å…ˆæ·»åŠ æµ‹è¯„è®°å½•</p>
                    </div>
                `;
                return;
            }

            const chart = echarts.init(document.getElementById('matchRadarChart'));

            // è®¡ç®—å¹³å‡åˆ†
            const avgScores = {
                E: records.reduce((sum, r) => sum + r.scores.E, 0) / records.length,
                N: records.reduce((sum, r) => sum + r.scores.N, 0) / records.length,
                P: records.reduce((sum, r) => sum + r.scores.P, 0) / records.length,
                L: records.reduce((sum, r) => sum + r.scores.L, 0) / records.length
            };

            // ç†æƒ³æ¨¡å‹ï¼ˆå¯é…ç½®ï¼‰
            const idealScores = { E: 18, N: 12, P: 10, L: 15 };

            const option = {
                tooltip: {},
                legend: {
                    data: ['å€™é€‰äººå¹³å‡', 'ç†æƒ³æ¨¡å‹'],
                    bottom: 20
                },
                radar: {
                    indicator: [
                        { name: 'å¤–å‘æ€§ (E)', max: 24 },
                        { name: 'ç¥ç»è´¨ (N)', max: 24 },
                        { name: 'ç²¾ç¥è´¨ (P)', max: 24 },
                        { name: 'è°è¨€æ€§ (L)', max: 24 }
                    ],
                    radius: 140
                },
                series: [{
                    type: 'radar',
                    data: [
                        {
                            value: [avgScores.E, avgScores.N, avgScores.P, avgScores.L],
                            name: 'å€™é€‰äººå¹³å‡',
                            areaStyle: { opacity: 0.3 },
                            itemStyle: { color: '#3B82F6' },
                            lineStyle: { width: 3 }
                        },
                        {
                            value: [idealScores.E, idealScores.N, idealScores.P, idealScores.L],
                            name: 'ç†æƒ³æ¨¡å‹',
                            areaStyle: { opacity: 0.2 },
                            itemStyle: { color: '#10B981' },
                            lineStyle: { width: 2, type: 'dashed' }
                        }
                    ]
                }]
            };

            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        function renderCompetitiveChart(records) {
            if (records.length === 0) {
                document.getElementById('competitiveChart').innerHTML = `
                    <div class="empty-state">
                        <i class="ri-bar-chart-2-line"></i>
                        <h3>æš‚æ— æ•°æ®</h3>
                        <p>è¯·å…ˆæ·»åŠ æµ‹è¯„è®°å½•</p>
                    </div>
                `;
                return;
            }

            const chart = echarts.init(document.getElementById('competitiveChart'));

            // è®¡ç®—ç»¼åˆåˆ†å¹¶æ’åº
            const rankedRecords = records.map(r => ({
                name: r.name || 'æœªå‘½å',
                score: (r.scores.E + r.scores.N + r.scores.P + r.scores.L) / 4,
                scores: r.scores
            })).sort((a, b) => b.score - a.score).slice(0, 10);

            const option = {
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'shadow' },
                    formatter: function(params) {
                        const data = rankedRecords[params[0].dataIndex];
                        return `
                            <strong>${data.name}</strong><br/>
                            ç»¼åˆåˆ†: ${data.score.toFixed(1)}<br/>
                            E: ${data.scores.E} | N: ${data.scores.N}<br/>
                            P: ${data.scores.P} | L: ${data.scores.L}
                        `;
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: rankedRecords.map(r => r.name),
                    axisLabel: {
                        interval: 0,
                        rotate: 30
                    }
                },
                yAxis: {
                    type: 'value',
                    name: 'ç»¼åˆåˆ†',
                    max: 24
                },
                series: [{
                    name: 'ç»¼åˆåˆ†',
                    type: 'bar',
                    data: rankedRecords.map(r => r.score.toFixed(1)),
                    itemStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: '#3B82F6' },
                            { offset: 1, color: '#60A5FA' }
                        ]),
                        borderRadius: [8, 8, 0, 0]
                    },
                    label: {
                        show: true,
                        position: 'top',
                        formatter: '{c}',
                        fontSize: 12,
                        fontWeight: 'bold'
                    }
                }]
            };

            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        function renderPersonalityChart(records) {
            if (records.length === 0) {
                document.getElementById('personalityChart').innerHTML = `
                    <div class="empty-state">
                        <i class="ri-pie-chart-line"></i>
                        <h3>æš‚æ— æ•°æ®</h3>
                        <p>è¯·å…ˆæ·»åŠ æµ‹è¯„è®°å½•</p>
                    </div>
                `;
                return;
            }

            const chart = echarts.init(document.getElementById('personalityChart'));

            // æ ¹æ® EPQ åˆ†æ•°åˆ†ç±»äººæ ¼ç±»å‹
            const types = {
                'å¤–å‘ç¨³å®šå‹': 0,
                'å¤–å‘ä¸ç¨³å®šå‹': 0,
                'å†…å‘ç¨³å®šå‹': 0,
                'å†…å‘ä¸ç¨³å®šå‹': 0
            };

            records.forEach(r => {
                const isExtroverted = r.scores.E > 12;
                const isStable = r.scores.N < 12;

                if (isExtroverted && isStable) types['å¤–å‘ç¨³å®šå‹']++;
                else if (isExtroverted && !isStable) types['å¤–å‘ä¸ç¨³å®šå‹']++;
                else if (!isExtroverted && isStable) types['å†…å‘ç¨³å®šå‹']++;
                else types['å†…å‘ä¸ç¨³å®šå‹']++;
            });

            const data = Object.entries(types).map(([name, value]) => ({ name, value }));

            const option = {
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c} äºº ({d}%)'
                },
                legend: {
                    bottom: 20,
                    left: 'center'
                },
                series: [{
                    type: 'pie',
                    radius: ['40%', '70%'],
                    avoidLabelOverlap: true,
                    itemStyle: {
                        borderRadius: 10,
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: true,
                        formatter: '{b}\n{c} äºº'
                    },
                    emphasis: {
                        label: {
                            show: true,
                            fontSize: 16,
                            fontWeight: 'bold'
                        }
                    },
                    data: data,
                    color: ['#3B82F6', '#10B981', '#F59E0B', '#EF4444']
                }]
            };

            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
        }

        // ==================== ç³»ç»Ÿè®¾ç½® ====================
        let systemPositions = [];

        function renderSettingsPage() {
            loadSystemConfig();
            renderPositionList();
        }

        function loadSystemConfig() {
            const saved = localStorage.getItem('epqPositions');
            systemPositions = saved ? JSON.parse(saved) : [];
            if (systemPositions.length === 0) {
                systemPositions = [...new Set(allRecords.map(r => r.position).filter(Boolean))];
                saveSystemConfig();
            }
            const idealModel = localStorage.getItem('epqIdealModel');
            if (idealModel) {
                const model = JSON.parse(idealModel);
                document.getElementById('idealE').value = model.E || 18;
                document.getElementById('idealN').value = model.N || 12;
                document.getElementById('idealP').value = model.P || 10;
                document.getElementById('idealL').value = model.L || 15;
            }
        }

        function saveSystemConfig() {
            localStorage.setItem('epqPositions', JSON.stringify(systemPositions));
        }

        function renderPositionList() {
            const list = document.getElementById('positionList');
            if (systemPositions.length === 0) {
                list.innerHTML = '<div class="empty-state" style="padding: 40px 0;"><i class="ri-briefcase-line"></i><h3>æš‚æ— å²—ä½</h3><p>ç‚¹å‡»"æ·»åŠ å²—ä½"å¼€å§‹é…ç½®</p></div>';
                return;
            }
            list.innerHTML = systemPositions.map((pos, index) => `
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 16px; background: var(--bg-secondary); border-radius: var(--radius-md); margin-bottom: 12px;">
                    <div>
                        <div style="font-weight: 600; margin-bottom: 4px;">${pos}</div>
                        <div style="font-size: 13px; color: var(--text-secondary);">å€™é€‰äººæ•°: ${allRecords.filter(r => r.position === pos).length}</div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-sm btn-secondary" onclick="editPosition(${index})"><i class="ri-edit-line"></i> ç¼–è¾‘</button>
                        <button class="btn btn-sm btn-danger" onclick="deletePosition(${index})"><i class="ri-delete-bin-line"></i> åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }

        function addPosition() {
            const name = prompt('è¯·è¾“å…¥å²—ä½åç§°:');
            if (!name || !name.trim()) return;
            if (systemPositions.includes(name.trim())) { alert('âš ï¸ è¯¥å²—ä½å·²å­˜åœ¨ï¼'); return; }
            systemPositions.push(name.trim());
            saveSystemConfig();
            renderPositionList();
            alert('âœ… å²—ä½æ·»åŠ æˆåŠŸï¼');
        }

        function editPosition(index) {
            const oldName = systemPositions[index];
            const newName = prompt('è¯·è¾“å…¥æ–°çš„å²—ä½åç§°:', oldName);
            if (!newName || !newName.trim() || newName.trim() === oldName) return;
            if (systemPositions.includes(newName.trim())) { alert('âš ï¸ è¯¥å²—ä½åç§°å·²å­˜åœ¨ï¼'); return; }
            allRecords.forEach(record => { if (record.position === oldName) record.position = newName.trim(); });
            localStorage.setItem(CONFIG.storageKey, JSON.stringify(allRecords));
            systemPositions[index] = newName.trim();
            saveSystemConfig();
            renderPositionList();
            alert('âœ… å²—ä½ä¿®æ”¹æˆåŠŸï¼');
        }

        function deletePosition(index) {
            const position = systemPositions[index];
            const count = allRecords.filter(r => r.position === position).length;
            if (count > 0 && !confirm(`è¯¥å²—ä½ä¸‹æœ‰ ${count} æ¡å€™é€‰äººè®°å½•ï¼Œç¡®å®šè¦åˆ é™¤å—ï¼Ÿ`)) return;
            if (count === 0 && !confirm(`ç¡®å®šè¦åˆ é™¤å²—ä½"${position}"å—ï¼Ÿ`)) return;
            allRecords.forEach(record => { if (record.position === position) record.position = ''; });
            localStorage.setItem(CONFIG.storageKey, JSON.stringify(allRecords));
            systemPositions.splice(index, 1);
            saveSystemConfig();
            renderPositionList();
            alert('âœ… å²—ä½åˆ é™¤æˆåŠŸï¼');
        }

        function saveIdealModel() {
            const model = {
                E: parseInt(document.getElementById('idealE').value),
                N: parseInt(document.getElementById('idealN').value),
                P: parseInt(document.getElementById('idealP').value),
                L: parseInt(document.getElementById('idealL').value)
            };
            localStorage.setItem('epqIdealModel', JSON.stringify(model));
            alert('âœ… ç†æƒ³æ¨¡å‹ä¿å­˜æˆåŠŸï¼');
        }

        function backupData() {
            const data = { records: allRecords, positions: systemPositions, idealModel: JSON.parse(localStorage.getItem('epqIdealModel') || '{}'), exportTime: new Date().toISOString() };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `EPQå¤‡ä»½_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            alert('âœ… æ•°æ®å¤‡ä»½æˆåŠŸï¼');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (confirm('ç¡®å®šè¦å¯¼å…¥æ•°æ®å—ï¼Ÿè¿™å°†è¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼')) {
                        if (data.records) { allRecords = data.records; localStorage.setItem(CONFIG.storageKey, JSON.stringify(allRecords)); }
                        if (data.positions) { systemPositions = data.positions; saveSystemConfig(); }
                        if (data.idealModel) localStorage.setItem('epqIdealModel', JSON.stringify(data.idealModel));
                        alert('âœ… æ•°æ®å¯¼å…¥æˆåŠŸï¼é¡µé¢å°†åˆ·æ–°ã€‚');
                        location.reload();
                    }
                } catch (err) {
                    alert('âŒ æ•°æ®æ ¼å¼é”™è¯¯ï¼\n' + err.message);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function clearAllData() {
            if (!confirm('âš ï¸ ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) return;
            if (!confirm('ğŸš¨ æœ€åç¡®è®¤ï¼šçœŸçš„è¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ')) return;
            localStorage.removeItem(CONFIG.storageKey);
            localStorage.removeItem('epqPositions');
            localStorage.removeItem('epqIdealModel');
            alert('âœ… æ•°æ®å·²æ¸…ç©ºï¼é¡µé¢å°†åˆ·æ–°ã€‚');
            location.reload();
        }

        // ==================== æµ‹è¯„ç®¡ç† ====================
        function renderAssessmentsPage() {
            // è®¾ç½®æµ‹è¯„é“¾æ¥
            const currentUrl = window.location.href;
            const baseUrl = currentUrl.substring(0, currentUrl.lastIndexOf('/'));
            const testUrl = baseUrl + '/test.html';
            document.getElementById('testLink').value = testUrl;

            // è®¡ç®—ç»Ÿè®¡æ•°æ®
            const today = new Date().toISOString().split('T')[0];
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);

            const todayCount = allRecords.filter(r => {
                try {
                    return new Date(r.createTime).toISOString().split('T')[0] === today;
                } catch (e) {
                    return false;
                }
            }).length;

            const weekCount = allRecords.filter(r => {
                try {
                    return new Date(r.createTime) >= weekAgo;
                } catch (e) {
                    return false;
                }
            }).length;

            document.getElementById('assessmentTotal').textContent = allRecords.length;
            document.getElementById('assessmentWeek').textContent = weekCount;
            document.getElementById('assessmentToday').textContent = todayCount;
        }

        function copyTestLink() {
            const input = document.getElementById('testLink');
            input.select();
            document.execCommand('copy');
            alert('âœ… é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
        }

        function generateQRCode() {
            const link = document.getElementById('testLink').value;
            alert('ğŸ’¡ äºŒç»´ç ç”ŸæˆåŠŸèƒ½\n\næ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹åœ¨çº¿å·¥å…·ç”ŸæˆäºŒç»´ç ï¼š\n\n1. è‰æ–™äºŒç»´ç : https://cli.im\n2. è”å›¾äºŒç»´ç : https://www.liantu.com\n\nå°†æµ‹è¯„é“¾æ¥ç²˜è´´è¿›å»å³å¯ç”ŸæˆäºŒç»´ç ï¼\n\né“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ã€‚');
            const input = document.getElementById('testLink');
            input.select();
            document.execCommand('copy');
        }

        // æš´éœ²åˆ°å…¨å±€
        window.handleLogin = handleLogin;
        window.handleLogout = handleLogout;
        window.navigateTo = navigateTo;
        window.applyCandidateFilters = applyCandidateFilters;
        window.resetCandidateFilters = resetCandidateFilters;
        window.quickDateFilter = quickDateFilter;
        window.sortTable = sortTable;
        window.goToPage = goToPage;
        window.toggleSelectAll = toggleSelectAll;
        window.toggleRecordSelection = toggleRecordSelection;
        window.batchDelete = batchDelete;
        window.exportFilteredData = exportFilteredData;
        window.viewCandidate = viewCandidate;
        window.closeModal = closeModal;
        window.refreshAnalytics = refreshAnalytics;
        window.addPosition = addPosition;
        window.editPosition = editPosition;
        window.deletePosition = deletePosition;
        window.saveIdealModel = saveIdealModel;
        window.backupData = backupData;
        window.importData = importData;
        window.clearAllData = clearAllData;
        window.copyTestLink = copyTestLink;
        window.generateQRCode = generateQRCode;
    </script>
</body>
</html>

